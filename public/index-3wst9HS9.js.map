{"version":3,"file":"index-3wst9HS9.js","sources":["../src/components/monoforumDrawer/index.tsx"],"sourcesContent":["import {createEffect, createMemo, createResource, createSignal, onCleanup, Show} from 'solid-js';\nimport liteMode from '../../helpers/liteMode';\nimport {doubleRaf} from '../../helpers/schedulers';\nimport pause from '../../helpers/schedulers/pause';\nimport {attachHotClassName} from '../../helpers/solid/classname';\nimport {I18nTsx} from '../../helpers/solid/i18n';\nimport type {AutonomousMonoforumThreadList} from '../../lib/appManagers/appDialogsManager';\nimport defineSolidElement, {PassedProps} from '../../lib/solidjs/defineSolidElement';\nimport {useHotReloadGuard} from '../../lib/solidjs/hotReloadGuard';\nimport {ButtonIconTsx} from '../buttonIconTsx';\nimport {PeerTitleTsx} from '../peerTitleTsx';\nimport createMonoforumDialogsList from './list';\nimport styles from './styles.module.scss';\n\nif(import.meta.hot) import.meta.hot.accept();\n\n\ntype Props = {\n  peerId: PeerId;\n  onClose: () => void;\n};\n\ntype Controls = {\n  autonomousList: AutonomousMonoforumThreadList;\n  close: () => Promise<void>;\n};\n\nconst MonoforumDrawer = defineSolidElement({\n  name: 'monoforum-drawer',\n  component: (props: PassedProps<Props>, _, controls: Controls) => {\n    const {appDialogsManager, AutonomousMonoforumThreadList, appSidebarLeft, apiManagerProxy, rootScope} = useHotReloadGuard();\n    const canAnimate = () => liteMode.isAvailable('animations');\n\n    attachHotClassName(props.element, styles.Container);\n\n    const chat = createMemo(() => {\n      const chat = apiManagerProxy.getChat(props.peerId.toChatId());\n      if(chat?._ === 'channel' && chat?.pFlags?.monoforum) return chat;\n\n      setTimeout(() => {\n        props?.onClose(); // Should not happen, but let it be\n      }, 0);\n    });\n\n    const [dialogs] = createResource(() => rootScope.managers.monoforumDialogsStorage.getDialogs({parentPeerId: props.peerId, limit: 1}));\n\n    const initiallyHidden = canAnimate() && !appSidebarLeft.isCollapsed();\n    const [isHidden, setIsHidden] = createSignal(initiallyHidden);\n\n    createEffect(() => {\n      if(!chat() || !initiallyHidden) return;\n      if(canAnimate()) doubleRaf().then(() => setIsHidden(false));\n    });\n\n    const autonomousList = createMonoforumDialogsList({peerId: props.peerId, appDialogsManager, AutonomousMonoforumThreadList})\n\n    controls.autonomousList = autonomousList;\n\n    onCleanup(() => {\n      autonomousList.destroy();\n    });\n\n    const list = autonomousList.sortedList.list;\n    appDialogsManager.setListClickListener({list, onFound: null, withContext: true});\n\n\n    function finishClose() {\n      props.element.remove();\n    }\n\n    async function close() {\n      try { props.onClose?.(); } catch{}\n\n      if(!canAnimate()) return finishClose();\n\n      if(!appSidebarLeft.isCollapsed()) setIsHidden(true);\n\n      await pause(200);\n      finishClose();\n    }\n\n    controls.close = close;\n    autonomousList.onEmpty = close;\n\n    const closeListener = (e: MouseEvent) => {\n      if(e.target === props.element) close();\n    };\n\n    props.element.addEventListener('click', closeListener);\n    onCleanup(() => props.element.removeEventListener('click', closeListener));\n\n    return (\n      <Show when={chat()}>\n        <div\n          class={styles.InnerContainer}\n          classList={{\n            [styles.hidden]: isHidden()\n          }}\n        >\n          <div class={`sidebar-header ${styles.Header}`}>\n            <ButtonIconTsx class='sidebar-close-button' icon='close' noRipple onClick={close} />\n            <div class={styles.TitleContainer}>\n              <PeerTitleTsx class={styles.Title} peerId={props.peerId} />\n              <div class={styles.Subtitle}>\n                <I18nTsx key='ChannelDirectMessages.ThreadsCount' args={[dialogs() ? dialogs().count + '' : '~']} />\n              </div>\n            </div>\n          </div>\n          <div class={styles.ScrollableContainer}>\n            {autonomousList.scrollable.container}\n          </div>\n        </div>\n      </Show>\n    );\n  }\n});\n\nexport type MonoforumDrawerInstance = InstanceType<typeof MonoforumDrawer>;\n\nexport default MonoforumDrawer;\n"],"names":["MonoforumDrawer","defineSolidElement","name","component","props","_","controls","appDialogsManager","AutonomousMonoforumThreadList","appSidebarLeft","apiManagerProxy","rootScope","useHotReloadGuard","canAnimate","liteMode","isAvailable","element","styles","Container","chat","createMemo","getChat","peerId","toChatId","pFlags","monoforum","setTimeout","onClose","dialogs","createResource","managers","monoforumDialogsStorage","getDialogs","parentPeerId","limit","initiallyHidden","isCollapsed","isHidden","setIsHidden","createSignal","createEffect","doubleRaf","then","autonomousList","createMonoforumDialogsList","onCleanup","destroy","list","sortedList","setListClickListener","onFound","withContext","finishClose","remove","close","pause","onEmpty","closeListener","e","target","addEventListener","removeEventListener","_$createComponent","Show","when","children","_el$","_tmpl$","_el$2","firstChild","_el$3","_el$4","_el$5","nextSibling","ButtonIconTsx","icon","noRipple","onClick","PeerTitleTsx","Title","I18nTsx","key","args","count","_$insert","scrollable","container","_$effect","_p$","_v$","InnerContainer","_v$2","hidden","_v$3","Header","_v$4","TitleContainer","_v$5","Subtitle","_v$6","ScrollableContainer","_$className","t","_$classList","a","o","i","n","undefined"],"mappings":"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"}