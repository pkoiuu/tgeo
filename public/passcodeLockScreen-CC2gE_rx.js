import{Z as ee,$ as B,c as G,a0 as h,t as L,a1 as S,i as d,b as l,a2 as W,a3 as A,a as y,a4 as te,a5 as Y,a6 as ne,a7 as U,h as P,D as C,a8 as oe,C as X,a9 as Z,aa as se,ab as ae,ac as re,ad as ie,ae as ce,x as M,af as de,ag as ue,ah as le,z as pe}from"./index-cZ9AAHAN.js";import{u as me,M as V}from"./actions-nLtYL2vm.js";import{T as ge,C as fe,f as ye}from"./chatBackground-CDnnrmlv.js";import{S as x}from"./space-z84hZv3d.js";import"./classNames-0npoXsmd.js";const ve="_PasswordMonkey_1h0e6_1",ke="_hidden_1h0e6_8",_e="_MonkeyImage_1h0e6_13",R={PasswordMonkey:ve,hidden:ke,MonkeyImage:_e};var Pe=L("<img src=assets/img/password-monkey-closed.png>"),he=L("<div>");const be=a=>{const n=ee({size:100},a),{PasswordMonkey:i}=B(),[m,g]=G(),[v,b]=G(!1);return h(()=>{const o=new i(n.passwordInputField,n.size);o.load().then(()=>b(!0)),g(o),A(()=>{o.remove()})}),(()=>{var o=he(),f=n.ref;return typeof f=="function"?S(f,o):n.ref=o,d(o,()=>m().container,null),d(o,l(W,{get when(){return!v()},get children(){var c=Pe();return h(()=>y(c,R.MonkeyImage)),c}}),null),h(c=>{var e=R.PasswordMonkey,$={[R.hidden]:n.hidden},k=n.size+"px";return e!==c.e&&y(o,c.e=e),c.t=te(o,$,c.t),k!==c.a&&((c.a=k)!=null?o.style.setProperty("--size",k):o.style.removeProperty("--size")),c},{e:void 0,t:void 0,a:void 0}),o})()},we="_Popup_1o70z_1",Ce={Popup:we};var Le=L('<div><div class=popup-container><div class=popup-header><div class=popup-title></div></div><div class=popup-description></div><div class=popup-buttons><button class="popup-button btn danger"></button><button class="popup-button btn primary"autofocus>');const Me=a=>(Y(()=>{const n=i=>{i.key==="Escape"&&a.onClose?.()};document.addEventListener("keydown",n),A(()=>{document.removeEventListener("keydown",n)})}),l(oe,{get children(){return l(ge,{onEnter:async(n,i)=>{await C(0),n.classList.add("active"),await C(0),i()},onExit:async(n,i)=>{n.classList.remove("active"),await C(200),i()},get children(){return ne(()=>!!a.visible)()&&(()=>{var n=Le(),i=n.firstChild,m=i.firstChild,g=m.firstChild,v=m.nextSibling,b=v.nextSibling,o=b.firstChild,f=o.nextSibling;return n.$$click=c=>{c.target===c.currentTarget&&a.onClose?.()},d(g,()=>a.title),d(v,()=>a.description),U(o,"click",a.onConfirm,!0),S(X,o,()=>!0),d(o,()=>a.confirmButtonContent),U(f,"click",a.onClose,!0),S(X,f,()=>!0),d(f,()=>P("Cancel")),h(()=>y(n,"popup popup-peer popup-confirmation "+Ce.Popup)),n})()}})}}));Z(["click"]);const Se=a=>{const{themeController:n,rootScope:i}=B(),m=se();return l(W,{get when(){return m.activeScreen!==ae.mobile},get children(){return l(fe,{themeController:n,get managers(){return i.managers},get gradientRendererRef(){return a.gradientRendererRef}})}})},Ae="_Container_likt7_36",$e="_Card_likt7_46",Ee="_Description_likt7_60",Ie="_Input_likt7_67",Te="_SubmitButton_likt7_71",xe="_LogoutButton_likt7_75",_={Container:Ae,Card:$e,Description:Ee,Input:Ie,SubmitButton:Te,LogoutButton:xe};var Re=L("<div><div><form action><button type=button></button><button hidden type=submit></button></form><div>"),Be=L("<button>");const Oe=5,ze=60,Ue=a=>{let n,i,m,g=0;const{isMyPasscode:v,unlockWithPasscode:b}=me(),{InputFieldTsx:o,PasswordInputField:f,apiManagerProxy:c}=B(),e=re({isMonkeyHidden:!!a.fromLockIcon,isError:!1,tooManyAttempts:!1,passcode:"",isLogoutPopupOpen:!1}),[$]=ie(()=>pe.getUnencryptedTotalAccounts());Y(()=>{g=0;const t=a.fromLockIcon;t&&(async()=>{const p=t.getBoundingClientRect(),u=m.getBoundingClientRect();t.style.setProperty("--x",u.left+u.width/2+"px"),t.style.setProperty("--y",u.top+u.height/2+"px"),t.style.setProperty("--scale",u.width/p.width+""),t.classList.add("passcode-lock-screen__animated-lock-icon--shift-body"),await C(500),t.classList.add("passcode-lock-screen__animated-lock-icon--disappear"),e.isMonkeyHidden=!1,await C(400),t.remove(),a.onAnimationEnd?.()})();const r=p=>{document.activeElement&&document.activeElement.tagName==="INPUT"||ye(i.input,p)};document.addEventListener("keydown",r),A(()=>{document.removeEventListener("keydown",r)})});let k;function j(){if(k?.(),e.gradientRenderer){let t=0;k=le(0,1,200,r=>t=r),e.gradientRenderer.toNextPosition(()=>t)}}const q=de(j,100,!0);ce(ue(()=>e.passcode,()=>{q(),e.isError=!1,e.tooManyAttempts=!1})),A(()=>{e.passcode="",i.input.value=""});const J=()=>!!e.passcode&&e.passcode.length<=V,K=async()=>{const t=structuredClone(await M.get("settings",!1)),r=t?.passcode?.canAttemptAgainOn;return r?r>Date.now()?!1:(e.tooManyAttempts=!1,g=0,t.passcode.canAttemptAgainOn=null,M.set({settings:t}),!0):!0};let E=!1;const O=async t=>{if(t?.preventDefault(),!E){E=!0;try{if(!await K())e.tooManyAttempts=!0;else if(J()&&await v(e.passcode))await b(e.passcode),a.onUnlock();else if(g++,e.isError=!0,g>Oe){e.tooManyAttempts=!0;const r=structuredClone(await M.get("settings",!1));r.passcode.canAttemptAgainOn=Date.now()+ze*1e3,await M.set({settings:r})}}catch{e.isError=!0}finally{E=!1}}},Q=l(o,{InputFieldClass:f,instanceRef:t=>void(i=t),get class(){return _.Input},get value(){return e.passcode},onRawInput:t=>void(e.passcode=t),label:"PasscodeLock.EnterYourPasscode",get errorLabel(){return e.tooManyAttempts?"PasscodeLock.TooManyAttempts":e.isError?"PasscodeLock.WrongPasscode":void 0},maxLength:V});return(()=>{var t=Re(),r=t.firstChild,p=r.firstChild,u=p.firstChild,I=u.nextSibling,T=p.nextSibling,z=n;return typeof z=="function"?S(z,t):n=t,d(t,l(Se,{gradientRendererRef:s=>void(e.gradientRenderer=s)}),r),d(r,l(be,{get hidden(){return e.isMonkeyHidden},ref(s){var w=m;typeof w=="function"?w(s):m=s},passwordInputField:i}),p),d(r,l(x,{amount:"1.125rem"}),p),p.addEventListener("submit",O),d(p,Q,u),d(p,l(x,{amount:"1rem"}),u),u.$$mousedown=()=>{O()},d(u,()=>P("PasscodeLock.Proceed")),I.style.setProperty("visibility","hidden"),I.style.setProperty("height","0"),I.style.setProperty("width","0"),d(r,l(x,{amount:"1.625rem"}),T),d(T,()=>P($()>1?"PasscodeLock.ForgotPasscode.MultipleAccounts":"PasscodeLock.ForgotPasscode.OneAccount",[(()=>{var s=Be();return s.$$click=()=>{e.isLogoutPopupOpen=!0},h(()=>y(s,_.LogoutButton)),s})()])),d(t,l(Me,{get visible(){return e.isLogoutPopupOpen},get title(){return P("LogOut")},get description(){return P("PasscodeLock.LogoutPopup.Description")},get confirmButtonContent(){return P("LogOut")},onConfirm:()=>{c.invokeVoid("forceLogout",void 0)},onClose:()=>void(e.isLogoutPopupOpen=!1)}),null),h(s=>{var w=_.Container,D=_.Card,F=`btn-primary btn-color-primary btn-large ${_.SubmitButton}`,H=!e.passcode,N=_.Description;return w!==s.e&&y(t,s.e=w),D!==s.t&&y(r,s.t=D),F!==s.a&&y(u,s.a=F),H!==s.o&&(u.disabled=s.o=H),N!==s.i&&y(T,s.i=N),s},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),t})()};Z(["mousedown","click"]);export{Ue as default};
//# sourceMappingURL=passcodeLockScreen-CC2gE_rx.js.map
