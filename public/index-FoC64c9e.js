import{d as T,es as re,dU as se,bG as ae,bL as le,a3 as v,a6 as P,aH as ce,br as Y,ae as M,ba as Z,t as R,i as I,b as h,a2 as F,a0 as L,a as C,c as y,h as $,cC as ie,b_ as G,a5 as de,c0 as ue,bt as me,a1 as K,a7 as U,bv as H,a4 as pe,b$ as ge,a9 as he}from"./index-cZ9AAHAN.js";import{w as _e,g as A,e as be,b as fe,f as W,F as Ie,h as we,s as Ee,i as Fe,d as Le}from"./appDialogsManager-cbS0liPA.js";import{I as k,S as Te}from"./iconTsx-BuRFsxGS.js";import{T as ve}from"./chatBackground-CDnnrmlv.js";import"./page-B3fcTjWa.js";import"./avatar-wf2_bAoN.js";import"./putPreloader-Bm9gUdtL.js";import"./classNames-0npoXsmd.js";import"./htmlToSpan-DhAls8qz.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./textToSvgURL-Cnw_Q8Rw.js";import"./fastBlur-Co-79rP4.js";import"./countryInputField-D86-3P02.js";import"./codeInputField-B-BjYjUz.js";function Ce(e,t){return J(e.toLowerCase(),t.toLowerCase(),t.length)}function J(e,t,n){let r=[],i=0;const m=e.length,s=t.length;for(let a=0;a<s;a++)for(let o=0;o<m;o++){if(e[o]!==t[a])continue;const{found:l}=J(e.slice(o+1),t.slice(a+1),n),u=[o,...l.map(p=>p+o+1)],b=q(e,t,u,n)-D.missing(n)*a;b>i&&(i=b,r=u)}return{found:r,score:q(e,t,r,n)}}const D={missing:e=>1/e,gap:(e,t)=>.25/e*t};function q(e,t,n,r,i){const m=e.length,s=t.length,a=n.length;if(!a)return 0;let o=1,l=0,u=-1;for(let b=0;b<a&&l<s;b++){const p=n[b];if(!(p<m))break;for(;e[p]!==t[l]&&l<s;)l++,o-=D.missing(r);l++,u!=-1&&p-u>1&&(o-=D.gap(s,p-u-1)),u=p}return o-=(r-l)*D.missing(r),o}const Se="_Container_1o0hu_36",Ae="_withScrollable_1o0hu_40",xe="_Scrollable_1o0hu_45",ye="_ScrollableContainer_1o0hu_54",De="_mobile_1o0hu_60",Pe="_Label_1o0hu_64",Me="_LabelText_1o0hu_75",ke="_Input_1o0hu_83",He="_EmptySearchTip_1o0hu_94",Ze="_Char_1o0hu_106",$e="_single_1o0hu_114",Ne="_middle_1o0hu_118",Re="_start_1o0hu_122",ze="_end_1o0hu_129",Oe="_Hidden_1o0hu_137",Be="_Item_1o0hu_141",Ve="_selected_1o0hu_141",je="_ItemLabel_1o0hu_144",Ge="_ItemLabelText_1o0hu_151",Ke="_ItemLabelEnter_1o0hu_154",Ue="_ItemIcon_1o0hu_157",We="_ItemIconCheck_1o0hu_160",qe="_AppearZoomEnterActive_1o0hu_173",Xe="_AppearZoomEnter_1o0hu_173",Ye="_AppearZoomExitTo_1o0hu_176",c={Container:Se,withScrollable:Ae,Scrollable:xe,ScrollableContainer:ye,mobile:De,Label:Pe,LabelText:Me,Input:ke,EmptySearchTip:He,Char:Ze,single:$e,middle:Ne,start:Re,end:ze,Hidden:Oe,Item:Be,selected:Ve,ItemLabel:je,ItemLabelText:Ge,ItemLabelEnter:Ke,ItemIcon:Ue,ItemIconCheck:We,AppearZoomEnterActive:qe,AppearZoomEnter:Xe,AppearZoomExitTo:Ye},S=ae("AddToFolderDropdownMenu",le.Debug);async function Ct(){return(await T.managers.filtersStorage.getDialogFilters()).filter(t=>t.id!==re&&t.id!==se).sort((t,n)=>!t.id||!n.id?0:t?.localId-n?.localId)}const g=e=>Math.abs(e);async function Je(e,t){S.debug("addToFilter before",e),e={...e},e._==="dialogFilter"&&(e.excludePeerIds=e.excludePeerIds?.filter(r=>g(r)!==g(t)),e.exclude_peers=e.exclude_peers?.filter(r=>g(A(r))!==g(t))),e.pinnedPeerIds.find(r=>g(r)===g(t))||(e.includePeerIds=[...(e.includePeerIds||[]).filter(r=>g(r)!==g(t)),t],e.include_peers=[...(e.include_peers||[]).filter(r=>g(A(r))!==g(t)),await T.managers.appPeersManager.getInputPeerById(t)]),S.debug("addToFilter after",e),await T.managers.filtersStorage.updateDialogFilter(e)}async function Qe(e,t){S.debug("removeFromFilter before",e),e={...e},e.includePeerIds=e.includePeerIds?.filter(n=>g(t)!==g(n)),e.include_peers=e.include_peers?.filter(n=>g(A(n))!==g(t)),e.pinnedPeerIds=e.pinnedPeerIds?.filter(n=>g(t)!==g(n)),e.pinned_peers=e.pinned_peers?.filter(n=>g(A(n))!==g(t)),e._==="dialogFilter"&&(e.excludePeerIds=[...(e.excludePeerIds||[]).filter(n=>g(n)!==g(t)),t],e.exclude_peers=[...(e.exclude_peers||[]).filter(n=>g(A(n))!==g(t)),await T.managers.appPeersManager.getInputPeerById(t)]),S.debug("removeFromFilter after",e),await T.managers.filtersStorage.updateDialogFilter(e)}function et(e,t){const n=document.createElement("span"),r=_e(e,t,!0);n.append(r),n.querySelector("custom-emoji-renderer-element")?.setTextColor("primary-text-color");const m=document.createTreeWalker(n,NodeFilter.SHOW_TEXT),s=[],a=[];for(;m.nextNode();)s.push(m.currentNode);for(const o of s){const l=document.createDocumentFragment(),u=o.nodeValue.split("").map(b=>{const p=document.createElement("span");return p.innerText=b,p});a.push(u),l.append(...u),o.parentNode.replaceChild(l,o)}return{span:n,charSpansGroups:a}}function tt(e,t){let n=0;const r=[];for(const i of e){const m=i.length,s=t.filter(o=>o>=n&&o<n+m).map(o=>o-n),a=s.length;n+=m;for(let o=0;o<a;o++){let l=o;for(;l<a-1&&s[l+1]-1===s[l];)l++;if(l===o){const p=s[o],w=i[p];w.classList.add(c.Char,c.single),r.push(w);continue}const u=i[s[o]],b=i[s[l]];u.classList.add(c.Char,c.start),b.classList.add(c.Char,c.end),r.push(u,b);for(let p=o+1;p<l;p++){const w=i[s[p]];w.classList.add(c.Char,c.middle),r.push(w)}o=l}}v(()=>{r.forEach(i=>{i.className=""})})}var N=R("<span>");const nt=.25,ot=({filter:e,isChecked:t,docId:n,emoji:r})=>{const[i,m]=y(!1);return(()=>{var s=N();return I(s,h(F,{get when(){return(n||r)&&!i()},get fallback(){return h(k,{get icon(){return we(e)}})},get children(){return h(Ie,{get managers(){return T.managers},color:"primary-text-color",docId:n,emoji:r,size:20,onFail:()=>m(!0),get dontAnimate(){return e.pFlags?.title_noanimate}})}}),null),I(s,h(ve,{get enterActiveClass(){return c.AppearZoomEnterActive},get exitActiveClass(){return c.AppearZoomEnterActive},get enterClass(){return c.AppearZoomEnter},get exitToClass(){return c.AppearZoomExitTo},get children(){return h(F,{get when(){return t()},get children(){var a=N();return I(a,h(k,{icon:"check"})),L(()=>C(a,c.ItemIconCheck)),a}})}}),null),L(()=>C(s,`btn-menu-item-icon ${c.ItemIcon}`)),s})()},rt=({label:e,isSelected:t})=>(()=>{var n=N();return I(n,e,null),I(n,h(F,{get when(){return t()},get children(){return h(k,{icon:"enter",get class(){return c.ItemLabelEnter}})}}),null),L(()=>C(n,c.ItemLabel)),n})(),st=({filters:e,isInFilter:t,isSelected:n,onToggle:r,currentFilter:i})=>P(()=>{const m=ce();return S.debug("creating folder items"),v(()=>{S.debug("destroying folder items middleware"),m.destroy()}),e().map(s=>{const a=be(s.title),{span:o,charSpansGroups:l}=et(a.text,m.get());o.classList.add(c.ItemLabelText);const u={iconElement:ot({filter:s,isChecked:()=>t(s),docId:a.docId,emoji:a.emoji}),textElement:rt({label:o,isSelected:()=>n(s.id)}),onClick:Z},b=fe(u);return u.element?.addEventListener(Y,async p=>{p.shiftKey&&i()!==s.id&&p.stopPropagation(),r(s)},!0),u.element?.classList.add(c.Item),M(()=>{n(s.id)&&(u.element?.classList.add(c.selected),v(()=>void u.element?.classList.remove(c.selected)))}),{filter:s,textContent:o.textContent,buttonMenuItem:b,element:u.element,charSpansGroups:l}})}),at=({dialog:e,onNewDialog:t,isInFilter:n})=>{let r=!1;return async i=>{if(r||!i)return;const m=ie(i);r=!0;try{await(n(i)?Qe(m,e().peerId):Je(m,e().peerId));const s=await T.managers.dialogsStorage.getAnyDialog(e().peerId);if(!Fe(s))return;t(s)}catch{}finally{r=!1}}},lt=({folderItems:e,search:t,isSelected:n,setSelected:r})=>P(()=>{if(!t())return{folders:e(),visibleFoldersCount:e().length};const m=e().map(a=>({finderResult:Ce(a.textContent,t()),src:a})).sort(({finderResult:{found:a,score:o}},{finderResult:{found:l,score:u}})=>o===u?(a[0]||0)-(l[0]||0):u-o);r(0),v(()=>void r());const s=m.filter(({src:a,finderResult:o})=>{if(o.score>=nt)return M(()=>{n(a.filter.id)&&a.element.scrollIntoView({block:"center"})}),tt(a.charSpansGroups,o.found),!0;a.buttonMenuItem.forEach(l=>l.classList.add(c.Hidden)),v(()=>void a.buttonMenuItem.forEach(l=>l.classList.remove(c.Hidden)))}).length;return{folders:m.map(({src:a})=>a),visibleFoldersCount:s}}),ct=({pivot:e})=>{let t=Z;return setTimeout(()=>{t=void 0},200),v(()=>{t?.()}),{showHint:()=>{t||(t=Ee({element:e(),vertical:"top",textElement:$("AddToFolderTip"),lighter:!0,auto:!0,useOverlay:!1,onClose:()=>{t=void 0}}).close)},closeAndDisableTooltip:()=>{t?.(),t=Z}}},it=({search:e,setSearch:t,selected:n,setSelected:r,selectedFilter:i,currentFilter:m,onToggle:s,visibleFoldersCount:a})=>o=>{if(["ArrowUp","ArrowLeft","ArrowDown","ArrowRight","Enter"].includes(o.code)&&o.preventDefault(),o.code==="Escape"&&(e()?t(""):W.close()),o.code==="Enter"&&i()){s(i()),(!o.shiftKey||m()===i().id)&&W.close();return}if(typeof n()!="number")return;const l=["ArrowUp","ArrowLeft"].includes(o.code)?-1:["ArrowDown","ArrowRight"].includes(o.code)?1:0;r(u=>(u+l+a())%a())};var dt=R("<input>"),X=R("<div>");const ut=8,St=Le({name:"add-to-folder-dropdown-menu",component:(e,t,n)=>{e.element.classList.add("btn-menu",c.Container);let r,i,m;const[s,a]=y(""),[o,l]=y(),[u,b]=y([]),p=G(()=>e.dialog,(_,d)=>!!d?.[`index_${_.localId}`]),w=P(()=>u()[o()]?.filter),z=G(()=>w()?.id),O=P(()=>e.filters.length>ut),B=at({dialog:()=>e.dialog,onNewDialog:_=>{e.dialog=_,e.onNewDialog?.(_)},isInFilter:p}),Q=st({filters:()=>e.filters,isInFilter:p,isSelected:z,onToggle:B,currentFilter:e.currentFilter}),x=lt({folderItems:Q,search:s,isSelected:z,setSelected:l}),{showHint:ee,closeAndDisableTooltip:te}=ct({pivot:()=>r});n.closeTooltip=te;const ne=it({search:s,setSearch:a,selected:o,setSelected:l,selectedFilter:w,currentFilter:e.currentFilter,onToggle:B,visibleFoldersCount:()=>x().visibleFoldersCount});de(()=>{m?.addEventListener(Y,_=>{_.stopPropagation()},!0)}),ue(()=>{b(x().folders)}),M(()=>{typeof o()!="number"&&i?.scrollIntoView({block:"center"})}),M(()=>{e.element.classList.toggle(c.withScrollable,O())});const oe=me.registerEscapeHandler(()=>!s());v(()=>{e.onCleanup?.(),oe()});const V=()=>h(ge,{get each(){return x().folders},children:_=>_.buttonMenuItem});return h(F,{get when(){return O()},get fallback(){return h(V,{})},get children(){var _=X();return _.style.setProperty("--max-visible-items","6"),I(_,h(F,{when:!H,get children(){var d=dt();return K(f=>void setTimeout(()=>void f.focus(),100),d),U(d,"keydown",ne,!0),d.addEventListener("blur",f=>{f.target.focus()}),d.$$input=f=>void a(f.target.value),L(()=>C(d,c.Input)),L(()=>d.value=s()),d}}),null),I(_,h(F,{get when(){return!x().visibleFoldersCount},get children(){return(()=>{const d=$("AddToFolderEmptySearchResult");return d.classList.add(c.EmptySearchTip),d})()}}),null),I(_,h(Te,{get class(){return c.Scrollable},thumbRef:d=>void(m=d),get children(){return[h(F,{when:!H,get children(){var d=X();U(d,"pointerenter",ee);var f=i;return typeof f=="function"?K(f,d):i=d,I(d,()=>{const E=$("AddToFolderSearch");return E.classList.add(c.LabelText),E},null),I(d,h(k,{ref(E){var j=r;typeof j=="function"?j(E):r=E},icon:"info"}),null),L(()=>C(d,c.Label)),d}}),h(V,{})]}}),null),L(d=>{var f=c.ScrollableContainer,E={[c.mobile]:H};return f!==d.e&&C(_,d.e=f),d.t=pe(_,E,d.t),d},{e:void 0,t:void 0}),_}})}});he(["input","keydown"]);export{St as default,Ct as fetchDialogFilters};
//# sourceMappingURL=index-FoC64c9e.js.map
