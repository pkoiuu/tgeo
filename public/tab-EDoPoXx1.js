import{b as r,a2 as U,t as k,i as _,h as y,am as D,dq as S,bG as F,cG as L,bg as O,Z as K,c as R,bx as V,a3 as q,a6 as h,az as H,c0 as j,aA as z,af as J,ae as B,c1 as W,ad as E,bE as Z,a8 as Q}from"./index-cZ9AAHAN.js";import{H as T,J as w,R as m,K as X,M,N as Y,O as ee,G as te}from"./appDialogsManager-cbS0liPA.js";import{u as re,S as se}from"./saveButton-BeRh5auc.js";import{T as N}from"./chatBackground-CDnnrmlv.js";import{u as ae}from"./useStarsCommissionAndWithdrawalPrice-BBgg12A9.js";import{S as ne}from"./starsRangeInput-Cbw05tYn.js";import"./page-B3fcTjWa.js";import"./avatar-wf2_bAoN.js";import"./putPreloader-Bm9gUdtL.js";import"./classNames-0npoXsmd.js";import"./htmlToSpan-DhAls8qz.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./textToSvgURL-Cnw_Q8Rw.js";import"./iconTsx-BuRFsxGS.js";import"./fastBlur-Co-79rP4.js";import"./countryInputField-D86-3P02.js";import"./codeInputField-B-BjYjUz.js";import"./useAppConfig-LDRFzLas.js";var p=(e=>(e[e.Everybody=1]="Everybody",e[e.ContactsAndPremium=2]="ContactsAndPremium",e[e.Paid=3]="Paid",e))(p||{});const G="inputPrivacyKeyNoPaidMessages",oe=[{_:"inputPrivacyValueAllowContacts"}],f=120;var ie=k("<span class=primary>"),ce=k("<div>");const le=e=>{const[a,{AppAddMembersTab:n}]=T(),{commissionPercents:o,willReceiveDollars:d}=ae(()=>e.store.stars),i=()=>{a.slider.createTab(n).open({type:"privacy",skippable:!0,title:"PaidMessages.RemoveFee",placeholder:"PrivacyModal.Search.Placeholder",takeOut:s=>{e.setStore("chosenPeers",s)},selectedPeerIds:[...e.store.chosenPeers]})},l=()=>{if(!e.store.chosenPeers.length)return y("PrivacySettingsController.AddUsers");const{users:s,chats:u}=e.chosenPeersByType;return D([s.length?y("Users",[s.length]):null,u.length?y("Chats",[u.length]):null].filter(Boolean),!1)};return r(N,{onEnter:async(s,u)=>{const t=s;t.style.opacity="0",await e.exitAnimationPromise,await t.animate({opacity:[0,1]},{duration:f}).finished,t.style.removeProperty("opacity"),u()},onExit:async(s,u)=>{await s.animate({opacity:[1,0]},{duration:f}).finished,u()},get children(){return r(U,{get when(){return e.isPaid},get children(){var s=ce();return _(s,r(w,{name:"PaidMessages.SetPrice",caption:"PaidMessages.SetPriceDescription",get captionArgs(){return[o(),d()]},get children(){return r(ne,{get value(){return e.store.stars},get onChange(){return e.setStore.bind(null,"stars")}})}}),null),_(s,r(w,{name:"PrivacyExceptions",caption:"PaidMessages.RemoveFeeDescription",get children(){return r(m,{clickable:i,get children(){return[r(m.Title,{get children(){return y("PaidMessages.RemoveFee")}}),r(m.RightContent,{get children(){var u=ie();return _(u,l),u}})]}})}}),null),s}})}})},I=F("useSaveSettings"),ue=({store:e,globalPrivacy:a,isPaid:n,hasChanges:o,chosenPeersByType:d})=>{const{rootScope:i}=S(),[l]=T(),s=()=>{const c=structuredClone(a());c.noncontact_peers_paid_stars=n()?e.stars:0,c.pFlags??(c.pFlags={}),X(c.pFlags,"new_noncontact_peers_require_premium",e.option===p.ContactsAndPremium),I("saving settings :>> ",c);const P=i.managers.appPrivacyManager.setGlobalPrivacySettings(c);return l.payload.onSaved(P),P},u=async()=>{const c=[],{chats:P,users:g}=d();return c.push(...oe),P.length&&c.push({_:"inputPrivacyValueAllowChatParticipants",chats:P}),g.length&&c.push({_:"inputPrivacyValueAllowUsers",users:await Promise.all(g.map(C=>i.managers.appUsersManager.getUserInput(C)))}),I("saving rules :>> ",c),i.managers.appPrivacyManager.setPrivacy(G,c)};let t=!1;return async()=>{if(!(t||!o())){t=!0;try{await Promise.all([s(),n()?u():void 0]),l.close()}finally{t=!1}}}},de="_Radio_8rde5_36",me="_floating_8rde5_62",ge="_checked_8rde5_66",b={Radio:de,floating:me,checked:ge};var pe=k("<span>");const A=e=>{const[a,n]=L(e,["checked","floating","class","classList"]);return(()=>{var o=pe();return O(o,K({get class(){return b.Radio},get classList(){return{[a.class]:!!a.class,[b.checked]:a.checked,[b.floating]:a.floating,"offset-left":a.floating,...a.classList}}},n),!1,!1),o})()},$=()=>{const{rootScope:e}=S(),[a,n]=R(e.premium),o=new V;return o.add(e)("premium_toggle",d=>{n(d)}),q(()=>{o.removeAll()}),a},he=10,Pe=e=>{const{PopupPremium:a}=S(),n=$(),o=i=>()=>{if(n())return i();Y({langPackKey:"PrivacySettings.Messages.PremiumError",langPackArguments:[M(()=>{ee(),a.show({feature:"message_privacy"})})]})},d=r(N,{mode:"outin",onEnter:async(i,l)=>{await i.animate({opacity:[0,1]},{duration:f}).finished,l()},onExit:async(i,l)=>{const s=i.animate({opacity:[1,0]},{duration:f}).finished;e.onExitAnimationPromise(s),await s,l()},get children(){return h(()=>!e.isPaid)()?y("Privacy.MessagesInfo",[M(()=>void a.show())]):y("PaidMessages.ChargeForMessagesDescription")}});return r(w,{name:"PrivacyMessagesTitle",caption:d,get children(){return[r(m,{clickable:()=>{e.setStore("option",p.Everybody)},get children(){return[r(m.CheckboxField,{get children(){return r(A,{floating:!0,get checked(){return e.store.option===p.Everybody}})}}),r(m.Title,{get children(){return y("PrivacySettingsController.Everbody")}})]}}),r(m,{get clickable(){return o(()=>{e.setStore("option",p.ContactsAndPremium)})},get children(){return[h(()=>h(()=>!!n())()&&r(m.CheckboxField,{get children(){return r(A,{floating:!0,get checked(){return e.store.option===p.ContactsAndPremium}})}})),h(()=>h(()=>!n())()&&r(m.Icon,{icon:"premium_lock"})),r(m.Title,{get children(){return y("Privacy.ContactsAndPremium")}})]}}),r(m,{get clickable(){return o(()=>{e.setStore(i=>({option:p.Paid,stars:i.stars||he}))})},get children(){return[h(()=>h(()=>!!n())()&&r(m.CheckboxField,{get children(){return r(A,{floating:!0,get checked(){return e.isPaid}})}})),h(()=>h(()=>!n())()&&r(m.Icon,{icon:"premium_lock"})),r(m.Title,{get children(){return y("PaidMessages.ChargeForMessages")}})]}})]}})},ye=({isReady:e,globalPrivacy:a,currentOption:n,currentAllowedChats:o,currentAllowedUsers:d})=>{let i={};const[l,s]=H({});j(()=>{e()&&(i={option:n(),stars:Number(a().noncontact_peers_paid_stars)||void 0,chosenPeers:[...d(),...o()]},s(z(structuredClone(i))))});const[u,t]=R(!1),v=J(t,200,!0);B(()=>{const g=c()?[]:["chosenPeers","stars"];v(!W(l,i,g))});const c=h(()=>l.option===p.Paid);return[l,s,{hasChanges:u,isPaid:c,chosenPeersByType:()=>({chats:l.chosenPeers.filter(g=>g.isAnyChat()).map(g=>g.toChatId()),users:l.chosenPeers.filter(g=>g.isUser())})}]},ve=e=>e instanceof Object?e.user_id?.toPeerId(!0):e.toPeerId(!0),fe=()=>{const{rootScope:e}=S(),a=te(),n=$(),[o]=E(()=>{const t=e.managers.appPrivacyManager.getPrivacy(G);return a.collect(t),t}),[d]=E(()=>{const t=e.managers.appPrivacyManager.getGlobalPrivacySettings();return a.collect(t),t});return{isReady:()=>o.state==="ready"&&d.state==="ready",globalPrivacy:d,privacyRules:o,currentOption:()=>n()?d().noncontact_peers_paid_stars?p.Paid:d().pFlags.new_noncontact_peers_require_premium?p.ContactsAndPremium:p.Everybody:p.Everybody,currentAllowedUsers:()=>o()?.filter(t=>t._==="privacyValueAllowUsers")?.map(t=>t?.users).flat()?.map(t=>t.toPeerId())||[],currentAllowedChats:()=>o()?.find(t=>t._==="privacyValueAllowChatParticipants")?.chats?.map(ve)?.filter(t=>t!==void 0)||[]}},x=F("MessagesPrivacyTab"),$e=()=>{const[e]=T(),{isReady:a,globalPrivacy:n,privacyRules:o,currentOption:d,currentAllowedUsers:i,currentAllowedChats:l}=fe(),[s,u,{isPaid:t,hasChanges:v,chosenPeersByType:c}]=ye({isReady:a,globalPrivacy:n,currentOption:d,currentAllowedChats:l,currentAllowedUsers:i}),P=ue({store:s,globalPrivacy:n,isPaid:t,hasChanges:v,chosenPeersByType:c});e.isConfirmationNeededOnClose=re({hasChanges:v,saveAllSettings:P,descriptionLangKey:"UnsavedChangesDescription.Privacy"});const[g,C]=R();return Z&&B(()=>{x("privacyRules() :>> ",o()),x("globalPrivacy() :>> ",n())}),r(U,{get when(){return a()},get children(){return[r(Q,{get mount(){return e.header},get children(){return r(se,{get hasChanges(){return v()},onClick:()=>void P()})}}),r(Pe,{get isPaid(){return t()},store:s,setStore:u,onExitAnimationPromise:C}),r(le,{get isPaid(){return t()},store:s,setStore:u,get chosenPeersByType(){return c()},get exitAnimationPromise(){return g()}})]}})};export{$e as default};
//# sourceMappingURL=tab-EDoPoXx1.js.map
