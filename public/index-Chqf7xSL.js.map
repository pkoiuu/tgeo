{"version":3,"mappings":"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","names":["draw","gl","payload","parameters","initPositionBuffer","width","height","positionBuffer","positions","initTextureBuffer","textureCoordBuffer","textureCoordinates","initShaderProgram","vsSource","fsSource","vertexShader","loadShader","fragmentShader","shaderProgram","log","type","source","shader","weakRefs","r","createVideoForDrawing","mediaSrc","options","currentTime","waitToSeek","muted","video","createVideo","timeout","promise","onMediaLoad","handleVideoLeak","deferred","deferredPromise","e","loadTexture","mediaType","videoTime","middleware","texture","media","image","initWebGL","vertexShaderSource","fragmentShaderSource","__vitePreload","buffers","adjustmentsConfig","uniform","_BrushPainter","targetCanvas","imageCanvas","blurAmount","line","ctx","shouldFinish","points","hexaToRgba","w","h","pointsX","p","pointsY","minX","maxX","minY","maxY","brushFn","i","cx","cy","arrowLength","i2","distance","angle","angle1","angle2","vec1","vec2","animateValue","length","BrushPainter","useNormalizePoint","editorState","useMediaEditorContext","size","createMemo","x","point","transform","useProcessPoint","densityAware","drawAdjustedImage","mediaState","flip","rotation","scale","translation","imageSize","Object","fromEntries","map","key","to100","value","adjustments","BrushCanvas","actions","fullImageGLPayload","setFullImageGLPayload","createSignal","normalizePoint","processPoint","processLine","finalTransform","processedLines","brushDrawnLines","lastLine","setLastLine","canvas","_el$","_tmpl$","_$effect","_p$","_v$","currentTab","_v$2","isAdjusting","_v$3","canvasSize","pixelRatio","_v$4","classList","toggle","t","style","setProperty","removeProperty","a","_$setAttribute","o","undefined","getContext","brushCanvas","fullImageMultiplier","Math","min","fullImageCanvas","_el$2","_tmpl$2","_v$5","_v$6","preserveDrawingBuffer","fullBrushesCanvas","_el$3","_v$7","_v$8","brushPainter","fullBrushPainter","onMount","createMiddleware","get","onCleanup","cleanupWebGl","createEffect","on","setTimeout","redrawFull","redraw","resetLastLine","color","currentBrush","brush","isMoving","clearRect","save","translate","rotate","drawImage","restore","clear","saveLastLine","forEach","drawLine","processLineForFullImage","defaultBlurAmount","redrawBrushes","initialPosition","builtUpDistance","push","pushToHistory","path","newValue","oldValue","HistoryItem","RemoveArrayItem","updateBlurredImage","startSwipe","y","bcr","getBoundingClientRect","left","top","prev","previewLine","selectedResizableLayer","endSwipe","addEventListener","clientX","clientY","touches","swipeHandler","SwipeHandler","element","cursor","onSwipe","xDiff","yDiff","_e","lastPoint","onReset","animateArrowBrush","removeListeners","useCropOffset","getConvenientPositioning","extendCrop","cropOffset","imageWidth","imageHeight","snapToViewport","imageLeftTop","imagePoints","sin","cos","r2","cropWidth","cropHeight","currentImageRatio","cropLeftTop","cropPoints","cropPointsX","cropPointsY","cropMinX","cropMaxX","max","cropMinY","cropMaxY","imageMinX","imageMaxX","imageMinY","imageMaxY","MAX_SCALE","CropHandles","isCropping","leftTop","setLeftTop","leftTopDiff","setLeftTopDiff","setSize","diff","setDiff","withCurrentOwner","_getConvenientPositioning","getNewLeftTopAndSize","cancelSizeAnimation","resetSizeWithAnimation","initialDiff","initialLeftTopDiff","initialLeftTop","initialSize","targetDiff","targetLeftTopDiff","targetLeftTop","targetSize","progress","batch","lerpArray","multipliers","el","leftTopHandle","rightTopHandle","leftBottomHandle","rightBottomHandle","leftHandle","topHandle","rightHandle","bottomHandle","boundDiff","initialScale","initialTranslation","firstTarget","resizeSwipeHandlers","setCursorTo","document","body","onStart","add","target","fixed","fixedImageRatioKey","ratio","minW","minH","xd","Number","halfImageWidth","halfImageHeight","imageCenter","additionalScaleX","additionalScaleY","additionalScale","newWidth","newHeight","newRatio","upScale","targetScale","targetTranslation","modifyMutable","produce","state","lerp","onEnd","remove","translationSwipeHandler","cropArea","resistance","prevTranslation","handler","right","bottom","croppedSizeFull","cw","ch","coverAnimatedStyle","controlsAnimatedStyle","_$p","_$style","background","position","_el$4","_el$5","_el$6","firstChild","_el$7","nextSibling","_el$8","_el$9","_el$10","_el$11","_el$12","_el$13","_el$14","_el$15","_el$16","_el$17","_el$18","_el$19","_ref$","_$use","_ref$2","_ref$3","_ref$4","_ref$5","_ref$6","_ref$7","_ref$8","_ref$9","overflow","n","initVideoPlayback","renderingPayload","pendingSeek","time","flags","SetVideoTimeFlags","seekListener","listener","event","frameCallbackId","playing","skip","frameCallback","animate","clamp","ImageCanvas","ownedDrawAdjustedImage","ownedInitVideoPlayback","init","currentVideoTime","setInitialImageRatio","isReady","createReaction","PreviewBrushSize","_$createComponent","Show","when","previewBrushSize","children","includes","hexToRgb","join","useMediaQuery","query","isMatch","setIsMatch","updateMatch","mediaQueryList","useIsMobile","StickerLayerContent","props","container","wrapSticker","div","doc","layer","sticker","group","play","loop","withThumb","stickersLayersInfo","id","destroy","ResizableContainer","TextLayerContent","textInfo","onFocus","currentTextLayerInfo","fontInfo","fontInfoMap","font","deleteThisLayer","layers","resizableLayers","idx","findIndex","deletedLayer","splice","textRenderingInfo","findBy","updateBackground","contentEditable","childNodes","childNode","HTMLDivElement","hasAttributes","querySelectorAll","node","createTextNode","textContent","replaceWith","createElement","innerHTML","child","range","createRange","sel","window","getSelection","setStart","collapse","removeAllRanges","addRange","selection","rangeCount","getRangeAt","startContainer","startOffset","innerDiv","innerDivRange","selectNodeContents","querySelector","lines","getLinesRenderingInfo","alignment","createTextBackgroundPath","updateBackgroundStyle","updateOutlineStyle","clientWidth","clientHeight","selectAll","isThisLayerSelected","innerText","trim","preventDefault","getContrastColor","intialContent","layerInfo","_$insert","content","i18n","$$input","fontFamily","fontWeight","flexAlignMap","linesContainer","Array","from","_child","offset","first","rounding","arcParams","s","prevPosition","prevY","diffSign","abs","currentRounding","last","info","svg","createElementFromMarkup","prepend","updateSvg","stretch","baseline","bgDiv","center","_$delegateEvents","ResizableLayers","context","isTextTab","canClick","moveSelectedLayerOnTop","addLayer","newResizableLayer","resizableLayersSeed","_$addEventListener","For","each","isMobile","handleTyping","store","createMutable","containerWidth","containerHeight","leftTopEl","rightTopEl","leftBottomEl","rightBottomEl","circleOffset","canShowHandles","resizeHandlesContainer","processedLayer","useResizeHandles","useContextMenu","unobserve","observeResize","$$click","_c$","_$memo","Portal","mount","_tmpl$3","_v$9","_v$10","_v$11","_v$12","PI","_v$13","_v$14","_v$15","_v$16","_v$17","_v$18","_v$19","_v$20","d","l","u","c","swipeStarted","_","__","getEvent","initialVector","resizedVector","rotationFromHorizon","atan2","hypot","moveHandler","find","onClick","otherLayer","contextMenu","createContextMenu","buttons","icon","className","text","listenTo","onElementReady","animateToNewRotationOrRatio","newRotation","snappedRotation90","isReversedRatio","snappedRotation","parts","originalRatio","w1","h1","w2","h2","initialRotation","targetRotation","DEGREE_DIST_PX","DEGREE_STEP","TOTAL_DEGREES_SIDE","MAX_DEGREES_DIST_PX","SNAP_DIST_PX","rotationFromMove","amount","RotationWheel","moved","setMoved","movedDiff","setMovedDiff","swiperEl","round","prevRotation","currentDiff","prevShouldSnap","getShouldSnap","isAnimating","isSnapped","cancelAnimation","timeoutId","handleDiffChange","removeSnapAfterTimeout","shouldSnap","clearTimeout","newMoved","rotationFromSwiper","rotationDiff","resetWheelWithAnimation","values","resetRotationWheel","isFirstEffect","rotateLeft","flipImage","snapTo1","targetFlip","toFixed","replace","ButtonIconTsx","fill","ArrowUp","_tmpl$4","useFinalTransform","cropTabAnimationProgress","setCropTabAnimationProgress","cancel","prevCanvasSize","setPrevCanvasSize","prevCropTranslation","setPrevCropTranslation","prevAdditionalScale","setPrevAdditionalScale","additionalImageScales","imageRatio","toCropScale","getSnappedViewportsScale","fromCroppedScale","snappedImageScale","cropTrnsl","cropTranslation","prevScale","updatePrevValues","prevSize","currentSize","currentAdditionalScale","scaleToChange","counterScale","totalScale","v","eventsMap","registerGlobalDocumentEvent","eventName","callback","clb","useGlobalDocumentEvent","cleanup","swipe","args","isDragging","initialX","initialY","getDiffPointer","getDiffTouch","handleStart","globalCursor","handleMove","onMove","handleEnd","useVideoControlsCanvas","getCanvas","cleaned","chunkWidth","chunkHeight","fade","styles","HANDLE_WIDTH_PX","MOVE_ACTIVATION_THRESHOLD_PX","VideoControls","cropper","setCropper","isDraggingSomething","setIsDraggingSomething","cropperSize","useElementSize","strippedWidth","shouldShowTime","swiping","formattedResultingTime","totalSeconds","videoCropLength","duration","ts","hh","floor","padStart","mm","ss","decimal","minLength","initialStart","initialLength","leftHandleSwipeArgs","videoCropStart","isPlaying","setVideoTime","rightHandleSwipeArgs","maxLength","canMove","middleSwipeArgs","handleCursorMove","startDiff","self","cursorSwipeArgs","getPositionInCropper","onMiddlePartClick","showMutedTooltip","showTooltip","mountOn","parentElement","vertical","textElement","lighter","auto","closeTooltip","videoMuted","currentTarget","close","ripple","IconTsx","TimeStick","ThumbnailTrack","hidden","PausePlay","paused","Container","changed","InnerContainer","IconButton","MuteButton","Frames","Cropper","Images","CropperBg","CropperBgLeft","CropperBgRight","CropperHorizontalBorder","dragging","CropperHandle","CropperHandleLeft","CropperHandleRight","CroppedTime","_v$21","visible","_v$22","PlayButton","_v$23","PlayButtonInner","_$className","_$classList","m","f","g","b","T","A","O","ghostThumbnailPosition","setGhostThumbnailPosition","setIsDragging","isGhostThumbnailVisible","isNaN","videoThumbnailPosition","canPreviewFrame","previewFrameTimeout","onPointerMove","UpdateVideo","Redraw","onPointerOut","swipeArgs","ThumbnailMark","withTransition","ghost","$$touchend","$$pointerout","$$touchmove","$$pointermove","_v$24","_v$25","disabled","_v$26","_v$27","_v$28","_tmpl$5","_el$20","_el$21","_el$22","_el$23","_el$24","_v$29","PausePlaySvg","_v$30","_v$31","PausePlaySvgPlay","_v$32","PausePlaySvgPause","_v$33","PausePlaySvgPauseLeft","_v$34","PausePlaySvgPauseRight","TouchEvent","changedTouches","pos","MainCanvas","removeEventListener","SIDE_MAX","SIDE_MIN","getResultSize","videoType","quality","scaledWidth","scaledHeight","willResultInVideo","defaultCodec","highResCodec","getResultTransform","initialCanvasWidth","initialCanvasHeight","canvasRatio","snappedCanvasWidth","snappedCanvasHeight","getScaledLayersAndLines","scaledLines","scaledLayers","layerStore","unwrap","FRAMES_PER_SECOND","STICKER_SIZE","drawStickerLayer","drawTextLayer","renderingInfo","multiply","newPath","part","boxLeft","yOffset","xOffset","generateVideoPreview","previewWidth","previewHeight","mirrorCanvas","previewCanvas","previewCtx","mirrorCtx","stickerChild","resolve","ImageStickerFrameByFrameRenderer","blob","appDownloadManager","LottieStickerFrameByFrameRenderer","animation","lottieLoader","frame","VideoStickerFrameByFrameRenderer","getMiddleware","apiManagerProxy","delay","IS_FIREFOX","EXPECTED_FPS","VIDEO_COMPARISON_ERROR","THUMBNAIL_MAX_SIZE","logger","renderToActualVideo","hasAnimatedStickers","drawToImageCanvas","resultCanvas","mediaBlob","owner","getOwner","startTime","endTime","creationProgress","createRoot","dispose","setProgress","renderers","thumbnailCanvas","thumbnailCtx","thumbnailTime","currentVideoFrameDeferred","encodingPausedDeferred","lastTime","drewThumbnail","canceled","progressRAF","listenerSetter","ListenerSetter","initMuxerAndEncoder","Muxer","ArrayBufferTarget","audioBuffer","supportsAudioEncoding","extractAudioFragment","muxer","encoder","chunk","meta","calcCodecAndBitrate","BITRATE_TARGET_FPS","drawToTexture","initStickerRenderers","stickerType","renderer","ThrowReason","ThrowReason2","prepareAndRenderFrame","frameNo","mediaTime","untilFrame","renderFrame","timestamp","appendToMuxer","promises","videoFrame","updateProgress","targetProgress","currentProgress","delta","preview","runWithOwner","resultPromise","reject","firstFrameSeekDeferred","done","encodeAndMuxAudio","buffer","thumbBlob","MediaSize","result","noop","audioContext","arrayBuffer","fullAudioBuffer","sampleRate","startSample","endSample","frameCount","numChannels","fragmentBuffer","fullData","onChunk","totalFrames","interleaved","channelData","audioData","renderToImage","renderToVideoGIF","maxFrames","spawnAnimatedPreview","previewBlob","animatedImg","createFinalResult","checkIfHasAnimatedStickers","maxHeight","maxQuality","snapToAvailableQuality","renderResult","animatedPreview","FinishButton","hasModifications","RangeInput","normalizedValue","nMap","mappedCenter","brightShadow","hexaToHsla","prevValue","ref","label","onChangeFinish","valueAsNumber","onChange","passiveLabel","StepInput","stepIndex","steps","step","isActive","createSelector","isSelected","index","ADJUST_TIMEOUT","AdjustmentsTab","mediaSize","removeIsAdjusting","resultingSize","debugResultingSize","console","maxVideoQuality","availableQualityHeights","filter","canShowQualityInput","Space","videoQuality","item","setContainer","showGhost","setShowGhost","setValue","append","removeGhost","currentValue","config","mediaEditorTabsOrder","Tabs","underline","tabs","onTabClick","tab","containerBR","targetBR","TabContentContext","createContext","TabContent","scrollAmount","setScrollAmount","prevElement","prevTab","scrollable","toRight","indexOf","newElement","Provider","setScrollable","cls","action","modifier","doubleRaf","initialTab","Scrollable","setListeners","onScroll","scrollTop","onContainer","StickersTab","wrapStickerSetThumb","EmoticonsSearch","useHotReloadGuard","useContext","managers","recentStickers","createResource","appStickersManager","getRecentStickersStickers","stickerSets","getAllStickers","filteredStickers","setFilteredStickers","search","setSearch","setGroup","activeSet","setActiveSet","scrolling","setScrolling","intersectionObserver","setIntersectionObserver","recentLabel","setRecentLabel","lazyLoadQueue","LazyLoadQueue","stickerRenderer","SuperStickerRenderer","regularLazyLoadQueue","intersectionObserverInit","root","withLock","onStickerSetThumbClick","String","scrollIntoView","behavior","block","StickerSetThumb","renderContainer","autoplay","set","textColor","Sticker","renderSticker","observeAnimated","newLayer","StickerSetLabel","observe","wrapEmojiText","title","StickerSetSection","stickers","getStickerSet","documents","ThumbList","thumbsListScrollable","ScrollableX","_tmpl$6","sets","IntersectionObserver","entries","entry","isIntersecting","dataset","setId","rootMargin","disconnect","searchStickers","getPremiumStickers","getStickersByEmoticon","emoticon","emoticons","includeServerStickers","_tmpl$7","onValue","onGroup","categoryColor","animatedItemGroup","_tmpl$8","PenBrush","ArrowBrush","MarkerBrush","NeonBrush","EraserBrush","BlurBrush","colorPickerSwatches","PICKER_WIDTH_PX","PICKER_HEIGHT_PX","SLIDER_WIDTH_PX","DEFAULT_SIZE_PX","ColorPicker","collapsed","setCollapsed","collapsing","setCollapsing","containerSize","setContainerSize","sizeContainer","swatch","hexColor","onCollapseToggle","previousColor","colorPicker","_ColorPicker","buildLayout","slider","pickerBox","hexInput","rgbInput","pickerBoxWidth","pickerBoxHeight","sliderWidth","thickSlider","hex","abortDrawerSlide","observer","ResizeObserver","colorKey","newCollapsed","then","getCurrentColor","setColor","createStoredColor","defaultColor","savedColor","setSavedColor","fallback","LargeButton","_$spread","_$mergeProps","active","class","BrushTab","savedBrushColors","pen","arrow","neon","savedBrushSignal","updateCurrentBrush","brushButton","brushSvg","hasColor","removeSizePreview","previous","transition","ratioRects","1x1","3x2","4x3","5x4","7x5","16x9","ratioIcon","rotated","Item","inProps","buttonProps","splitProps","CropTab","what","onRatioClick","_tmpl$9","TextTab","untrack","setAlignment","setStyle","toggleButton","fontButton","textFont","Topbar","doneButton","processHistory","history","otherHistory","pop","processHistoryItem","onUndo","redoHistory","onRedo","removeListener","addShortcutListener","combo","onClose","onFinish","Toolbar","toolbar","move","setMove","isCollapsed","setIsCollapsed","setContainerHeight","extraMove","setExtraMove","shouldHide","setShouldHide","startY","isAborted","isResetting","resetMove","startDrag","dragMove","dragEnd","initialMove","initialExtraMove","targetExtraMove","totalMove","crop","MediaEditor","contextValue","createContextValue","overlay","navigationItem","onPop","handleClose","appNavigationController","pushItem","focus","removeItem","onCanvasReady","onImageRendered","performClose","hasGif","finished","confirmationPopup","description","button","isFinishing","MediaEditorContext","handleFinish","finally","onEditFinish","isVideo","openMediaEditor","HotReloadGuardProvider","render","openMediaEditorFromMedia","editingMediaState","animatedCanvas","sourceWidth","sourceHeight","canvasBcr","leftDiff","topDiff","SolidJSHotReloadGuardProvider"],"ignoreList":[],"sources":["../src/components/mediaEditor/webgl/draw.ts","../src/components/mediaEditor/webgl/initBuffers.ts","../src/components/mediaEditor/webgl/initShaderProgram.ts","../src/components/mediaEditor/canvas/createVideoForDrawing.ts","../src/components/mediaEditor/webgl/loadTexture.ts","../src/components/mediaEditor/webgl/initWebGL.ts","../src/components/mediaEditor/canvas/brushPainter.ts","../src/components/mediaEditor/canvas/useNormalizePoint.ts","../src/components/mediaEditor/canvas/useProcessPoint.ts","../src/components/mediaEditor/canvas/brushCanvas.tsx","../src/components/mediaEditor/canvas/useCropOffset.ts","../src/components/mediaEditor/canvas/getConvenientPositioning.tsx","../src/components/mediaEditor/canvas/cropHandles.tsx","../src/components/mediaEditor/canvas/initVideoPlayback.ts","../src/components/mediaEditor/canvas/imageCanvas.tsx","../src/components/mediaEditor/canvas/previewBrushSize.tsx","../src/components/mediaEditor/useIsMobile.ts","../src/components/mediaEditor/canvas/stickerLayerContent.tsx","../src/components/mediaEditor/canvas/textLayerContent.tsx","../src/components/mediaEditor/canvas/resizableLayers.tsx","../src/components/mediaEditor/canvas/animateToNewRotationOrRatio.ts","../src/components/mediaEditor/canvas/rotationWheel.tsx","../src/components/mediaEditor/canvas/useFinalTransform.ts","../src/helpers/useGlobalDocumentEvent.ts","../src/helpers/useSwipe.ts","../src/components/mediaEditor/canvas/useVideoControlsCanvas.ts","../src/components/mediaEditor/canvas/videoControls.tsx","../src/components/mediaEditor/canvas/mainCanvas.tsx","../src/components/mediaEditor/finalRender/getResultSize.ts","../src/components/mediaEditor/finalRender/getResultTransform.ts","../src/components/mediaEditor/finalRender/getScaledLayersAndLines.ts","../src/components/mediaEditor/finalRender/constants.ts","../src/components/mediaEditor/finalRender/drawStickerLayer.ts","../src/components/mediaEditor/finalRender/drawTextLayer.ts","../src/components/mediaEditor/finalRender/generateVideoPreview.ts","../src/components/mediaEditor/finalRender/imageStickerFrameByFrameRenderer.ts","../src/components/mediaEditor/finalRender/lottieStickerFrameByFrameRenderer.ts","../src/components/mediaEditor/finalRender/videoStickerFrameByFrameRenderer.ts","../src/components/mediaEditor/finalRender/renderToActualVideo.ts","../src/components/mediaEditor/finalRender/renderToImage.ts","../src/components/mediaEditor/finalRender/renderToVideoGIF.ts","../src/components/mediaEditor/finalRender/spawnAnimatedPreview.ts","../src/components/mediaEditor/finalRender/createFinalResult.ts","../src/components/mediaEditor/finishButton.tsx","../src/components/mediaEditor/rangeInput.tsx","../src/components/mediaEditor/stepInput.tsx","../src/components/mediaEditor/tabs/adjustmentsTab.tsx","../src/components/mediaEditor/tabs/tabs.tsx","../src/components/mediaEditor/tabs/tabContent.tsx","../src/components/mediaEditor/tabs/stickersTab.tsx","../src/components/mediaEditor/brushesSvg.tsx","../src/components/mediaEditor/colorPicker.tsx","../src/components/mediaEditor/createStoredColor.ts","../src/components/mediaEditor/largeButton.tsx","../src/components/mediaEditor/tabs/brushTab.tsx","../src/components/mediaEditor/tabs/cropTab.tsx","../src/components/mediaEditor/tabs/textTab.tsx","../src/components/mediaEditor/topbar.tsx","../src/components/mediaEditor/toolbar.tsx","../src/components/mediaEditor/mediaEditor.tsx","../src/components/mediaEditor/index.ts"],"sourcesContent":["import {AdjustmentKey} from '../adjustments';\nimport {NumberPair} from '../types';\n\nimport {RenderingPayload} from './initWebGL';\n\n\ntype DrawingParameters = {\n  rotation: number;\n  scale: number;\n  translation: NumberPair;\n  imageSize: NumberPair;\n  flip: NumberPair;\n} & Record<AdjustmentKey, number>;\n\nexport function draw(gl: WebGLRenderingContext, payload: RenderingPayload, parameters: DrawingParameters) {\n  gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);\n\n  gl.clearColor(0.0, 0.0, 0.0, 1.0);\n  gl.clear(gl.COLOR_BUFFER_BIT);\n\n  gl.bindBuffer(gl.ARRAY_BUFFER, payload.buffers.position);\n  gl.vertexAttribPointer(payload.attribs.vertexPosition, 2, gl.FLOAT, false, 0, 0);\n  gl.enableVertexAttribArray(payload.attribs.vertexPosition);\n\n  gl.bindBuffer(gl.ARRAY_BUFFER, payload.buffers.texture);\n  gl.vertexAttribPointer(payload.attribs.textureCoord, 2, gl.FLOAT, false, 0, 0);\n  gl.enableVertexAttribArray(payload.attribs.textureCoord);\n\n  gl.useProgram(payload.program);\n\n  gl.activeTexture(gl.TEXTURE0);\n  gl.bindTexture(gl.TEXTURE_2D, payload.texture);\n  gl.uniform1i(payload.uniforms.uSampler, 0);\n\n  gl.uniform1f(payload.uniforms.uAngle, -parameters.rotation);\n  gl.uniform2f(payload.uniforms.uResolution, gl.canvas.width, gl.canvas.height);\n  gl.uniform1f(payload.uniforms.uScale, parameters.scale);\n  gl.uniform2fv(payload.uniforms.uTranslation, parameters.translation);\n  gl.uniform2fv(payload.uniforms.uImageSize, parameters.imageSize);\n  gl.uniform2fv(payload.uniforms.uFlip, parameters.flip);\n\n  gl.uniform1f(payload.uniforms.uSaturation, parameters.saturation);\n  gl.uniform1f(payload.uniforms.uBrightness, parameters.brightness);\n  gl.uniform1f(payload.uniforms.uContrast, parameters.contrast);\n  gl.uniform1f(payload.uniforms.uWarmth, parameters.warmth);\n  gl.uniform1f(payload.uniforms.uFade, parameters.fade);\n  gl.uniform1f(payload.uniforms.uShadows, parameters.shadows);\n  gl.uniform1f(payload.uniforms.uHighlights, parameters.highlights);\n  gl.uniform1f(payload.uniforms.uVignette, parameters.vignette);\n  gl.uniform1f(payload.uniforms.uGrain, parameters.grain);\n  gl.uniform1f(payload.uniforms.uSharpen, parameters.sharpen);\n  gl.uniform1f(payload.uniforms.uEnhance, parameters.enhance);\n\n  gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n}\n","export function initPositionBuffer(gl: WebGLRenderingContext, width: number, height: number) {\n  const positionBuffer = gl.createBuffer();\n  gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);\n\n  const positions = [0, 0, width, 0, 0, height, width, height];\n  gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(positions), gl.STATIC_DRAW);\n\n  return positionBuffer;\n}\n\nexport function initTextureBuffer(gl: WebGLRenderingContext) {\n  const textureCoordBuffer = gl.createBuffer();\n  gl.bindBuffer(gl.ARRAY_BUFFER, textureCoordBuffer);\n\n  const textureCoordinates = [0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 1.0, 1.0];\n  gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(textureCoordinates), gl.STATIC_DRAW);\n\n  return textureCoordBuffer;\n}\n","import {log} from '../utils';\n\nexport function initShaderProgram(gl: WebGLRenderingContext, vsSource: string, fsSource: string) {\n  const vertexShader = loadShader(gl, gl.VERTEX_SHADER, vsSource);\n  const fragmentShader = loadShader(gl, gl.FRAGMENT_SHADER, fsSource);\n\n  const shaderProgram = gl.createProgram();\n  gl.attachShader(shaderProgram, vertexShader);\n  gl.attachShader(shaderProgram, fragmentShader);\n  gl.linkProgram(shaderProgram);\n\n  if(!gl.getProgramParameter(shaderProgram, gl.LINK_STATUS)) {\n    log.error(`Unable to initialize the shader program: ${gl.getProgramInfoLog(shaderProgram)}`);\n    return null;\n  }\n\n  return shaderProgram;\n}\n\nfunction loadShader(gl: WebGLRenderingContext, type: GLenum, source: string) {\n  const shader = gl.createShader(type);\n\n  gl.shaderSource(shader, source);\n  gl.compileShader(shader);\n\n  if(!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n    log.error(`An error occurred compiling the shaders: ${gl.getShaderInfoLog(shader)}`);\n    gl.deleteShader(shader);\n    return null;\n  }\n\n  return shader;\n}\n","import deferredPromise from '../../../helpers/cancellablePromise';\nimport createVideo from '../../../helpers/dom/createVideo';\nimport handleVideoLeak from '../../../helpers/dom/handleVideoLeak';\nimport {Middleware} from '../../../helpers/middleware';\nimport onMediaLoad from '../../../helpers/onMediaLoad';\n\n\ntype Options = {\n  /**\n   * [0, 1] will be multiplied by duration\n   */\n  currentTime?: number;\n  muted?: boolean;\n  waitToSeek?: boolean;\n  middleware?: Middleware;\n};\n\nconst weakRefs: WeakRef<any>[] = [];\n\n\n// TODO: The video nodes themselves remain references somewhere, but they're src is cleaned up WTF\n(window as any).derefMediaEditorVideos = () => {\n  console.log('Dereffed weak refs ::>> ', weakRefs.map(r => r.deref()));\n}\n\nexport default async function createVideoForDrawing(mediaSrc: string, options: Options = {}) {\n  const currentTime = options.currentTime ?? 0;\n  const waitToSeek = options.waitToSeek ?? true;\n  const muted = options.muted ?? true;\n\n  const video = createVideo({pip: false, middleware: options.middleware});\n  video.src = mediaSrc;\n  video.autoplay = true;\n  video.controls = false;\n  video.muted = true; // prevent sound playing while we're waiting for metadata\n\n  weakRefs.push(new WeakRef(video));\n\n  let timeout: number;\n\n  video.addEventListener('timeupdate', () => {\n    video.pause();\n  }, {once: true});\n\n  // Theoretically we should not have any errors here as this is handled in the media popup\n  try {\n    const promise = onMediaLoad(video);\n    await handleVideoLeak(video, promise);\n\n    if(waitToSeek) {\n      const deferred = deferredPromise<void>();\n      video.addEventListener('seeked', () => void deferred.resolve(), {once: true});\n      timeout = self.setTimeout(() => deferred.resolve(), 500); // just in case\n\n      video.currentTime = video.duration * currentTime;\n\n      await deferred;\n      self.clearTimeout(timeout);\n    }\n  } catch(e) {\n    console.error(e);\n  }\n\n\n  if(!muted) video.muted = false;\n\n  return video;\n}\n","import deferredPromise from '../../../helpers/cancellablePromise';\nimport {Middleware} from '../../../helpers/middleware';\nimport createVideoForDrawing from '../canvas/createVideoForDrawing';\nimport {MediaType} from '../types';\n\n\ntype LoadTextureArgs = {\n  gl: WebGLRenderingContext;\n  mediaSrc: string;\n  mediaType: MediaType;\n  videoTime: number;\n  waitToSeek?: boolean;\n\n  middleware?: Middleware;\n};\n\ntype LoadTextureMedia = {\n  width: number;\n  height: number;\n  image?: HTMLImageElement;\n  video?: HTMLVideoElement;\n};\n\ntype LoadTextureResult = {\n  texture: WebGLTexture;\n  media: LoadTextureMedia;\n};\n\nexport async function loadTexture({gl, mediaSrc, mediaType, videoTime, waitToSeek, middleware}: LoadTextureArgs): Promise<LoadTextureResult> {\n  const texture = gl.createTexture();\n  gl.bindTexture(gl.TEXTURE_2D, texture);\n\n  let media: LoadTextureMedia;\n\n  if(mediaType === 'image') {\n    const image = new Image();\n    image.src = mediaSrc;\n\n    const deferred = deferredPromise<void>();\n    image.addEventListener('load', () => void deferred.resolve());\n    await deferred;\n\n    media = {\n      image,\n      width: image.naturalWidth,\n      height: image.naturalHeight\n    };\n  } else {\n    const video = await createVideoForDrawing(mediaSrc, {currentTime: videoTime, waitToSeek, middleware});\n\n    media = {\n      video,\n      width: video.videoWidth,\n      height: video.videoHeight\n    };\n  }\n\n  gl.bindTexture(gl.TEXTURE_2D, texture);\n  gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, media.video || media.image);\n\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n\n  return {media, texture};\n}\n","import {Middleware} from '../../../helpers/middleware';\nimport {adjustmentsConfig, AdjustmentsConfig} from '../adjustments';\nimport {MediaType} from '../types';\n\nimport {initPositionBuffer, initTextureBuffer} from './initBuffers';\nimport {initShaderProgram} from './initShaderProgram';\nimport {loadTexture} from './loadTexture';\n\nexport type RenderingPayload = Awaited<ReturnType<typeof initWebGL>>;\n\ntype InitWebGLArgs = {\n  gl: WebGLRenderingContext;\n  mediaSrc: string;\n  mediaType: MediaType;\n  videoTime: number;\n  waitToSeek?: boolean;\n\n  middleware?: Middleware;\n};\n\nexport async function initWebGL({gl, mediaSrc, mediaType, videoTime, waitToSeek, middleware}: InitWebGLArgs) {\n  const [{vertexShaderSource, fragmentShaderSource}, {texture, media}] = await Promise.all([\n    import('./shaderSources'),\n    loadTexture({gl, mediaSrc, mediaType, videoTime, waitToSeek, middleware})\n  ]);\n\n  const shaderProgram = initShaderProgram(gl, vertexShaderSource, fragmentShaderSource);\n\n  const buffers = {\n    position: initPositionBuffer(gl, media.width, media.height),\n    texture: initTextureBuffer(gl)\n  };\n\n  return {\n    program: shaderProgram,\n    buffers,\n    media,\n    texture,\n    attribs: {\n      vertexPosition: gl.getAttribLocation(shaderProgram, 'aVertexPosition'),\n      textureCoord: gl.getAttribLocation(shaderProgram, 'aTextureCoord')\n    },\n    uniforms: {\n      uSampler: gl.getUniformLocation(shaderProgram, 'uSampler'),\n      uFlip: gl.getUniformLocation(shaderProgram, 'uFlip'),\n      uAngle: gl.getUniformLocation(shaderProgram, 'uAngle'),\n      uResolution: gl.getUniformLocation(shaderProgram, 'uResolution'),\n      uTranslation: gl.getUniformLocation(shaderProgram, 'uTranslation'),\n      uScale: gl.getUniformLocation(shaderProgram, 'uScale'),\n      uImageSize: gl.getUniformLocation(shaderProgram, 'uImageSize'),\n      ...(Object.fromEntries(\n        adjustmentsConfig.map(({uniform}) => [uniform, gl.getUniformLocation(shaderProgram, uniform)])\n      ) as Record<AdjustmentsConfig[number]['uniform'], WebGLUniformLocation>)\n    }\n  };\n}\n","import deferredPromise from '../../../helpers/cancellablePromise';\nimport {hexaToRgba} from '../../../helpers/color';\n\nimport {NumberPair} from '../types';\nimport {animateValue, delay, distance} from '../utils';\n\nexport type BrushDrawnLine = {\n  color: string;\n  brush: string;\n  size: number;\n  points: NumberPair[];\n};\n\ntype BrushPainterOptions = {\n  targetCanvas: HTMLCanvasElement;\n  imageCanvas: HTMLCanvasElement;\n  blurAmount?: number;\n};\n\nexport default class BrushPainter {\n  private imageCanvas: HTMLCanvasElement;\n  private cacheCanvas: HTMLCanvasElement;\n  private blurredImageCanvas: HTMLCanvasElement;\n  private blurredLineCanvas: HTMLCanvasElement;\n\n  private targetCtx: CanvasRenderingContext2D;\n  private cacheCtx: CanvasRenderingContext2D;\n  private blurredImageCtx: CanvasRenderingContext2D;\n  private blurredLineCtx: CanvasRenderingContext2D;\n\n  private width: number;\n  private height: number;\n\n  private blurAmount: number;\n\n  static defaultBlurAmount = 10;\n\n  constructor({targetCanvas, imageCanvas, blurAmount = BrushPainter.defaultBlurAmount}: BrushPainterOptions) {\n    this.targetCtx = targetCanvas.getContext('2d');\n    this.imageCanvas = imageCanvas;\n    this.blurAmount = blurAmount;\n\n    this.cacheCanvas = document.createElement('canvas');\n    this.blurredImageCanvas = document.createElement('canvas');\n    this.blurredLineCanvas = document.createElement('canvas');\n\n    this.width =\n      this.cacheCanvas.width =\n      this.blurredImageCanvas.width =\n      this.blurredLineCanvas.width =\n        targetCanvas.width;\n    this.height =\n      this.cacheCanvas.height =\n      this.blurredImageCanvas.height =\n      this.blurredLineCanvas.height =\n        targetCanvas.height;\n\n    this.cacheCtx = this.cacheCanvas.getContext('2d');\n    this.blurredImageCtx = this.blurredImageCanvas.getContext('2d');\n    this.blurredLineCtx = this.blurredLineCanvas.getContext('2d');\n  }\n\n  previewLine(line: BrushDrawnLine, shouldFinish = false) {\n    this.targetCtx.clearRect(0, 0, this.width, this.height);\n\n    this.targetCtx.drawImage(this.cacheCanvas, 0, 0);\n    const brushFn = this.brushes[line.brush];\n    this.targetCtx.save();\n    brushFn(line, this.targetCtx, shouldFinish);\n    this.targetCtx.restore();\n  }\n\n  saveLastLine() {\n    this.cacheCtx.clearRect(0, 0, this.width, this.height);\n    this.cacheCtx.drawImage(this.targetCtx.canvas, 0, 0);\n    this.updateBlurredImage();\n  }\n\n  updateBlurredImage() {\n    this.blurredImageCtx.clearRect(0, 0, this.width, this.height);\n    this.blurredImageCtx.filter = `blur(${this.blurAmount}px)`;\n    this.blurredImageCtx.drawImage(this.imageCanvas, 0, 0, this.width, this.height);\n\n    this.blurredImageCtx.drawImage(this.cacheCanvas, 0, 0);\n  }\n\n  drawLine(line: BrushDrawnLine) {\n    this.previewLine(line, true);\n    this.saveLastLine();\n  }\n\n  clear() {\n    this.targetCtx.clearRect(0, 0, this.width, this.height);\n    this.cacheCtx.clearRect(0, 0, this.width, this.height);\n  }\n\n  private drawLinePath(line: BrushDrawnLine, ctx: CanvasRenderingContext2D) {\n    const {points} = line;\n    if(!points.length) return;\n\n    if(points.length === 1) {\n      ctx.fillStyle = ctx.strokeStyle;\n      ctx.beginPath();\n      ctx.arc(points[0][0], points[0][1], line.size / 2, 0, 2 * Math.PI);\n      ctx.fill();\n      return;\n    }\n\n    ctx.lineWidth = line.size;\n    ctx.lineCap = 'round';\n    ctx.lineJoin = 'round';\n\n    ctx.beginPath();\n    ctx.moveTo(points[0][0], points[0][1]);\n\n    for(let i = 1; i < points.length - 2; i++) {\n      const cx = (points[i][0] + points[i + 1][0]) / 2;\n      const cy = (points[i][1] + points[i + 1][1]) / 2;\n      ctx.quadraticCurveTo(points[i][0], points[i][1], cx, cy);\n    }\n\n    const i = points.length - 1;\n    ctx.quadraticCurveTo(points[i - 1][0], points[i - 1][1], points[i][0], points[i][1]);\n\n    ctx.stroke();\n  }\n\n  private getArrowHeadLength(line: BrushDrawnLine) {\n    return Math.sqrt(line.size) + line.size * 2.5;\n  }\n\n  private drawArrowHead(ctx: CanvasRenderingContext2D, line: BrushDrawnLine, arrowLength: number) {\n    const {points} = line;\n    if(points.length < 2) return;\n\n    const i = points.length - 1;\n\n    let i2 = i;\n    for(; i2 > 0; i2--) {\n      if(distance(points[i], points[i2]) > line.size * 0.5) break;\n    }\n\n    const angle = Math.atan2(points[i][0] - points[i2][0], points[i][1] - points[i2][1]) + Math.PI;\n\n    const angle1 = angle + Math.PI / 4;\n    const angle2 = angle - Math.PI / 4;\n\n    const vec1 = [arrowLength * Math.sin(angle1), arrowLength * Math.cos(angle1)];\n    const vec2 = [arrowLength * Math.sin(angle2), arrowLength * Math.cos(angle2)];\n\n    ctx.strokeStyle = line.color;\n    ctx.lineWidth = line.size;\n    ctx.lineCap = 'round';\n    ctx.lineJoin = 'round';\n\n    ctx.beginPath();\n    ctx.moveTo(points[i][0], points[i][1]);\n    ctx.lineTo(points[i][0] + vec1[0], points[i][1] + vec1[1]);\n    ctx.moveTo(points[i][0], points[i][1]);\n    ctx.lineTo(points[i][0] + vec2[0], points[i][1] + vec2[1]);\n    ctx.stroke();\n  }\n\n  async animateArrowBrush(line: BrushDrawnLine) {\n    const {points} = line;\n    if(points.length < 2) return;\n\n    const ctx = this.targetCtx;\n\n    const arrowLength = this.getArrowHeadLength(line);\n\n    const deferred = deferredPromise<void>();\n    animateValue(0.1, arrowLength, 120, (length) => this.drawArrowHead(ctx, line, length), {\n      onEnd: () => deferred.resolve()\n    });\n    await deferred;\n  }\n\n  private brushes: Record<\n    string,\n    (line: BrushDrawnLine, ctx: CanvasRenderingContext2D, shouldFinish: boolean) => void\n  > = {\n      pen: (line, ctx) => {\n        ctx.strokeStyle = line.color;\n        this.drawLinePath(line, ctx);\n      },\n      arrow: (line, ctx, shouldFinish) => {\n        const {points} = line;\n\n        ctx.strokeStyle = line.color;\n        this.drawLinePath(line, ctx);\n\n        if(!shouldFinish) return;\n        if(points.length < 2) return;\n\n        this.drawArrowHead(ctx, line, this.getArrowHeadLength(line));\n      },\n      brush: (line, ctx) => {\n        ctx.strokeStyle = `rgba(${hexaToRgba(line.color).join(',')},0.4)`;\n        this.drawLinePath(line, ctx);\n      },\n      neon: (line, ctx) => {\n        ctx.strokeStyle = '#ffffff';\n        ctx.shadowBlur = line.size;\n        ctx.shadowColor = line.color;\n        this.drawLinePath(line, ctx);\n      },\n      blur: (line, ctx) => {\n        const w = ctx.canvas.width,\n          h = ctx.canvas.height;\n\n        this.blurredLineCtx.clearRect(0, 0, w, h);\n\n        const {points} = line;\n        const pointsX = points.map((p) => p[0]);\n        const pointsY = points.map((p) => p[1]);\n        const minX = Math.max(Math.min(...pointsX) - line.size, 0),\n          maxX = Math.max(...pointsX) + line.size,\n          minY = Math.max(Math.min(...pointsY) - line.size, 0),\n          maxY = Math.max(...pointsY) + line.size;\n\n        this.blurredLineCtx.strokeStyle = 'white';\n        this.drawLinePath(line, this.blurredLineCtx);\n\n        this.blurredLineCtx.globalCompositeOperation = 'source-in';\n        this.blurredLineCtx.drawImage(this.blurredImageCanvas, 0, 0);\n\n        ctx.drawImage(this.blurredLineCanvas, minX, minY, maxX, maxY, minX, minY, maxX, maxY);\n        this.blurredLineCtx.globalCompositeOperation = 'source-over';\n      },\n      eraser: (line, ctx) => {\n        ctx.strokeStyle = 'white';\n        ctx.globalCompositeOperation = 'destination-out';\n        this.drawLinePath(line, ctx);\n        ctx.stroke();\n        ctx.globalCompositeOperation = 'source-over';\n      }\n    };\n}\n","import {createMemo} from 'solid-js';\n\nimport {useMediaEditorContext} from '../context';\nimport {NumberPair} from '../types';\n\n\nexport default function useNormalizePoint() {\n  const {editorState} = useMediaEditorContext();\n\n  const size = createMemo(() => editorState.canvasSize.map((x) => x * editorState.pixelRatio));\n\n  return (point: NumberPair) => {\n    const transform = editorState.finalTransform;\n    const [w, h] = size();\n\n    point = point.map((x) => x * editorState.pixelRatio) as NumberPair;\n\n    point = [\n      (point[0] - transform.translation[0] - w / 2) / transform.scale,\n      (point[1] - transform.translation[1] - h / 2) / transform.scale\n    ];\n    const r = [Math.sin(transform.rotation), Math.cos(transform.rotation)];\n    point = [point[0] * r[1] + point[1] * r[0], point[1] * r[1] - point[0] * r[0]];\n    return point;\n  };\n}\n","import {createMemo} from 'solid-js';\n\nimport {useMediaEditorContext} from '../context';\nimport {NumberPair} from '../types';\n\nexport default function useProcessPoint(densityAware = true) {\n  const {editorState} = useMediaEditorContext();\n\n  const size = createMemo(() => editorState.canvasSize.map((x) => x * editorState.pixelRatio));\n\n  return (point: NumberPair) => {\n    const [w, h] = size();\n\n    const transform = editorState.finalTransform;\n    const r = [Math.sin(-transform.rotation), Math.cos(-transform.rotation)];\n    point = [point[0] * r[1] + point[1] * r[0], point[1] * r[1] - point[0] * r[0]];\n    point = [\n      (point[0] * transform.scale + w / 2 + transform.translation[0]) / (densityAware ? 1 : editorState.pixelRatio),\n      (point[1] * transform.scale + h / 2 + transform.translation[1]) / (densityAware ? 1 : editorState.pixelRatio)\n    ];\n    return point;\n  };\n}\n","import {createEffect, createMemo, createSignal, on, onCleanup, onMount} from 'solid-js';\nimport createMiddleware from '../../../helpers/solid/createMiddleware';\nimport SwipeHandler from '../../swipeHandler';\nimport {adjustmentsConfig, AdjustmentsConfig} from '../adjustments';\nimport {HistoryItem, useMediaEditorContext} from '../context';\nimport {NumberPair} from '../types';\nimport {cleanupWebGl, distance} from '../utils';\nimport {draw} from '../webgl/draw';\nimport {initWebGL, RenderingPayload} from '../webgl/initWebGL';\nimport BrushPainter, {BrushDrawnLine} from './brushPainter';\nimport useNormalizePoint from './useNormalizePoint';\nimport useProcessPoint from './useProcessPoint';\n\n\nfunction drawAdjustedImage(gl: WebGLRenderingContext, payload: RenderingPayload) {\n  const {mediaState} = useMediaEditorContext();\n\n  if(!payload) return;\n\n  draw(gl, payload, {\n    flip: mediaState.flip,\n    rotation: 0,\n    scale: 1,\n    translation: [0, 0],\n    imageSize: [payload.media.width, payload.media.height],\n    ...(Object.fromEntries(\n      adjustmentsConfig.map(({key, to100}) => {\n        const value = mediaState.adjustments[key];\n        return [key, value / (to100 ? 100 : 50)];\n      })\n    ) as Record<AdjustmentsConfig[number]['key'], number>)\n  });\n}\n\nexport default function BrushCanvas() {\n  const {editorState, mediaState, actions, mediaSrc, mediaType} = useMediaEditorContext();\n\n  const [fullImageGLPayload, setFullImageGLPayload] = createSignal<RenderingPayload>();\n\n  const normalizePoint = useNormalizePoint();\n  const processPoint = useProcessPoint();\n\n  function processLine(line: BrushDrawnLine): BrushDrawnLine {\n    const transform = editorState.finalTransform;\n    return {\n      ...line,\n      size: line.size * transform.scale,\n      points: line.points.map(processPoint)\n    };\n  }\n\n  const processedLines = createMemo(() => mediaState.brushDrawnLines.map(processLine));\n\n  const [lastLine, setLastLine] = createSignal<BrushDrawnLine>();\n\n  const canvas = (\n    <canvas\n      class=\"media-editor__brush-canvas\"\n      classList={{\n        'media-editor__brush-canvas--active': editorState.currentTab === 'brush'\n      }}\n      style={{\n        'opacity': editorState.isAdjusting ? 0 : 1\n      }}\n      width={editorState.canvasSize?.[0] * editorState.pixelRatio}\n      height={editorState.canvasSize?.[1] * editorState.pixelRatio}\n    ></canvas>\n  ) as HTMLCanvasElement;\n  const ctx = canvas.getContext('2d');\n\n  editorState.brushCanvas = canvas;\n\n  const fullImageMultiplier = () =>\n    Math.min(\n      editorState.canvasSize?.[0] / editorState.imageSize?.[0],\n      editorState.canvasSize?.[1] / editorState.imageSize?.[1]\n    ) * 2 * editorState.pixelRatio;\n\n  const fullImageCanvas = (<canvas width={editorState.imageSize?.[0]} height={editorState.imageSize?.[1]} />) as HTMLCanvasElement;\n  const gl = fullImageCanvas.getContext('webgl', {\n    preserveDrawingBuffer: true\n  });\n\n  const fullBrushesCanvas = (\n    <canvas width={editorState.imageSize?.[0] * fullImageMultiplier()} height={editorState.imageSize?.[1] * fullImageMultiplier()} />\n  ) as HTMLCanvasElement;\n\n  let brushPainter = new BrushPainter({\n    imageCanvas: editorState.imageCanvas,\n    targetCanvas: canvas\n  });\n\n  let fullBrushPainter: BrushPainter;\n\n  onMount(async() => {\n    if(mediaType !== 'image') return;\n    const middleware = createMiddleware().get();\n    setFullImageGLPayload(await initWebGL({gl, mediaSrc, mediaType, videoTime: 0, middleware}));\n  });\n\n  onCleanup(() => {\n    cleanupWebGl(gl);\n  });\n\n  createEffect(() => {\n    const payload = fullImageGLPayload();\n    drawAdjustedImage(gl, payload);\n  });\n\n  createEffect(on(fullImageGLPayload, () => {\n    const payload = fullImageGLPayload();\n    if(payload) setTimeout(() => redrawFull(), 100);\n  }));\n\n  createEffect(\n    on(() => editorState.canvasSize, () => {\n      brushPainter = new BrushPainter({\n        imageCanvas: editorState.imageCanvas,\n        targetCanvas: canvas\n      });\n      redraw();\n    })\n  );\n\n  function resetLastLine() {\n    setLastLine({\n      color: editorState.currentBrush.color,\n      brush: editorState.currentBrush.brush,\n      size: (editorState.currentBrush.size * editorState.pixelRatio) / editorState.finalTransform.scale,\n      points: []\n    });\n  }\n\n  createEffect(() => {\n    resetLastLine();\n  });\n\n  createEffect(() => {\n    if(editorState.isMoving) {\n      const transform = editorState.finalTransform;\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\n      ctx.save();\n\n      ctx.translate(transform.translation[0] + canvas.width / 2, transform.translation[1] + canvas.height / 2);\n      ctx.rotate(transform.rotation);\n      ctx.scale(transform.scale, transform.scale);\n\n      const [w, h] = editorState.imageSize;\n      ctx.drawImage(fullBrushesCanvas, -(w / 2), -(h / 2), w, h);\n\n      ctx.restore();\n    } else {\n      redraw();\n      redrawFull();\n    }\n  });\n\n  function redraw() {\n    brushPainter.clear();\n    brushPainter.saveLastLine();\n    processedLines().forEach((line) => brushPainter.drawLine(line));\n  }\n\n  function processLineForFullImage(line: BrushDrawnLine) {\n    return {\n      ...line,\n      size: line.size * fullImageMultiplier(),\n      points: line.points.map(\n        (point) =>\n          [\n            (point[0] + editorState.imageSize?.[0] / 2) * fullImageMultiplier(),\n            (point[1] + editorState.imageSize?.[1] / 2) * fullImageMultiplier()\n          ] as NumberPair\n      )\n    };\n  }\n\n  function redrawFull() {\n    if(!fullBrushPainter) return;\n\n    fullBrushPainter.clear();\n    fullBrushPainter.saveLastLine();\n\n    mediaState.brushDrawnLines.forEach((line) => fullBrushPainter.drawLine(processLineForFullImage(line)));\n  }\n\n  createEffect(\n    on(() => editorState.imageSize, () => {\n      if(!editorState.imageSize?.[0]) return;\n      fullBrushPainter = new BrushPainter({\n        imageCanvas: fullImageCanvas,\n        targetCanvas: fullBrushesCanvas,\n        blurAmount: BrushPainter.defaultBlurAmount * fullImageMultiplier()\n      });\n\n      redraw();\n      redrawFull();\n    })\n  );\n\n  createEffect(() => {\n    if(editorState.isAdjusting) {\n      onCleanup(() => {\n        redraw();\n        redrawFull();\n      });\n    }\n  });\n\n  actions.redrawBrushes = () => {\n    redraw();\n    redrawFull();\n  };\n  onCleanup(() => {\n    actions.redrawBrushes = () => {};\n  });\n\n  onMount(() => {\n    let initialPosition: NumberPair;\n    let points: NumberPair[] = [];\n\n    let builtUpDistance = 0;\n\n    function saveLastLine() {\n      mediaState.brushDrawnLines.push(lastLine());\n      actions.pushToHistory({\n        path: ['brushDrawnLines', mediaState.brushDrawnLines.length - 1],\n        newValue: lastLine(),\n        oldValue: HistoryItem.RemoveArrayItem\n      });\n\n      fullBrushPainter.updateBlurredImage();\n      fullBrushPainter.drawLine(processLineForFullImage(lastLine()));\n      resetLastLine();\n      brushPainter.saveLastLine();\n\n      points = [];\n      initialPosition = undefined;\n    }\n\n    function startSwipe(x: number, y: number) {\n      const bcr = canvas.getBoundingClientRect();\n\n      initialPosition = [x - bcr.left, y - bcr.top];\n      const point = normalizePoint(initialPosition);\n      points = [point];\n\n      setLastLine((prev) => ({...prev, points}));\n      brushPainter.updateBlurredImage();\n      brushPainter.previewLine(processLine(lastLine()));\n\n      editorState.selectedResizableLayer = undefined;\n    }\n\n    function endSwipe() {\n      if(points.length === 1) {\n        saveLastLine();\n      }\n    }\n\n    canvas.addEventListener('mousedown', (e) => {\n      startSwipe(e.clientX, e.clientY);\n    });\n    canvas.addEventListener('touchstart', (e) => {\n      startSwipe(e.touches[0].clientX, e.touches[0].clientY);\n    });\n\n    canvas.addEventListener('mouseup', () => {\n      endSwipe();\n    });\n    canvas.addEventListener('touchend', () => {\n      endSwipe();\n    });\n\n    const swipeHandler = new SwipeHandler({\n      element: canvas,\n      cursor: '',\n      onSwipe: (xDiff, yDiff, _e) => {\n        const point = normalizePoint([initialPosition[0] + xDiff, initialPosition[1] + yDiff]);\n\n        if(points.length > 0) {\n          const lastPoint = points[points.length - 1];\n          builtUpDistance += distance(processPoint(lastPoint), processPoint(point));\n        }\n        if(builtUpDistance < Math.min(lastLine().size, 12) * editorState.pixelRatio && points.length > 1) {\n          points[points.length - 1] = point;\n        } else {\n          points.push(point);\n          builtUpDistance = 0;\n        }\n\n        setLastLine((prev) => ({...prev, points}));\n        brushPainter.previewLine(processLine(lastLine()));\n      },\n      onReset() {\n        (async() => {\n          builtUpDistance = 0;\n          if(lastLine().brush === 'arrow') {\n            await brushPainter.animateArrowBrush(processLine(lastLine()));\n          }\n          saveLastLine();\n        })();\n      }\n    });\n\n    onCleanup(() => {\n      swipeHandler.removeListeners();\n    })\n  });\n\n  return <>{canvas}</>;\n}\n","import {useMediaEditorContext} from '../context';\n\nexport function useCropOffset() {\n  const {editorState} = useMediaEditorContext();\n\n  return () => {\n    const {canvasSize} = editorState;\n    if(!canvasSize) return {left: 0, top: 0, width: 0, height: 0};\n\n    const w = canvasSize[0],\n      h = canvasSize[1];\n\n    return {\n      left: 60,\n      top: 60,\n      width: w - 120,\n      height: h - 180\n    };\n  };\n}\n","import {useMediaEditorContext} from '../context';\nimport {snapToViewport} from '../utils';\nimport {NumberPair} from '../types';\n\nimport {useCropOffset} from './useCropOffset';\n\ntype Options = {\n  rotation: number;\n  translation: NumberPair;\n  scale: number;\n  extendCrop?: [NumberPair, NumberPair];\n};\n\nexport default function getConvenientPositioning({\n  scale,\n  translation,\n  rotation,\n  extendCrop = [\n    [0, 0],\n    [0, 0]\n  ]\n}: Options) {\n  const {editorState, mediaState} = useMediaEditorContext();\n\n  const cropOffset = useCropOffset();\n\n  const [w, h] = editorState.imageSize;\n  const [imageWidth, imageHeight] = snapToViewport(w / h, cropOffset().width, cropOffset().height);\n\n  const imageLeftTop = [-imageWidth / 2, imageHeight / 2];\n\n  const imagePoints = [\n    [imageLeftTop[0], imageLeftTop[1]],\n    [imageLeftTop[0] + imageWidth, imageLeftTop[1]],\n    [imageLeftTop[0] + imageWidth, imageLeftTop[1] - imageHeight],\n    [imageLeftTop[0], imageLeftTop[1] - imageHeight]\n  ].map((point) => {\n    const r = [Math.sin(rotation), Math.cos(rotation)];\n    point = [point[0] * r[1] - point[1] * r[0], point[1] * r[1] + point[0] * r[0]].map((x) => x * scale);\n    point = [point[0] + translation[0], point[1] + translation[1]];\n    const r2 = [Math.sin(-rotation), Math.cos(-rotation)];\n    point = [point[0] * r2[1] - point[1] * r2[0], point[1] * r2[1] + point[0] * r2[0]];\n    return point;\n  });\n\n  const [cropWidth, cropHeight] = snapToViewport(mediaState.currentImageRatio, cropOffset().width, cropOffset().height);\n\n  const cropLeftTop = [-cropWidth / 2, cropHeight / 2];\n  const cropPoints = [\n    [cropLeftTop[0] + extendCrop[0][0], cropLeftTop[1] + extendCrop[0][1]],\n    [cropLeftTop[0] + cropWidth + extendCrop[1][0], cropLeftTop[1] + extendCrop[0][1]],\n    [cropLeftTop[0] + cropWidth + extendCrop[1][0], cropLeftTop[1] - cropHeight + extendCrop[1][1]],\n    [cropLeftTop[0] + extendCrop[0][0], cropLeftTop[1] - cropHeight + extendCrop[1][1]]\n  ].map((point) => {\n    const r = [Math.sin(-rotation), Math.cos(-rotation)];\n    return [point[0] * r[1] - point[1] * r[0], point[1] * r[1] + point[0] * r[0]];\n  });\n  const cropPointsX = cropPoints.map((p) => p[0]);\n  const cropPointsY = cropPoints.map((p) => p[1]);\n\n  return {\n    cropMinX: Math.min(...cropPointsX),\n    cropMaxX: Math.max(...cropPointsX),\n    cropMinY: Math.min(...cropPointsY),\n    cropMaxY: Math.max(...cropPointsY),\n    imageMinX: imagePoints[0][0],\n    imageMaxX: imagePoints[2][0],\n    imageMinY: imagePoints[2][1],\n    imageMaxY: imagePoints[0][1]\n  };\n}\n","import {batch, createEffect, createSignal, on, onCleanup, onMount} from 'solid-js';\nimport {modifyMutable, produce} from 'solid-js/store';\n\nimport SwipeHandler from '../../swipeHandler';\n\nimport {animateValue, lerp, lerpArray, snapToViewport} from '../utils';\nimport {useMediaEditorContext} from '../context';\nimport {withCurrentOwner} from '../utils';\nimport {NumberPair} from '../types';\n\nimport {useCropOffset} from './useCropOffset';\nimport _getConvenientPositioning from './getConvenientPositioning';\n\nconst MAX_SCALE = 20;\n\nexport default function CropHandles() {\n  const {editorState, mediaState} = useMediaEditorContext();\n\n  const isCropping = () => editorState.currentTab === 'crop';\n\n  const cropOffset = useCropOffset();\n\n  const [leftTop, setLeftTop] = createSignal([0, 0]);\n  const [leftTopDiff, setLeftTopDiff] = createSignal([0, 0]);\n  const [size, setSize] = createSignal([0, 0]);\n  const [diff, setDiff] = createSignal([0, 0]);\n\n  const getConvenientPositioning = withCurrentOwner(_getConvenientPositioning);\n\n  const getNewLeftTopAndSize = () => {\n    const [width, height] = snapToViewport(mediaState.currentImageRatio, cropOffset().width, cropOffset().height);\n\n    return {\n      leftTop: [\n        cropOffset().left + (cropOffset().width - width) / 2,\n        cropOffset().top + (cropOffset().height - height) / 2\n      ],\n      size: [width, height]\n    };\n  };\n\n  createEffect(\n    on(cropOffset, () => {\n      const {leftTop, size} = getNewLeftTopAndSize();\n      setLeftTop(leftTop);\n      setSize(size);\n    })\n  );\n\n  let cancelSizeAnimation: () => void;\n\n  function resetSizeWithAnimation() {\n    const initialDiff = diff();\n    const initialLeftTopDiff = leftTopDiff();\n    const initialLeftTop = leftTop();\n    const initialSize = size();\n\n    const targetDiff = [0, 0];\n    const targetLeftTopDiff = [0, 0];\n    const {leftTop: targetLeftTop, size: targetSize} = getNewLeftTopAndSize();\n\n    cancelSizeAnimation?.();\n\n    cancelSizeAnimation = animateValue(0, 1, 200, (progress) => {\n      batch(() => {\n        setDiff(lerpArray(initialDiff, targetDiff, progress) as NumberPair);\n        setLeftTopDiff(lerpArray(initialLeftTopDiff, targetLeftTopDiff, progress) as NumberPair);\n        setLeftTop(lerpArray(initialLeftTop, targetLeftTop, progress) as NumberPair);\n        setSize(lerpArray(initialSize, targetSize, progress) as NumberPair);\n      });\n    });\n  }\n\n  createEffect(\n    on(() => mediaState.currentImageRatio, () => {\n      resetSizeWithAnimation();\n    })\n  );\n\n  onMount(() => {\n    const multipliers = [\n      {el: leftTopHandle, left: -1, top: -1},\n      {el: rightTopHandle, left: 1, top: -1},\n      {el: leftBottomHandle, left: -1, top: 1},\n      {el: rightBottomHandle, left: 1, top: 1},\n\n      {el: leftHandle, left: -1, top: 0},\n      {el: topHandle, left: 0, top: -1},\n      {el: rightHandle, left: 1, top: 0},\n      {el: bottomHandle, left: 0, top: 1}\n    ];\n\n    let boundDiff: NumberPair;\n    let initialScale: number;\n    let initialTranslation: NumberPair;\n    let firstTarget: EventTarget;\n\n    const resizeSwipeHandlers = multipliers.map(({el, left, top}) => {\n      return new SwipeHandler({\n        element: el,\n        setCursorTo: document.body,\n        onStart() {\n          initialScale = mediaState.scale;\n          initialTranslation = mediaState.translation;\n          editorState.isMoving = true;\n\n          el.classList.add('media-editor__crop-handles-circle--anti-flicker');\n        },\n        onSwipe(xDiff, yDiff, e) {\n          if(!firstTarget) firstTarget = e.target;\n          if(firstTarget !== el) return;\n\n          const fixed = editorState.fixedImageRatioKey;\n          let ratio = mediaState.currentImageRatio;\n          if(left < 0) {\n            ratio = -ratio;\n          }\n          if(top < 0) {\n            ratio = -ratio;\n          }\n\n          const [w, h] = size();\n          const minW = Math.min(w, (cropOffset().width / MAX_SCALE) * Math.min(MAX_SCALE, initialScale));\n          const minH = Math.min(h, (cropOffset().height / MAX_SCALE) * Math.min(MAX_SCALE, initialScale));\n          xDiff = Math.max(xDiff * left, minW - w) * left;\n          yDiff = Math.max(yDiff * top, minH - h) * top;\n\n          if(fixed) {\n            if(top === 0) {\n              yDiff = xDiff / ratio;\n            } else if(left === 0) {\n              xDiff = yDiff * ratio;\n            } else {\n              const xd = xDiff;\n              xDiff = (xDiff + yDiff * ratio) / 2;\n              yDiff = (xd / ratio + yDiff) / 2;\n            }\n          }\n\n          if(fixed && top === 0) {\n            setDiff([left * xDiff, yDiff]);\n          } else if(fixed && left === 0) {\n            setDiff([xDiff, top * yDiff]);\n          } else {\n            setDiff([xDiff * left, yDiff * top]);\n          }\n\n          setLeftTopDiff([\n            fixed && left === 0 ? -xDiff / 2 : Number(left < 0) * xDiff,\n            fixed && top === 0 ? -yDiff / 2 : Number(top < 0) * yDiff\n          ]);\n          const {cropMinX, cropMaxX, cropMinY, cropMaxY, imageMinX, imageMaxX, imageMinY, imageMaxY} =\n            getConvenientPositioning({\n              scale: initialScale,\n              rotation: mediaState.rotation,\n              translation: initialTranslation,\n              extendCrop: [\n                [\n                  fixed && left === 0 ? -xDiff / 2 : left === -1 ? xDiff : 0,\n                  fixed && top === 0 ? yDiff / 2 : top === 1 ? yDiff : 0\n                ],\n                [\n                  fixed && left === 0 ? xDiff / 2 : left === 1 ? xDiff : 0,\n                  fixed && top === 0 ? -yDiff / 2 : top === -1 ? yDiff : 0\n                ]\n              ]\n            });\n          const halfImageWidth = (imageMaxX - imageMinX) / 2,\n            halfImageHeight = (imageMaxY - imageMinY) / 2;\n          const imageCenter = [imageMinX + halfImageWidth, imageMinY + halfImageHeight];\n\n          let additionalScaleX = 1;\n          let additionalScaleY = 1;\n\n          if(imageMinX > cropMinX) additionalScaleX *= 1 + ((imageCenter[0] - cropMinX) / halfImageWidth - 1) / 2;\n          if(imageMaxX < cropMaxX) additionalScaleX *= 1 + ((cropMaxX - imageCenter[0]) / halfImageWidth - 1) / 2;\n          if(imageMinY > cropMinY) additionalScaleY *= 1 + ((imageCenter[1] - cropMinY) / halfImageHeight - 1) / 2;\n          if(imageMaxY < cropMaxY) additionalScaleY *= 1 + ((cropMaxY - imageCenter[1]) / halfImageHeight - 1) / 2;\n\n          const additionalScale = Math.max(additionalScaleX, additionalScaleY);\n          if(additionalScale > 1) {\n            mediaState.scale = initialScale * additionalScale;\n          }\n\n          let boundDiff = [0, 0];\n\n          if(imageMinX > cropMinX) boundDiff[0] += imageMinX - cropMinX;\n          if(imageMaxX < cropMaxX) boundDiff[0] += imageMaxX - cropMaxX;\n          if(imageMinY > cropMinY) boundDiff[1] += imageMinY - cropMinY;\n          if(imageMaxY < cropMaxY) boundDiff[1] += imageMaxY - cropMaxY;\n\n          const r = [Math.sin(mediaState.rotation), Math.cos(mediaState.rotation)];\n\n          boundDiff = [boundDiff[0] * r[1] - boundDiff[1] * r[0], boundDiff[1] * r[1] + boundDiff[0] * r[0]];\n\n          mediaState.translation = [initialTranslation[0] - boundDiff[0] / 2, initialTranslation[1] - boundDiff[1] / 2];\n        },\n        onReset() {\n          if(firstTarget !== el) return (firstTarget = undefined);\n          firstTarget = undefined;\n\n          const newWidth = size()[0] + diff()[0],\n            newHeight = size()[1] + diff()[1];\n          const newRatio = newWidth / newHeight;\n\n          const upScale = Math.min(cropOffset().width / newWidth, cropOffset().height / newHeight);\n          mediaState.currentImageRatio = newRatio;\n          resetSizeWithAnimation();\n\n          const initialScale = mediaState.scale;\n          const initialTranslation = mediaState.translation;\n\n          const targetScale = mediaState.scale * upScale;\n          const targetTranslation = [\n            upScale * (mediaState.translation[0] + -diff()[0] * left * 0.5),\n            upScale * (mediaState.translation[1] + -diff()[1] * top * 0.5)\n          ];\n\n          animateValue(\n            0,\n            1,\n            200,\n            (progress) => {\n              modifyMutable(mediaState, produce((state) => {\n                state.scale = lerp(initialScale, targetScale, progress);\n                state.translation = lerpArray(initialTranslation, targetTranslation, progress) as NumberPair;\n              }));\n            },\n            {\n              onEnd: () => editorState.isMoving = false\n            }\n          );\n\n          el.classList.remove('media-editor__crop-handles-circle--anti-flicker');\n        }\n      });\n    });\n\n    const translationSwipeHandler = new SwipeHandler({\n      element: cropArea,\n      onStart() {\n        initialTranslation = mediaState.translation;\n        editorState.isMoving = true;\n      },\n      onSwipe(xDiff, yDiff, e) {\n        if(!firstTarget) firstTarget = e.target;\n        if(firstTarget !== cropArea) return;\n\n        const {cropMinX, cropMaxX, cropMinY, cropMaxY, imageMinX, imageMaxX, imageMinY, imageMaxY} =\n          getConvenientPositioning({\n            scale: mediaState.scale,\n            rotation: mediaState.rotation,\n            translation: [initialTranslation[0] + xDiff, initialTranslation[1] + yDiff]\n          });\n\n        boundDiff = [0, 0];\n\n        if(imageMinX > cropMinX) boundDiff[0] = imageMinX - cropMinX;\n        if(imageMaxX < cropMaxX) boundDiff[0] = imageMaxX - cropMaxX;\n        if(imageMinY > cropMinY) boundDiff[1] = imageMinY - cropMinY;\n        if(imageMaxY < cropMaxY) boundDiff[1] = imageMaxY - cropMaxY;\n\n        const r = [Math.sin(mediaState.rotation), Math.cos(mediaState.rotation)];\n\n        boundDiff = [boundDiff[0] * r[1] - boundDiff[1] * r[0], boundDiff[1] * r[1] + boundDiff[0] * r[0]];\n\n        const resistance = 4;\n        mediaState.translation = [\n          initialTranslation[0] + xDiff - (boundDiff[0] - boundDiff[0] / resistance),\n          initialTranslation[1] + yDiff - (boundDiff[1] - boundDiff[1] / resistance)\n        ]\n        boundDiff = [boundDiff[0] / resistance, boundDiff[1] / resistance];\n      },\n      onReset() {\n        if(firstTarget !== cropArea) return (firstTarget = undefined);\n        firstTarget = undefined;\n\n        const prevTranslation = mediaState.translation;\n        animateValue(\n          prevTranslation,\n          [prevTranslation[0] - boundDiff[0], prevTranslation[1] - boundDiff[1]] as const,\n          120,\n          (value) => mediaState.translation = value,\n          {\n            onEnd: () => editorState.isMoving = false\n          }\n        );\n      }\n    });\n\n    onCleanup(() => {\n      resizeSwipeHandlers.forEach((handler) => handler.removeListeners());\n      translationSwipeHandler.removeListeners();\n    });\n  });\n\n  const left = () => leftTop()[0] + leftTopDiff()[0];\n  const top = () => leftTop()[1] + leftTopDiff()[1];\n  const width = () => size()[0] + diff()[0];\n  const height = () => size()[1] + diff()[1];\n  const right = () => left() + width();\n  const bottom = () => top() + height();\n\n  const croppedSizeFull = () => {\n    const [cw, ch] = editorState.canvasSize;\n    let [w, h] = [cw, ch];\n    const ratio = mediaState.currentImageRatio;\n\n    if(w / ratio > h) w = h * ratio;\n    else h = w / ratio;\n\n    return [(cw - w) / 2, (ch - h) / 2];\n  };\n\n  let cropArea: HTMLDivElement;\n\n  let leftTopHandle: HTMLDivElement;\n  let rightTopHandle: HTMLDivElement;\n  let leftBottomHandle: HTMLDivElement;\n  let rightBottomHandle: HTMLDivElement;\n\n  let leftHandle: HTMLDivElement;\n  let topHandle: HTMLDivElement;\n  let rightHandle: HTMLDivElement;\n  let bottomHandle: HTMLDivElement;\n\n  const coverAnimatedStyle = () =>\n    ({\n      'transition': 'opacity 0.2s',\n      'transition-timing-function': isCropping() ? 'ease-in' : 'ease-out',\n      'pointer-events': isCropping() ? 'none' : undefined,\n      'opacity': isCropping() ? 0 : 1\n    }) as const;\n\n  const controlsAnimatedStyle = () =>\n    ({\n      'transition': 'transform 0.2s, opacity 0.2s',\n      'transition-timing-function': isCropping() ? 'ease-out' : 'ease-in',\n      'pointer-events': isCropping() ? undefined : 'none',\n      'opacity': isCropping() ? 1 : 0,\n      'transform': isCropping() ? undefined : 'scale(1.05)'\n    }) as const;\n\n  return (\n    <>\n      <div\n        style={{\n          background: 'black',\n          position: 'absolute',\n          left: '0px',\n          top: '0px',\n          width: '100%',\n          height: croppedSizeFull()[1] + 'px',\n          ...coverAnimatedStyle()\n        }}\n      ></div>\n      <div\n        style={{\n          background: 'black',\n          position: 'absolute',\n          left: '0px',\n          bottom: '0px',\n          width: '100%',\n          height: croppedSizeFull()[1] + 'px',\n          ...coverAnimatedStyle()\n        }}\n      ></div>\n      <div\n        style={{\n          background: 'black',\n          position: 'absolute',\n          left: '0px',\n          top: '0px',\n          height: '100%',\n          width: croppedSizeFull()[0] + 'px',\n          ...coverAnimatedStyle()\n        }}\n      ></div>\n      <div\n        style={{\n          background: 'black',\n          position: 'absolute',\n          right: '0px',\n          top: '0px',\n          height: '100%',\n          width: croppedSizeFull()[0] + 'px',\n          ...coverAnimatedStyle()\n        }}\n      ></div>\n      <div\n        style={{\n          position: 'absolute',\n          right: '0px',\n          top: '0px',\n          height: '100%',\n          width: '100%',\n          overflow: 'hidden',\n          ...controlsAnimatedStyle()\n        }}\n      >\n        <div\n          class=\"media-editor__crop-handles-backdrop\"\n          style={{\n            ['clip-path']: `polygon(\n              0 0, 0 100%,\n              ${left()}px 100%, ${left()}px ${top()}px, ${right()}px ${top()}px,\n              ${right()}px ${bottom()}px, ${left()}px ${bottom()}px, ${left()}px 100%,\n              100% 100%, 100% 0%\n            )`\n          }}\n        />\n        <div\n          ref={cropArea}\n          class=\"media-editor__crop-handles\"\n          style={{\n            left: left() + 'px',\n            top: top() + 'px',\n            width: width() + 'px',\n            height: height() + 'px'\n          }}\n        >\n          <div class=\"media-editor__crop-handles-line-h\" style={{top: '33%'}} />\n          <div class=\"media-editor__crop-handles-line-h\" style={{top: '66%'}} />\n          <div class=\"media-editor__crop-handles-line-v\" style={{left: '33%'}} />\n          <div class=\"media-editor__crop-handles-line-v\" style={{left: '66%'}} />\n\n          <div ref={leftHandle} class=\"media-editor__crop-handles-side media-editor__crop-handles-side--w\" />\n          <div ref={topHandle} class=\"media-editor__crop-handles-side media-editor__crop-handles-side--n\" />\n          <div ref={rightHandle} class=\"media-editor__crop-handles-side media-editor__crop-handles-side--e\" />\n          <div ref={bottomHandle} class=\"media-editor__crop-handles-side media-editor__crop-handles-side--s\" />\n\n          <div ref={leftTopHandle} class=\"media-editor__crop-handles-circle media-editor__crop-handles-circle--nw\" />\n          <div ref={rightTopHandle} class=\"media-editor__crop-handles-circle media-editor__crop-handles-circle--ne\" />\n          <div ref={leftBottomHandle} class=\"media-editor__crop-handles-circle media-editor__crop-handles-circle--sw\" />\n          <div\n            ref={rightBottomHandle}\n            class=\"media-editor__crop-handles-circle media-editor__crop-handles-circle--se\"\n          />\n        </div>\n      </div>\n    </>\n  );\n}\n","import {createEffect, onCleanup} from 'solid-js';\nimport {animate} from '../../../helpers/animation';\nimport clamp from '../../../helpers/number/clamp';\nimport {SetVideoTimeFlags, useMediaEditorContext} from '../context';\n\n\ntype Args = {\n  gl: WebGLRenderingContext;\n  drawAdjustedImage: () => void;\n};\n\nexport default function initVideoPlayback({gl, drawAdjustedImage}: Args) {\n  const {editorState, mediaState, actions} = useMediaEditorContext();\n  const {renderingPayload} = editorState;\n  const video = renderingPayload.media.video;\n\n  if(!video) return;\n\n  // We don't want this 'seeked' event to be fired when generating the final result\n  let pendingSeek = false;\n\n  actions.setVideoTime = (time: number, flags = SetVideoTimeFlags.Redraw | SetVideoTimeFlags.UpdateVideo | SetVideoTimeFlags.UpdateCursor) => {\n    if(flags & SetVideoTimeFlags.UpdateCursor) mediaState.currentVideoTime = time;\n    if(flags & SetVideoTimeFlags.UpdateVideo) video.currentTime = time * video.duration;\n    if(flags & SetVideoTimeFlags.Redraw) pendingSeek = true;\n  };\n\n  const seekListener = () => {\n    if(!pendingSeek) return;\n    pendingSeek = false;\n\n    gl.bindTexture(gl.TEXTURE_2D, renderingPayload.texture);\n    gl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0, gl.RGBA, gl.UNSIGNED_BYTE, video);\n\n    drawAdjustedImage();\n  };\n\n  video.addEventListener('seeked', seekListener);\n  onCleanup(() => {\n    video.removeEventListener('seeked', seekListener);\n  });\n\n\n  createEffect(() => {\n    if(editorState.currentTab !== 'adjustments') return;\n\n    const listener = (event: KeyboardEvent) => {\n      const el = (event.target as HTMLElement);\n\n      if(event.code === 'Space' && !el.isContentEditable) {\n        event.preventDefault(); // stop page from scrolling, idk if needed\n        editorState.isPlaying = !editorState.isPlaying;\n      }\n    };\n\n    document.addEventListener('keydown', listener);\n\n    onCleanup(() => {\n      editorState.isPlaying = false;\n      document.removeEventListener('keydown', listener);\n    });\n  });\n\n  createEffect(() => {\n    video.muted = mediaState.videoMuted;\n  });\n\n  createEffect(() => {\n    if(!editorState.isPlaying) return;\n\n    let\n      frameCallbackId: number,\n      playing = true,\n      skip = 0\n    ;\n\n    function frameCallback() {\n      gl.bindTexture(gl.TEXTURE_2D, renderingPayload.texture);\n      gl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0, gl.RGBA, gl.UNSIGNED_BYTE, video);\n\n      drawAdjustedImage();\n\n      frameCallbackId = video.requestVideoFrameCallback(() => frameCallback());\n    }\n\n    const timeout = self.setTimeout(() => {\n      if(mediaState.currentVideoTime >= mediaState.videoCropStart + mediaState.videoCropLength)\n        actions.setVideoTime(mediaState.videoCropStart);\n\n      frameCallbackId = video.requestVideoFrameCallback(frameCallback);\n      video.play();\n\n      animate(() => {\n        skip = (skip + 1) % 3;\n\n        if(skip) return true;\n        if(!playing) return false;\n\n        mediaState.currentVideoTime = video.currentTime / video.duration || 0;\n\n        if(video.ended || video.paused || mediaState.currentVideoTime >= mediaState.videoCropStart + mediaState.videoCropLength) {\n          playing = false;\n          editorState.isPlaying = false;\n          mediaState.currentVideoTime = clamp(mediaState.currentVideoTime, mediaState.videoCropStart, mediaState.videoCropStart + mediaState.videoCropLength);\n        }\n\n        return playing;\n      });\n    }, 200); // Let the pause/play icon animation finish as it might lag without this\n\n    onCleanup(() => {\n      playing = false;\n      self.clearTimeout(timeout);\n      video.cancelVideoFrameCallback(frameCallbackId);\n      video.pause();\n    });\n  });\n};\n","import {createEffect, createReaction, onCleanup, onMount} from 'solid-js';\nimport {modifyMutable, produce} from 'solid-js/store';\nimport createMiddleware from '../../../helpers/solid/createMiddleware';\nimport {adjustmentsConfig, AdjustmentsConfig} from '../adjustments';\nimport {useMediaEditorContext} from '../context';\nimport {cleanupWebGl, withCurrentOwner} from '../utils';\nimport {draw} from '../webgl/draw';\nimport {initWebGL} from '../webgl/initWebGL';\nimport initVideoPlayback from './initVideoPlayback';\n\n\nfunction drawAdjustedImage(gl: WebGLRenderingContext) {\n  const {editorState, mediaState} = useMediaEditorContext();\n\n  const payload = editorState.renderingPayload;\n  if(!payload) return;\n\n  draw(gl, payload, {\n    ...editorState.finalTransform,\n    imageSize: [payload.media.width, payload.media.height],\n    ...(Object.fromEntries(\n      adjustmentsConfig.map(({key, to100}) => {\n        const value = mediaState.adjustments[key];\n        return [key, value / (to100 ? 100 : 50)];\n      })\n    ) as Record<AdjustmentsConfig[number]['key'], number>)\n  });\n}\n\nexport default function ImageCanvas() {\n  const {editorState, mediaState, mediaSrc, mediaType, actions} = useMediaEditorContext();\n\n  const canvas = (\n    <canvas width={editorState.canvasSize[0] * editorState.pixelRatio} height={editorState.canvasSize[1] * editorState.pixelRatio} />\n  ) as HTMLCanvasElement;\n\n  const gl = canvas.getContext('webgl', {\n    preserveDrawingBuffer: true\n  });\n\n  editorState.imageCanvas = canvas;\n\n  const ownedDrawAdjustedImage = withCurrentOwner(() => drawAdjustedImage(gl));\n\n  const ownedInitVideoPlayback = withCurrentOwner(() =>\n    initVideoPlayback({gl, drawAdjustedImage: ownedDrawAdjustedImage})\n  );\n\n  const middleware = createMiddleware().get();\n\n  async function init() {\n    const payload = await initWebGL({gl, mediaSrc, mediaType, videoTime: mediaState.currentVideoTime, middleware});\n\n    modifyMutable(editorState, produce(state => {\n      state.renderingPayload = payload;\n      state.imageSize = [payload.media.width, payload.media.height];\n    }));\n\n    if(!mediaState.currentImageRatio) {\n      const ratio = payload.media.width / payload.media.height;\n      actions.setInitialImageRatio(ratio)\n      mediaState.currentImageRatio = ratio;\n    }\n\n    ownedInitVideoPlayback();\n  }\n\n  onMount(() => {\n    if(editorState.isReady) init(); // When hot reloading\n    else {\n      const track = createReaction(() => {\n        init();\n      });\n\n      track(() => editorState.isReady);\n    }\n  });\n\n  createEffect(() => {\n    drawAdjustedImage(gl);\n  });\n\n  onCleanup(() => {\n    cleanupWebGl(gl);\n  });\n\n  return <>{canvas}</>;\n}\n","import {Show} from 'solid-js';\n\nimport {hexToRgb} from '../../../helpers/color';\n\nimport {useMediaEditorContext} from '../context';\n\n\nconst PreviewBrushSize = () => {\n  const {editorState} = useMediaEditorContext();\n\n  return (\n    <Show when={editorState.previewBrushSize}>\n      <div\n        class=\"media-editor__preview-brush-size\"\n        style={{\n          '--color': !['blur', 'eraser'].includes(editorState.currentBrush.brush) ?\n            hexToRgb(editorState.currentBrush.color).join(',') :\n            undefined,\n          'width': editorState.previewBrushSize + 'px',\n          'height': editorState.previewBrushSize + 'px'\n        }}\n      />\n    </Show>\n  );\n};\n\nexport default PreviewBrushSize;\n","import {createSignal, onCleanup} from 'solid-js';\n\nfunction useMediaQuery(query: string) {\n  const [isMatch, setIsMatch] = createSignal(false);\n\n  const updateMatch = () => {\n    setIsMatch(window.matchMedia(query).matches);\n  };\n\n  const mediaQueryList = window.matchMedia(query);\n  setIsMatch(mediaQueryList.matches);\n\n  mediaQueryList.addEventListener('change', updateMatch);\n  onCleanup(() => {\n    mediaQueryList.removeEventListener('change', updateMatch);\n  });\n\n  return isMatch;\n}\n\nexport default function useIsMobile() {\n  const isMobile = useMediaQuery('(max-width: 800px');\n  return isMobile;\n}\n","import {onCleanup, onMount} from 'solid-js';\n\nimport createMiddleware from '../../../helpers/solid/createMiddleware';\nimport wrapSticker from '../../wrappers/sticker';\n\nimport {useMediaEditorContext} from '../context';\nimport {ResizableLayerProps} from '../types';\n\nimport {ResizableContainer} from './resizableLayers';\n\nexport default function StickerLayerContent(props: ResizableLayerProps) {\n  const {editorState} = useMediaEditorContext();\n\n  let container: HTMLDivElement;\n\n  onMount(() => {\n    const middleware = createMiddleware();\n\n    wrapSticker({\n      div: container,\n      doc: props.layer.sticker,\n      group: 'none',\n      width: 500,\n      height: 500,\n      play: true,\n      loop: true,\n      withThumb: false,\n      middleware: middleware.get()\n    });\n\n    editorState.stickersLayersInfo[props.layer.id] = {container};\n\n    onCleanup(() => {\n      middleware.destroy();\n    });\n  });\n\n  const children = (\n    <div ref={container} class=\"media-editor__sticker-layer-content\" />\n  ); // Needs to be rendered here for hot reload to work properly\n\n  return (\n    <ResizableContainer layer={props.layer}>\n      {children}\n    </ResizableContainer>\n  );\n}\n","import {batch, createEffect, createMemo, on, onCleanup, onMount} from 'solid-js';\n\nimport createElementFromMarkup from '../../../helpers/createElementFromMarkup';\nimport {i18n} from '../../../lib/langPack';\n\nimport {ResizableLayerProps, TextLayerInfo, TextRenderingInfoLine} from '../types';\nimport {fontInfoMap, getContrastColor, log} from '../utils';\nimport {HistoryItem, useMediaEditorContext} from '../context';\n\nimport {ResizableContainer} from './resizableLayers';\n\nexport default function TextLayerContent(props: ResizableLayerProps) {\n  const {editorState, mediaState, actions} = useMediaEditorContext();\n\n  if(!props.layer.textInfo) return;\n\n  const onFocus = () => {\n    batch(() => {\n      editorState.selectedResizableLayer = props.layer.id;\n      editorState.currentTextLayerInfo = {...props.layer.textInfo};\n    });\n  };\n\n  const fontInfo = () => fontInfoMap[props.layer.textInfo.font];\n\n  function deleteThisLayer() {\n    const layers = mediaState.resizableLayers;\n    const idx = layers.findIndex(layer => layer.id === props.layer.id);\n    if(idx < 0) return;\n    const deletedLayer = layers.splice(idx, 1)[0];\n    deletedLayer.textRenderingInfo = undefined;\n\n    actions.pushToHistory({\n      path: ['resizableLayers', idx],\n      newValue: HistoryItem.RemoveArrayItem,\n      oldValue: deletedLayer,\n      findBy: {\n        id: deletedLayer.id\n      }\n    });\n  }\n\n  function updateBackground() {\n    contentEditable.childNodes.forEach((childNode) => {\n      if(childNode instanceof HTMLDivElement && !childNode.hasAttributes()) {\n        childNode.querySelectorAll('*').forEach((element) => {\n          const node = document.createTextNode(element.textContent);\n          element.replaceWith(node);\n        });\n      } else {\n        const div = document.createElement('div');\n        div.textContent = childNode.textContent;\n        childNode.replaceWith(div);\n      }\n    });\n    if(!contentEditable.textContent) {\n      contentEditable.innerHTML = '<div></div>';\n\n      // Firefox cursor reset\n      const child = contentEditable.children[0];\n      const range = document.createRange();\n      const sel = window.getSelection();\n\n      range.setStart(child, 0);\n      range.collapse(true);\n\n      sel.removeAllRanges();\n      sel.addRange(range);\n    }\n\n    // Firefox puts the cursor outside the inner divs and messes up everything\n    const selection = window.getSelection();\n    if(selection.rangeCount > 0) {\n      const range = selection.getRangeAt(0);\n      if(range.startContainer === contentEditable && range.startOffset === 0) {\n        const innerDiv = contentEditable.children[0];\n        const innerDivRange = document.createRange();\n        innerDivRange.selectNodeContents(innerDiv);\n        innerDivRange.collapse(false); // Collapse to the end of the inner div\n\n        selection.removeAllRanges();\n        selection.addRange(innerDivRange);\n      }\n    }\n\n    container.querySelector('.media-editor__text-layer-background')?.remove();\n    const lines = getLinesRenderingInfo(contentEditable, props.layer.textInfo.alignment);\n    const path = createTextBackgroundPath(lines);\n\n    if(props.layer.textInfo.style === 'background') updateBackgroundStyle(container, path.join(' '), props.layer.textInfo);\n    if(props.layer.textInfo.style === 'outline') updateOutlineStyle(container, contentEditable, props.layer.textInfo);\n\n    props.layer.textRenderingInfo =  {\n      width: container.clientWidth,\n      height: container.clientHeight,\n      path,\n      lines\n    };\n  }\n\n  function selectAll() {\n    const range = document.createRange();\n    range.selectNodeContents(contentEditable.children[0]);\n    const selection = window.getSelection();\n    selection.removeAllRanges();\n    selection.addRange(range);\n  }\n\n  createEffect(() => {\n    updateBackground();\n  });\n\n  const isThisLayerSelected = createMemo(() => props.layer.id === editorState.selectedResizableLayer);\n\n  onMount(() => {\n    if(isThisLayerSelected()) selectAll();\n  });\n\n\n  createEffect(() => {\n    if(isThisLayerSelected()) {\n      onCleanup(() => {\n        if(!contentEditable.innerText.trim()) {\n          deleteThisLayer();\n        }\n      })\n    }\n  });\n\n  createEffect(\n    on(() => ({...editorState.currentTextLayerInfo}), () => {\n      if(editorState.selectedResizableLayer !== props.layer.id) return;\n      props.layer.textInfo = {...editorState.currentTextLayerInfo};\n    })\n  );\n\n  onMount(() => {\n    container.addEventListener('dragstart', (e: Event) => {\n      e.preventDefault();\n    });\n  });\n\n  let container: HTMLDivElement;\n  let contentEditable: HTMLDivElement;\n\n  const color = () => {\n    if(props.layer.textInfo.style === 'normal') return props.layer.textInfo.color;\n    return getContrastColor(props.layer.textInfo.color);\n  };\n\n  const intialContent = (() => {\n    const layerInfo = props.layer.textRenderingInfo;\n    if(!layerInfo) return <div>{i18n('MediaEditor.TypeSomething')}</div>;\n    return layerInfo.lines.map((line) => <div>{line.content}</div>);\n  })();\n\n  const children = (\n    <div\n      ref={container}\n      class=\"media-editor__text-layer\"\n      classList={{\n        'media-editor__text-layer--with-bg': props.layer.textInfo.style === 'background'\n      }}\n      style={{\n        'color': color(),\n        'font-size': props.layer.textInfo.size + 'px',\n        'font-family': fontInfo().fontFamily,\n        'font-weight': fontInfo().fontWeight,\n        '--align-items': flexAlignMap[props.layer.textInfo.alignment]\n      }}\n    >\n      <div\n        ref={contentEditable}\n        class=\"media-editor__text-layer-layout\"\n        contenteditable\n        onInput={() => updateBackground()}\n        onFocus={onFocus}\n      >\n        {intialContent}\n      </div>\n    </div>\n  ); // Needs to be rendered here for hot reload to work properly\n\n  return (\n    <ResizableContainer layer={props.layer}>\n      {children}\n    </ResizableContainer>\n  );\n}\n\nfunction getLinesRenderingInfo(linesContainer: HTMLDivElement, alignment: string): TextRenderingInfoLine[] {\n  return Array.from(linesContainer.children).map((_child) => {\n    const child = _child as HTMLElement;\n    let offset = 0;\n    if(alignment === 'left') {\n      offset = 0;\n    } else if(alignment === 'center') {\n      offset = (linesContainer.clientWidth - child.clientWidth) / 2;\n    } else {\n      offset = linesContainer.clientWidth - child.clientWidth;\n    }\n    return {\n      left: offset,\n      right: offset + child.clientWidth,\n      content: child.innerText,\n      height: child.clientHeight\n    };\n  });\n}\n\nfunction createTextBackgroundPath(lines: TextRenderingInfoLine[]) {\n  const first = lines[0];\n\n  const rounding = first.height * 0.3;\n\n  const arcParams = (r: number, s: number = 1) => [r, r, 0, 0, s];\n\n  const path = [];\n  path.push('M', first.left, rounding);\n\n  path.push('A', ...arcParams(rounding), first.left + rounding, 0);\n  path.push('L', first.right - rounding, 0);\n  path.push('A', ...arcParams(rounding), first.right, rounding);\n\n  let prevPosition = first;\n  let prevY = first.height;\n\n  for(let i = 1; i < lines.length; i++) {\n    const position = lines[i];\n\n    const diffSign = position.right > prevPosition.right ? 1 : -1;\n    const diff = Math.min(Math.abs((position.right - prevPosition.right) / 2), rounding) * diffSign;\n    const currentRounding = Math.abs(diff);\n\n    path.push('L', prevPosition.right, prevY - currentRounding);\n    path.push('A', ...arcParams(currentRounding, diffSign === 1 ? 0 : 1), prevPosition.right + diff, prevY);\n    path.push('L', position.right - diff, prevY);\n    path.push('A', ...arcParams(currentRounding, diffSign === 1 ? 1 : 0), position.right, prevY + currentRounding);\n\n    prevY += position.height;\n    prevPosition = position;\n  }\n\n  path.push('L', prevPosition.right, prevY - rounding);\n  path.push('A', ...arcParams(rounding), prevPosition.right - rounding, prevY);\n  path.push('L', prevPosition.left + rounding, prevY);\n  path.push('A', ...arcParams(rounding), prevPosition.left, prevY - rounding);\n\n  const last = lines[lines.length - 1];\n  prevY -= last.height;\n  for(let i = lines.length - 2; i >= 0; i--) {\n    const position = lines[i];\n\n    const diffSign = position.left > prevPosition.left ? 1 : -1;\n    const diff = Math.min(Math.abs((position.left - prevPosition.left) / 2), rounding) * diffSign;\n    const currentRounding = Math.abs(diff);\n\n    path.push('L', prevPosition.left, prevY + currentRounding);\n    path.push('A', ...arcParams(currentRounding, diffSign !== 1 ? 0 : 1), prevPosition.left + diff, prevY);\n    path.push('L', position.left - diff, prevY);\n    path.push('A', ...arcParams(currentRounding, diffSign !== 1 ? 1 : 0), position.left, prevY - currentRounding);\n\n    prevY -= position.height;\n    prevPosition = position;\n  }\n\n  return path;\n}\n\nfunction updateBackgroundStyle(container: HTMLDivElement, path: string, info: TextLayerInfo) {\n  const svg = createElementFromMarkup(`\n    <svg width=\"${container.clientWidth}\" height=\"${container.clientHeight}\" viewBox=\"0 0 ${container.clientWidth} ${container.clientHeight}\">\n      <path d=\"${path}\" fill=\"${info.color}\" />\n    </svg>\n  `);\n  svg.classList.add('media-editor__text-layer-background');\n  container.prepend(svg);\n\n  return path;\n}\n\nfunction updateOutlineStyle(container: HTMLDivElement, contentEditable: HTMLDivElement, info: TextLayerInfo) {\n  const fontInfo = fontInfoMap[info.font];\n  function updateSvg(div: HTMLDivElement) {\n    div.querySelector('.media-editor__text-layer-svg-outline')?.remove();\n    const stretch = info.size * 0.5;\n    const w = div.clientWidth + stretch;\n    const h = div.clientHeight + stretch;\n    const svg = createElementFromMarkup(`\n      <div class=\"media-editor__text-layer-svg-outline\" style=\"width: ${w}px; height: ${h}px;\">\n        <svg style=\"width: ${w}px; height: ${h}px;\" viewBox=\"${-stretch / 2} 0 ${div.clientWidth + stretch / 2} ${div.clientHeight + stretch}\">\n          <text\n            x=\"${info.size * 0.2}\"\n            y=\"${info.size * 1.33 * fontInfo.baseline}\"\n            style=\"font-size:${info.size}px;stroke:${info.color};stroke-width:${div.clientHeight * 0.15}px;font-family:${fontInfo.fontFamily};font-weight:${fontInfo.fontWeight};\">\n            ${div.innerText}\n          </text>\n        </svg>\n      </div>\n    `);\n    div.prepend(svg);\n  }\n\n  const bgDiv = document.createElement('div');\n  bgDiv.classList.add('media-editor__text-layer-background', 'media-editor__text-layer-background--as-layout');\n  bgDiv.innerHTML = contentEditable.innerHTML;\n  container.prepend(bgDiv);\n  Array.from(bgDiv.children).forEach((line) => {\n    if(line instanceof HTMLDivElement) updateSvg(line);\n  });\n}\n\nconst flexAlignMap: Record<string, string> = {\n  left: 'start',\n  center: 'center',\n  right: 'end'\n};\n","import {Accessor, batch, createEffect, createMemo, For, on, onCleanup, onMount, ParentProps, Show} from 'solid-js';\nimport {createMutable, modifyMutable, produce} from 'solid-js/store';\nimport {Portal} from 'solid-js/web';\n\nimport createContextMenu from '../../../helpers/dom/createContextMenu';\n\nimport SwipeHandler, {getEvent} from '../../swipeHandler';\nimport {observeResize} from '../../resizeObserver';\n\nimport {NumberPair, ResizableLayer, ResizableLayerProps} from '../types';\nimport {HistoryItem, useMediaEditorContext} from '../context';\nimport {withCurrentOwner} from '../utils';\nimport useIsMobile from '../useIsMobile';\n\nimport StickerLayerContent from './stickerLayerContent';\nimport useNormalizePoint from './useNormalizePoint';\nimport TextLayerContent from './textLayerContent';\nimport useProcessPoint from './useProcessPoint';\n\n\ntype ProcessedLayer = {\n  position: NumberPair;\n  rotation: number;\n  scale: number;\n}\n\nexport default function ResizableLayers() {\n  const context = useMediaEditorContext();\n  const {editorState, mediaState, actions} = context;\n  const isTextTab = () => editorState.currentTab === 'text';\n  const canClick = () => ['stickers', 'text', 'adjustments'].includes(editorState.currentTab);\n\n\n  function moveSelectedLayerOnTop() {\n    const layers = mediaState.resizableLayers;\n    const idx = layers.findIndex(layer => layer.id === editorState.selectedResizableLayer);\n    if(idx < 0) return;\n    const layer = layers.splice(idx, 1)[0];\n    layer && layers.push(layer);\n  }\n\n  createEffect(\n    on(() => editorState.selectedResizableLayer, () => {\n      moveSelectedLayerOnTop();\n    })\n  );\n\n  createEffect(() => {\n    editorState.currentTab;\n    onCleanup(() => {\n      editorState.selectedResizableLayer = undefined;\n    });\n  });\n\n  let container: HTMLDivElement;\n\n  const normalizePoint = useNormalizePoint();\n\n  function addLayer(e: MouseEvent) {\n    if(e.target !== container) return;\n    if(editorState.selectedResizableLayer) {\n      editorState.selectedResizableLayer = undefined;\n      return;\n    }\n\n    if(!isTextTab()) return;\n\n    const bcr = container.getBoundingClientRect();\n    const transform = editorState.finalTransform;\n\n    const newResizableLayer = {\n      id: context.resizableLayersSeed++,\n      position: normalizePoint([e.clientX - bcr.left, e.clientY - bcr.top]),\n      rotation: -transform.rotation,\n      scale: 1 / transform.scale,\n      type: 'text',\n      textInfo: {...editorState.currentTextLayerInfo}\n    } as ResizableLayer;\n\n    batch(() => {\n      mediaState.resizableLayers.push(newResizableLayer);\n      editorState.selectedResizableLayer = newResizableLayer.id;\n\n      actions.pushToHistory({\n        path: ['resizableLayers', mediaState.resizableLayers.length - 1],\n        newValue: newResizableLayer,\n        oldValue: HistoryItem.RemoveArrayItem,\n        findBy: {\n          id: newResizableLayer.id\n        }\n      });\n    });\n  }\n\n  return (\n    <div\n      class=\"media-editor__resizable-layers\"\n      classList={{\n        'media-editor__resizable-layers--active': canClick()\n      }}\n      style={{\n        cursor: !editorState.selectedResizableLayer && isTextTab() ? 'text' : undefined\n      }}\n    >\n      <div\n        ref={container}\n        class=\"media-editor__resizable-layers-inner\"\n        onClick={withCurrentOwner(addLayer)}\n        style={{\n          'opacity': editorState.isAdjusting ? 0 : 1\n        }}\n      >\n        <For each={mediaState.resizableLayers}>\n          {(layer) => (\n            <>\n              <Show when={layer.type === 'text'}>\n                <TextLayerContent layer={layer} />\n              </Show>\n              <Show when={layer.type === 'sticker'}>\n                <StickerLayerContent layer={layer} />\n              </Show>\n            </>\n          )}\n        </For>\n      </div>\n    </div>\n  );\n}\n\nexport function ResizableContainer(props: ParentProps<ResizableLayerProps>) {\n  const {editorState, mediaState} = useMediaEditorContext();\n\n  const isMobile = useIsMobile();\n  const processPoint = useProcessPoint(false);\n\n\n  const handleTyping = (): HTMLDivElement | undefined => undefined;\n\n  const store = createMutable({\n    diff: [0, 0] as NumberPair,\n    containerWidth: 0,\n    containerHeight: 0,\n    leftTopEl: handleTyping(),\n    rightTopEl: handleTyping(),\n    leftBottomEl: handleTyping(),\n    rightBottomEl: handleTyping()\n  });\n\n  const circleOffset = () => (isMobile() ? '-6px' : '-4px');\n  const canShowHandles = () => editorState.resizeHandlesContainer && props.layer.id === editorState.selectedResizableLayer;\n\n  const processedLayer = createMemo(() => ({\n    position: processPoint(props.layer.position),\n    rotation: props.layer.rotation + mediaState.rotation,\n    scale: editorState.finalTransform.scale * props.layer.scale\n  }));\n\n\n  let container: HTMLDivElement;\n\n  onMount(() => {\n    useResizeHandles({\n      container,\n      leftBottomEl: () => store.leftBottomEl,\n      leftTopEl: () => store.leftTopEl,\n      rightBottomEl: () => store.rightBottomEl,\n      rightTopEl: () => store.rightTopEl,\n\n      layer: props.layer,\n      diff: store.diff,\n      processedLayer\n    });\n\n    useContextMenu({container, layer: props.layer});\n\n    const unobserve = observeResize(container, () => {\n      store.containerWidth = container.clientWidth;\n      store.containerHeight = container.clientHeight;\n    });\n\n    onCleanup(() => {\n      unobserve();\n    });\n  });\n\n  return (\n    <div\n      class=\"media-editor__resizable-container\"\n      style={{\n        'left': processedLayer().position[0] + store.diff[0] + 'px',\n        'top': processedLayer().position[1] + store.diff[1] + 'px',\n        '--rotation': (processedLayer().rotation / Math.PI) * 180 + 'deg',\n        '--scale': processedLayer().scale\n      }}\n      onClick={() => {\n        editorState.selectedResizableLayer = props.layer.id;\n      }}\n      ref={container}\n    >\n      {props.children}\n\n      {canShowHandles() && <Portal mount={editorState.resizeHandlesContainer}>\n        <div\n          class=\"media-editor__resizable-container-handles\"\n          style={{\n            'left': processedLayer().position[0] + store.diff[0] + 'px',\n            'top': processedLayer().position[1] + store.diff[1] + 'px',\n            'width': store.containerWidth * processedLayer().scale + 'px',\n            'height': store.containerHeight * processedLayer().scale + 'px',\n            '--rotation': (processedLayer().rotation / Math.PI) * 180 + 'deg'\n          }}\n        >\n          <div\n            class=\"media-editor__resizable-container-border media-editor__resizable-container-border--vertical\"\n            style={{left: 0}}\n          />\n          <div\n            class=\"media-editor__resizable-container-border media-editor__resizable-container-border--vertical\"\n            style={{right: 0}}\n          />\n          <div\n            class=\"media-editor__resizable-container-border media-editor__resizable-container-border--horizontal\"\n            style={{top: 0}}\n          />\n          <div\n            class=\"media-editor__resizable-container-border media-editor__resizable-container-border--horizontal\"\n            style={{bottom: 0}}\n          />\n          <div\n            ref={(el) => store.leftTopEl = el}\n            class=\"media-editor__resizable-container-circle\"\n            style={{left: circleOffset(), top: circleOffset()}}\n          />\n          <div\n            ref={(el) => store.rightTopEl = el}\n            class=\"media-editor__resizable-container-circle\"\n            style={{right: circleOffset(), top: circleOffset()}}\n          />\n          <div\n            ref={(el) => store.leftBottomEl = el}\n            class=\"media-editor__resizable-container-circle\"\n            style={{left: circleOffset(), bottom: circleOffset()}}\n          />\n          <div\n            ref={(el) => store.rightBottomEl = el}\n            class=\"media-editor__resizable-container-circle\"\n            style={{right: circleOffset(), bottom: circleOffset()}}\n          />\n        </div>\n      </Portal>}\n    </div>\n  );\n}\n\n\ntype UseResizeArgs = {\n  container: HTMLDivElement;\n  leftTopEl: () => HTMLDivElement;\n  rightTopEl: () => HTMLDivElement;\n  leftBottomEl: () => HTMLDivElement;\n  rightBottomEl: () => HTMLDivElement;\n\n  diff: NumberPair;\n  layer: ResizableLayer;\n  processedLayer: Accessor<ProcessedLayer>;\n};\n\nfunction useResizeHandles({\n  container,\n  leftTopEl,\n  rightTopEl,\n  leftBottomEl,\n  rightBottomEl,\n  diff,\n  layer,\n  processedLayer\n}: UseResizeArgs) {\n  const {editorState, mediaState} = useMediaEditorContext();\n\n  const normalizePoint = useNormalizePoint();\n\n\n  let firstTarget: EventTarget;\n  let swipeStarted = false;\n\n  const multipliers = [\n    {el: leftTopEl, x: -1, y: -1},\n    {el: rightTopEl, x: 1, y: -1},\n    {el: leftBottomEl, x: -1, y: 1},\n    {el: rightBottomEl, x: 1, y: 1}\n  ];\n\n  multipliers.forEach(({el, x, y}) => {\n    createEffect(() => {\n      const element = el();\n      if(!element) return;\n\n      const swipeHandler = new SwipeHandler({\n        element,\n        onStart() {\n          element.classList.add('media-editor__resizable-container-circle--anti-flicker');\n        },\n        onSwipe(_, __, _e) {\n          const e = getEvent(_e);\n\n          if(!firstTarget) firstTarget = e.target;\n          if(firstTarget !== element) return;\n\n          const initialVector = [\n            (container.clientWidth / 2) * x * editorState.finalTransform.scale,\n            (container.clientHeight / 2) * y * editorState.finalTransform.scale\n          ];\n          const bcr = container.getBoundingClientRect();\n          const resizedVector = [bcr.left + bcr.width / 2 - e.clientX, bcr.top + bcr.height / 2 - e.clientY];\n\n          const rotationFromHorizon =\n            Math.atan2(resizedVector[1], resizedVector[0]) - Math.atan2(initialVector[1], initialVector[0]) + Math.PI;\n          const scale = Math.hypot(resizedVector[0], resizedVector[1]) / Math.hypot(initialVector[0], initialVector[1]);\n\n          modifyMutable(layer, produce(s => {\n            s.rotation = rotationFromHorizon - mediaState.rotation;\n            s.scale = scale;\n          }));\n        },\n        onReset() {\n          element.classList.remove('media-editor__resizable-container-circle--anti-flicker');\n          firstTarget = undefined;\n        }\n      });\n      onCleanup(() => {\n        swipeHandler.removeListeners();\n      });\n    });\n  });\n\n\n  const moveHandler = new SwipeHandler({\n    element: container,\n    onSwipe(xDiff, yDiff, e) {\n      if(!firstTarget) firstTarget = e.target;\n      if(multipliers.find(({el}) => el() === firstTarget)) return;\n\n      if(!swipeStarted) {\n        // onStart messes up the typing\n        swipeStarted = true;\n        editorState.selectedResizableLayer = layer.id;\n      }\n\n      diff.splice(0, 2, xDiff, yDiff);\n    },\n    onReset() {\n      layer.position = normalizePoint([processedLayer().position[0] + diff[0], processedLayer().position[1] + diff[1]]);\n      diff.splice(0, 2, 0, 0);\n      swipeStarted = false;\n      firstTarget = undefined;\n    }\n  });\n\n  onCleanup(() => {\n    moveHandler.removeListeners();\n  });\n}\n\n\ntype UseContextMenuArgs = {\n  container: HTMLDivElement;\n  layer: ResizableLayer;\n}\n\nfunction useContextMenu({container, layer}: UseContextMenuArgs) {\n  const {editorState, mediaState, actions} = useMediaEditorContext();\n\n  function onClick() {\n    const layers = mediaState.resizableLayers;\n    const idx = layers.findIndex(otherLayer => otherLayer.id === layer.id);\n    if(idx < 0) return;\n\n    batch(() => {\n      editorState.selectedResizableLayer = undefined;\n      const deletedLayer = layers.splice(idx, 1)[0];\n\n      actions.pushToHistory({\n        path: ['resizableLayers', idx],\n        newValue: HistoryItem.RemoveArrayItem,\n        oldValue: deletedLayer,\n        findBy: {\n          id: deletedLayer.id\n        }\n      });\n    });\n  }\n\n  const contextMenu = createContextMenu({\n    buttons: [\n      {\n        icon: 'delete',\n        className: 'danger',\n        text: 'Delete',\n        onClick\n      }\n    ],\n    listenTo: container,\n    onElementReady: (element) => {\n      element.classList.add('night');\n    }\n  });\n\n  onCleanup(() => {\n    contextMenu.destroy();\n  });\n}\n","import {modifyMutable, produce} from 'solid-js/store'\n\nimport {animateValue, lerp, lerpArray, snapToViewport} from '../utils';\nimport {useMediaEditorContext} from '../context';\nimport {NumberPair} from '../types';\n\nimport {useCropOffset} from './useCropOffset';\n\nexport function animateToNewRotationOrRatio(newRotation: number) {\n  const {editorState, mediaState} = useMediaEditorContext();\n  if(!editorState.imageSize) return;\n\n  const cropOffset = useCropOffset();\n\n  const [w, h] = editorState.imageSize;\n\n  const snappedRotation90 = Math.round((newRotation / Math.PI) * 2);\n  const isReversedRatio = Math.abs(snappedRotation90) & 1;\n  const snappedRotation = (snappedRotation90 * Math.PI) / 2;\n\n  let ratio: number;\n\n  if(editorState.fixedImageRatioKey?.includes('x')) {\n    const parts = editorState.fixedImageRatioKey.split('x');\n    ratio = parseInt(parts[0]) / parseInt(parts[1]);\n  } else {\n    ratio = isReversedRatio ? h / w : w / h;\n  }\n\n  const originalRatio = w / h;\n\n  const [w1, h1] = snapToViewport(originalRatio, cropOffset().width, cropOffset().height);\n  const [w2, h2] = snapToViewport(ratio, cropOffset().width, cropOffset().height);\n\n  const initialScale = mediaState.scale;\n  const initialTranslation = mediaState.translation;\n  const initialRotation = mediaState.rotation;\n  const targetScale = isReversedRatio ? Math.max(w2 / h1, h2 / w1) : Math.max(w2 / w1, h2 / h1);\n  const targetTranslation = [0, 0];\n  const targetRotation = snappedRotation;\n\n  mediaState.currentImageRatio = ratio;\n  editorState.isMoving = true;\n\n  animateValue(\n    0,\n    1,\n    200,\n    (progress) => {\n      modifyMutable(mediaState, produce((state) => {\n        state.scale = lerp(initialScale, targetScale, progress);\n        state.translation = lerpArray(initialTranslation, targetTranslation, progress) as NumberPair;\n        state.rotation = lerp(initialRotation, targetRotation, progress);\n      }));\n    },\n    {\n      onEnd: () => {\n        editorState.isMoving = false;\n        mediaState.rotation = mediaState.rotation % (Math.PI * 2);\n      }\n    }\n  );\n}\n","import {batch, createEffect, createSignal, on, onCleanup, onMount} from 'solid-js';\nimport {modifyMutable, produce} from 'solid-js/store';\n\nimport clamp from '../../../helpers/number/clamp';\n\nimport {ButtonIconTsx} from '../../buttonIconTsx';\nimport SwipeHandler from '../../swipeHandler';\n\nimport {animateValue, lerp, withCurrentOwner} from '../utils';\nimport {useMediaEditorContext} from '../context';\nimport {NumberPair} from '../types';\n\nimport {animateToNewRotationOrRatio} from './animateToNewRotationOrRatio';\nimport getConvenientPositioning from './getConvenientPositioning';\n\nconst DEGREE_DIST_PX = 42;\nconst DEGREE_STEP = 15;\nconst TOTAL_DEGREES_SIDE = 90;\nconst MAX_DEGREES_DIST_PX = (TOTAL_DEGREES_SIDE / DEGREE_STEP) * DEGREE_DIST_PX;\nconst SNAP_DIST_PX = 40;\n\nfunction rotationFromMove(amount: number) {\n  return ((amount / DEGREE_DIST_PX) * DEGREE_STEP * Math.PI) / 180;\n}\n\nexport default function RotationWheel() {\n  const {editorState, mediaState, actions} = useMediaEditorContext();\n\n  const isCropping = () => editorState.currentTab === 'crop';\n\n  const [moved, setMoved] = createSignal(0);\n  const [movedDiff, setMovedDiff] = createSignal(0);\n\n  let swiperEl: HTMLDivElement;\n\n  onMount(() => {\n    const snappedRotation = (Math.round((mediaState.rotation / Math.PI) * 2) * Math.PI) / 2;\n    setMoved((((snappedRotation - mediaState.rotation) * 180) / Math.PI / DEGREE_STEP) * DEGREE_DIST_PX);\n    prevRotation = rotationFromMove(moved());\n\n    let currentDiff: number;\n    let targetDiff: number;\n    let prevShouldSnap = getShouldSnap();\n    let isAnimating = false;\n    let isSnapped = false;\n    let cancelAnimation: () => void;\n    let timeoutId: number;\n\n    function getShouldSnap() {\n      return Math.abs(moved() + currentDiff || 0) < SNAP_DIST_PX\n    }\n\n    function handleDiffChange(diff: number) {\n      setMovedDiff(diff);\n      onSwipe();\n    }\n\n    function removeSnapAfterTimeout() {\n      timeoutId = window.setTimeout(() => {\n        isSnapped = false;\n        isAnimating = true;\n\n        const initialDiff = movedDiff();\n        cancelAnimation?.();\n        cancelAnimation = animateValue(0, 1, 200, (progress) => {\n          handleDiffChange(lerp(initialDiff, currentDiff, progress));\n        }, {\n          onEnd: () => {\n            isAnimating = false\n          }\n        });\n      }, 750);\n    }\n\n    const swipeHandler = new SwipeHandler({\n      element: swiperEl,\n      onStart() {\n        initialScale = mediaState.scale;\n        currentDiff = movedDiff();\n        targetDiff = currentDiff;\n        isAnimating = false;\n        isSnapped = false;\n        prevShouldSnap = getShouldSnap();\n        editorState.isMoving = true;\n      },\n      onSwipe(xDiff) {\n        targetDiff = currentDiff = clamp(moved() + xDiff, -MAX_DEGREES_DIST_PX, MAX_DEGREES_DIST_PX) - moved();\n        const shouldSnap = getShouldSnap();\n        if(shouldSnap) targetDiff = -moved();\n\n        if(prevShouldSnap !== shouldSnap) {\n          window.clearTimeout(timeoutId);\n          timeoutId = window.setTimeout(() => {\n            const shouldSnapAfterTimeout = getShouldSnap();\n            if(shouldSnapAfterTimeout !== shouldSnap) return;\n            isAnimating = true;\n            const initialDiff = movedDiff();\n            cancelAnimation?.();\n            cancelAnimation = animateValue(0, 1, 200, (progress) => {\n              handleDiffChange(lerp(initialDiff, targetDiff, progress));\n            }, {\n              onEnd: () => {\n                isAnimating = false;\n                isSnapped = getShouldSnap();\n\n                if(!isSnapped) return;\n                removeSnapAfterTimeout();\n              }\n            });\n          }, 200);\n        }\n\n        prevShouldSnap = shouldSnap;\n\n        if(isAnimating || isSnapped) return;\n        handleDiffChange(currentDiff);\n      },\n      onReset() {\n        let newMoved = moved() + movedDiff();\n        if(Math.abs(newMoved) === MAX_DEGREES_DIST_PX) {\n          newMoved = 0;\n          prevRotation = 0;\n          prevShouldSnap = false;\n          isAnimating = false;\n        }\n        cancelAnimation?.();\n        window.clearTimeout(timeoutId);\n        batch(() => {\n          setMoved(newMoved);\n          setMovedDiff(0);\n          editorState.isMoving = false;\n          mediaState.rotation = mediaState.rotation % (Math.PI * 2)\n        });\n      }\n    });\n\n    onCleanup(() => {\n      swipeHandler.removeListeners();\n    });\n  });\n\n  let prevRotation = 0;\n  let initialScale = 0;\n\n  const onSwipe = withCurrentOwner(() => {\n    const rotationFromSwiper = rotationFromMove(moved() + movedDiff());\n    const rotationDiff = rotationFromSwiper - prevRotation;\n\n    const targetRotation = mediaState.rotation - rotationDiff;\n\n    const r = [Math.cos(rotationDiff), Math.sin(rotationDiff)];\n\n    const targetTranslation: NumberPair = [\n      mediaState.translation[0] * r[0] + mediaState.translation[1] * r[1],\n      mediaState.translation[1] * r[0] - mediaState.translation[0] * r[1]\n    ];\n\n    prevRotation = rotationFromSwiper;\n\n    if(!initialScale) return;\n    const {cropMinX, cropMaxX, cropMinY, cropMaxY, imageMinX, imageMaxX, imageMinY, imageMaxY} =\n      getConvenientPositioning({\n        scale: initialScale,\n        rotation: targetRotation,\n        translation: targetTranslation\n      });\n\n    const halfImageWidth = (imageMaxX - imageMinX) / 2,\n      halfImageHeight = (imageMaxY - imageMinY) / 2;\n    const imageCenter = [imageMinX + halfImageWidth, imageMinY + halfImageHeight];\n\n    let additionalScale = 1;\n\n    if(imageMinX > cropMinX) additionalScale = Math.max((imageCenter[0] - cropMinX) / halfImageWidth, additionalScale);\n    if(imageMaxX < cropMaxX) additionalScale = Math.max((cropMaxX - imageCenter[0]) / halfImageWidth, additionalScale);\n    if(imageMinY > cropMinY)\n      additionalScale = Math.max((imageCenter[1] - cropMinY) / halfImageHeight, additionalScale);\n    if(imageMaxY < cropMaxY)\n      additionalScale = Math.max((cropMaxY - imageCenter[1]) / halfImageHeight, additionalScale);\n\n\n    modifyMutable(mediaState, produce(s => {\n      s.rotation = targetRotation;\n      s.translation = targetTranslation;\n      if(additionalScale > 1) {\n        s.scale = initialScale * additionalScale;\n      }\n    }));\n  });\n\n  function resetWheelWithAnimation() {\n    prevRotation = 0;\n    animateValue([moved(), movedDiff()], [0, 0], 200, (values) => {\n      batch(() => {\n        setMoved(values[0]);\n        setMovedDiff(values[1]);\n      });\n    });\n  }\n\n  actions.resetRotationWheel = () => resetWheelWithAnimation();\n  onCleanup(() => {\n    actions.resetRotationWheel = () => {}\n  });\n\n  let isFirstEffect = true;\n  createEffect(\n    on(() => editorState.fixedImageRatioKey, () => {\n      if(isFirstEffect) {\n        isFirstEffect = false;\n        return;\n      }\n      resetWheelWithAnimation();\n    })\n  );\n\n  function rotateLeft() {\n    const newRotation = (Math.round((mediaState.rotation / Math.PI) * 2) * Math.PI) / 2 - Math.PI / 2;\n\n    animateToNewRotationOrRatio(newRotation);\n\n    resetWheelWithAnimation();\n  }\n\n  function flipImage() {\n    editorState.isMoving = true;\n    const isReversedRatio = Math.abs(Math.round((mediaState.rotation / Math.PI) * 2)) & 1;\n    const snapTo1 = (value: number) => value < 0 ? -1 : 1;\n    const targetFlip: NumberPair = [\n      snapTo1(mediaState.flip[0]) * (isReversedRatio ? 1 : -1),\n      snapTo1(mediaState.flip[1]) * (isReversedRatio ? -1 : 1)\n    ];\n    animateValue(mediaState.flip, targetFlip, 200, (value) => void (mediaState.flip = value), {\n      onEnd: () => void (editorState.isMoving = false)\n    });\n  }\n\n  const value = () =>\n    ((-(moved() + movedDiff()) / DEGREE_DIST_PX) * DEGREE_STEP)\n    .toFixed(1)\n    .replace(/\\.0$/, '')\n    .replace(/^-0$/, '0');\n\n  return (\n    <div class=\"media-editor__rotation-wheel\" style={{display: isCropping() ? undefined : 'none'}}>\n      <ButtonIconTsx onClick={withCurrentOwner(rotateLeft)} class=\"media-editor__rotation-wheel-button\" icon=\"rotate\" />\n      <div class=\"media-editor__rotation-wheel-swiper-wrapper\">\n        <div\n          ref={swiperEl}\n          style={{['--moved']: moved() + movedDiff() + 'px'}}\n          class=\"media-editor__rotation-wheel-swiper\"\n        >\n          <div class=\"media-editor__rotation-wheel-labels\">\n            {new Array(13).fill(null).map((_, i) => (\n              <div class=\"media-editor__rotation-wheel-label\">\n                <div class=\"media-editor__rotation-wheel-label-number\">{i * 15 - 90}</div>\n              </div>\n            ))}\n          </div>\n          <div class=\"media-editor__rotation-wheel-dots\">\n            {new Array(97).fill(null).map(() => (\n              <div class=\"media-editor__rotation-wheel-dot\" />\n            ))}\n          </div>\n        </div>\n      </div>\n      <div class=\"media-editor__rotation-wheel-value\">\n        <div class=\"media-editor__rotation-wheel-value-number\">{value()}</div>\n      </div>\n      <ArrowUp />\n      <ButtonIconTsx onClick={flipImage} class=\"media-editor__rotation-wheel-button\" icon=\"flip_image_horizontal\" />\n    </div>\n  );\n}\n\nfunction ArrowUp() {\n  return (\n    <svg\n      class=\"media-editor__rotation-wheel-arrow\"\n      width=\"6\"\n      height=\"4\"\n      viewBox=\"0 0 6 4\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        d=\"M2.29289 0.707106L0.28033 2.71967C-0.192143 3.19214 0.142482 4 0.81066 4H5.18934C5.85752 4 6.19214 3.19214 5.71967 2.71967L3.70711 0.707107C3.31658 0.316583 2.68342 0.316582 2.29289 0.707106Z\"\n        fill=\"white\"\n      />\n    </svg>\n  );\n}\n","import {batch, createEffect, createMemo, createSignal, on, onCleanup} from 'solid-js';\nimport {modifyMutable, produce} from 'solid-js/store';\n\nimport {animateValue, getSnappedViewportsScale, lerp, lerpArray} from '../utils';\nimport {useMediaEditorContext} from '../context';\nimport {NumberPair} from '../types';\n\nimport {useCropOffset} from './useCropOffset';\n\nexport type FinalTransform = {\n  flip: NumberPair;\n  translation: NumberPair;\n  rotation: number;\n  scale: number;\n};\n\nexport default function useFinalTransform() {\n  const {editorState, mediaState} = useMediaEditorContext();\n\n  const cropOffset = useCropOffset();\n\n  const isCropping = createMemo(() => editorState.currentTab === 'crop');\n\n  const [cropTabAnimationProgress, setCropTabAnimationProgress] = createSignal(0);\n\n  let isFirstEffect = true;\n  createEffect(\n    on(isCropping, () => {\n      if(isFirstEffect) {\n        isFirstEffect = false;\n        return;\n      }\n\n      editorState.isMoving = true;\n\n      const cancel = animateValue(cropTabAnimationProgress(), isCropping() ? 1 : 0, 200, setCropTabAnimationProgress, {\n        onEnd: () => editorState.isMoving = false\n      });\n\n      onCleanup(cancel);\n    })\n  );\n\n  const [prevCanvasSize, setPrevCanvasSize] = createSignal<NumberPair>();\n  const [prevCropTranslation, setPrevCropTranslation] = createSignal<NumberPair>();\n  const [prevAdditionalScale, setPrevAdditionalScale] = createSignal<number>();\n\n  const additionalImageScales = createMemo(() => {\n    const payload = editorState.renderingPayload;\n    if(!payload || !editorState.canvasSize) return;\n\n    const [w, h] = editorState.canvasSize;\n\n    const imageRatio = payload.media.width / payload.media.height;\n\n    const toCropScale = getSnappedViewportsScale(imageRatio, cropOffset().width, cropOffset().height, w, h);\n    const fromCroppedScale =\n      1 / getSnappedViewportsScale(mediaState.currentImageRatio, cropOffset().width, cropOffset().height, w, h);\n\n    const snappedImageScale = Math.min(w / payload.media.width, h / payload.media.height);\n\n    return {\n      toCropScale,\n      fromCroppedScale,\n      snappedImageScale\n    };\n  });\n\n  const cropTrnsl = createMemo(() => {\n    if(!editorState.canvasSize || !additionalImageScales()) return;\n    const {fromCroppedScale} = additionalImageScales();\n\n    return mediaState.translation.map((x) => x * fromCroppedScale - x) as NumberPair;\n  });\n\n  const cropTranslation = createMemo(() => {\n    if(!editorState.canvasSize || !additionalImageScales()) return;\n    const [, h] = editorState.canvasSize;\n    const {fromCroppedScale} = additionalImageScales();\n\n    return lerpArray(\n      mediaState.translation.map((x) => x * fromCroppedScale - x),\n      [0, cropOffset().left + cropOffset().height / 2 - h / 2],\n      cropTabAnimationProgress()\n    ) as NumberPair;\n  });\n\n  let prevScale: number;\n  let prevTranslation: NumberPair;\n\n  function updatePrevValues() {\n    if(!additionalImageScales() || !cropTrnsl()) return;\n    const {toCropScale, fromCroppedScale, snappedImageScale} = additionalImageScales();\n    prevScale = toCropScale * snappedImageScale * fromCroppedScale;\n    prevTranslation = cropTrnsl();\n  }\n\n  createEffect(\n    on(cropTabAnimationProgress, () => {\n      if([0, 1].includes(cropTabAnimationProgress())) updatePrevValues();\n    })\n  );\n  createEffect(\n    on(() => mediaState.currentImageRatio, () => {\n      updatePrevValues();\n    })\n  );\n\n  createEffect(\n    on(() => editorState.canvasSize, () => {\n      if(!editorState.canvasSize || !additionalImageScales()) return;\n      const prevSize = editorState.canvasSize;\n      const {toCropScale, fromCroppedScale, snappedImageScale} = additionalImageScales();\n      prevScale = toCropScale * snappedImageScale * fromCroppedScale;\n      prevTranslation = cropTrnsl();\n\n      onCleanup(() => {\n        batch(() => {\n          setPrevCanvasSize(prevSize);\n          setPrevAdditionalScale(prevScale);\n          setPrevCropTranslation(prevTranslation);\n        });\n      });\n    })\n  );\n\n  createEffect(\n    on(prevCanvasSize, () => {\n      if(!prevCanvasSize || !prevAdditionalScale()) return;\n      const currentSize = editorState.canvasSize;\n      const {toCropScale, fromCroppedScale, snappedImageScale} = additionalImageScales();\n      const currentAdditionalScale = toCropScale * snappedImageScale * fromCroppedScale;\n\n      const scaleToChange = getSnappedViewportsScale(\n        mediaState.currentImageRatio,\n        currentSize[0],\n        currentSize[1],\n        prevCanvasSize()[0],\n        prevCanvasSize()[1]\n      );\n      const counterScale = prevAdditionalScale() / currentAdditionalScale;\n\n      const totalScale = scaleToChange * counterScale;\n\n      // const translationDiff = [\n      //   prevCropTranslation()[0] - cropTrnsl()[0],\n      //   prevCropTranslation()[1] - cropTrnsl()[1]\n      // ];\n      // console.log('translationDiff', translationDiff)\n\n      modifyMutable(mediaState, produce((state) => {\n        state.scale = state.scale * totalScale,\n        state.translation = state.translation.map((v) => v * totalScale) as NumberPair\n      }));\n    })\n  );\n\n  createEffect(() => {\n    const payload = editorState.renderingPayload;\n    if(!payload) return;\n\n    let {fromCroppedScale, toCropScale, snappedImageScale} = additionalImageScales();\n\n    toCropScale *= lerp(fromCroppedScale, 1, cropTabAnimationProgress());\n\n    // const cropTranslation = lerpArray(\n    //   translation().map((x) => x * fromCroppedScale - x),\n    //   [0, cropOffset().left + cropOffset().height / 2 - h / 2],\n    //   cropTabAnimationProgress()\n    // );\n    // console.log('cropTranslation', cropTranslation)\n\n    modifyMutable(editorState.finalTransform, produce(t => {\n      t.flip = mediaState.flip,\n      t.rotation = mediaState.rotation,\n      t.scale = mediaState.scale * editorState.pixelRatio * snappedImageScale * toCropScale;\n      t.translation = [cropTranslation()[0] + mediaState.translation[0], cropTranslation()[1] + mediaState.translation[1]].map(\n        (v) => v * editorState.pixelRatio\n      ) as NumberPair\n    }));\n  });\n}\n","import {onCleanup} from 'solid-js';\n\ntype PossibleEvent = DocumentEventMap[keyof DocumentEventMap];\n\ntype EventsMapValue = {\n  callbacks: Array<(e: PossibleEvent) => void>;\n  listener: (e: PossibleEvent) => void;\n};\n\nconst eventsMap = new Map<keyof DocumentEventMap, EventsMapValue>;\n\nexport function registerGlobalDocumentEvent<Key extends keyof DocumentEventMap>(eventName: Key, callback: (e: DocumentEventMap[Key]) => void) {\n  const value: EventsMapValue = eventsMap.get(eventName) || {\n    callbacks: [],\n    listener: (e) => {\n      value.callbacks.forEach(clb => clb(e));\n    }\n  };\n\n  if(!eventsMap.has(eventName)) {\n    eventsMap.set(eventName, value);\n    document.addEventListener(eventName, value.listener);\n  }\n\n  value.callbacks.push(callback as (e: PossibleEvent) => void);\n\n  return {\n    cleanup: () => {\n      value.callbacks = value.callbacks.filter(clb => clb !== callback);\n      if(value.callbacks.length) return;\n\n      eventsMap.delete(eventName);\n      document.removeEventListener(eventName, value.listener);\n    }\n  }\n}\n\nexport default function useGlobalDocumentEvent<Key extends keyof DocumentEventMap>(eventName: Key, callback: (e: DocumentEventMap[Key]) => void) {\n  const {cleanup} = registerGlobalDocumentEvent(eventName, callback);\n\n  onCleanup(cleanup);\n};\n","import {StandardLonghandPropertiesHyphen} from 'csstype';\nimport {Accessor, onCleanup} from 'solid-js';\nimport useGlobalDocumentEvent from './useGlobalDocumentEvent';\n\n\nexport type SwipeDirectiveArgs = {\n  globalCursor?: Accessor<StandardLonghandPropertiesHyphen['cursor']>;\n  onStart?: (e: PointerEvent | TouchEvent) => void;\n  onMove?: (xDiff: number, yDiff: number, e: PointerEvent | TouchEvent) => void;\n  onEnd?: (xDiff: number, yDiff: number, e: PointerEvent | TouchEvent) => void;\n};\n\ndeclare module 'solid-js' {\n  namespace JSX {\n    interface Directives {\n      swipe: SwipeDirectiveArgs;\n    }\n  }\n}\n\nexport default function swipe(element: HTMLElement, args: Accessor<SwipeDirectiveArgs>) {\n  let isDragging = false;\n  let initialX: number, initialY: number;\n\n  const getDiffPointer = (e: PointerEvent) => [\n    e.clientX - initialX,\n    e.clientY - initialY\n  ] as const;\n\n  const getDiffTouch = (e: TouchEvent) => [\n    e.changedTouches[0].clientX - initialX,\n    e.changedTouches[0].clientY - initialY\n  ] as const;\n\n  function handleStart(e: PointerEvent | TouchEvent, x: number, y: number) {\n    if(isDragging) return;\n    isDragging = true;\n    initialX = x;\n    initialY = y;\n\n    const {onStart, globalCursor} = args();\n    onStart?.(e);\n\n    if(globalCursor) {\n      document.body.style.setProperty('cursor', globalCursor(), 'important');\n      element.style.setProperty('cursor', globalCursor(), 'important');\n    }\n  }\n\n  function handleMove(e: PointerEvent | TouchEvent, diff: readonly [number, number]) {\n    if(!isDragging) return;\n\n    const {onMove} = args();\n    onMove?.(...diff, e);\n  }\n\n  function handleEnd(e: PointerEvent | TouchEvent, diff: readonly [number, number]) {\n    if(!isDragging) return;\n\n    const {onEnd, globalCursor} = args();\n    onEnd?.(...diff, e);\n    if(globalCursor) {\n      document.body.style.removeProperty('cursor');\n      element.style.removeProperty('cursor');\n    }\n\n    isDragging = false;\n    initialX = initialY = undefined;\n  }\n\n  element.addEventListener('pointerdown', (e) => {\n    handleStart(e, e.clientX, e.clientY);\n  });\n\n  element.addEventListener('touchstart', (e) => {\n    handleStart(e, e.changedTouches[0].clientX, e.changedTouches[0].clientY);\n  });\n\n  useGlobalDocumentEvent('pointermove', (e) => {\n    handleMove(e, getDiffPointer(e));\n  });\n\n  useGlobalDocumentEvent('touchmove', (e) => {\n    handleMove(e, getDiffTouch(e));\n  });\n\n  useGlobalDocumentEvent('pointermove', (e) => {\n    handleMove(e, getDiffPointer(e));\n  });\n\n  useGlobalDocumentEvent('pointerup', (e) => {\n    handleEnd(e, getDiffPointer(e));\n  });\n\n  useGlobalDocumentEvent('touchend', (e) => {\n    handleEnd(e, getDiffTouch(e));\n  });\n}\n","import {createEffect, onCleanup} from 'solid-js';\nimport deferredPromise from '../../../helpers/cancellablePromise';\nimport createMiddleware from '../../../helpers/solid/createMiddleware';\nimport {useMediaEditorContext} from '../context';\nimport {snapToViewport} from '../utils';\nimport createVideoForDrawing from './createVideoForDrawing';\nimport styles from './videoControls.module.scss';\n\ntype Args = {\n  getCanvas: () => HTMLCanvasElement;\n  size: {\n    width: number;\n    height: number;\n  };\n};\n\nexport default function useVideoControlsCanvas({getCanvas, size}: Args) {\n  const {editorState, mediaSrc} = useMediaEditorContext();\n\n  createEffect(() => {\n    const media = editorState.renderingPayload?.media;\n    const canvas = getCanvas();\n    if(!media || !canvas || !size.width || !size.height) return;\n\n    const ratio = media.width / media.height;\n\n    const ctx = canvas.getContext('2d');\n\n    let\n      deferred = deferredPromise<void>(),\n      cleaned = false\n    ;\n\n    onCleanup(() => {\n      cleaned = true;\n      deferred?.resolve();\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\n    });\n\n    const middleware = createMiddleware().get();\n\n    (async() => {\n      const video = await createVideoForDrawing(mediaSrc, {currentTime: 0, middleware});\n      // (window as any).myWeakRef = new WeakRef(video); // works\n\n      if(cleaned) return;\n\n      video.addEventListener('seeked', () => {\n        deferred?.resolve();\n      });\n\n      const [chunkWidth, chunkHeight] = snapToViewport(ratio, size.width, size.height);\n\n      for(let x = 0; x < size.width; x += chunkWidth) {\n        deferred = deferredPromise();\n        video.currentTime = x / size.width * video.duration;\n\n        await deferred;\n        if(cleaned) return;\n\n        ctx.drawImage(video, x, 0, chunkWidth, chunkHeight);\n\n        const fade = document.createElement('div');\n\n        fade.classList.add(styles.FrameFade);\n        fade.style.top = '0px';\n        fade.style.left = x + 'px';\n        fade.style.width = chunkWidth + 0.5 + 'px'; // add a few px to prevent unexpected borders\n        fade.style.height = chunkHeight + 'px';\n\n        canvas.after(fade);\n\n        fade.animate({opacity: [1, 0]}, {duration: 500, easing: 'ease-in-out'}).finished\n        .then(() => fade.remove());\n      }\n    })();\n  });\n}\n","import {batch, Component, createMemo, createSignal} from 'solid-js';\n\nimport clamp from '../../../helpers/number/clamp';\nimport swipe, {SwipeDirectiveArgs} from '../../../helpers/useSwipe'; swipe; // keep\nimport useElementSize from '../../../hooks/useElementSize';\nimport {i18n} from '../../../lib/langPack';\n\nimport {IconTsx} from '../../iconTsx';\nimport ripple from '../../ripple'; ripple; // keep\nimport showTooltip from '../../tooltip';\n\nimport {SetVideoTimeFlags, useMediaEditorContext} from '../context';\n\nimport useVideoControlsCanvas from './useVideoControlsCanvas';\n\nimport styles from './videoControls.module.scss';\n\n\nconst HANDLE_WIDTH_PX = 9;\nconst MOVE_ACTIVATION_THRESHOLD_PX = 2;\n\nconst VideoControls: Component<{}> = () => {\n  const {editorState, mediaState, actions} = useMediaEditorContext();\n\n  const [cropper, setCropper] = createSignal<HTMLDivElement>();\n  const [isDraggingSomething, setIsDraggingSomething] = createSignal(false);\n\n  const cropperSize = useElementSize(cropper);\n  const strippedWidth = () => cropperSize.width - 2 * HANDLE_WIDTH_PX;\n\n  const shouldShowTime = () => isDraggingSomething() && (swiping === 'left' || swiping === 'right');\n\n  const formattedResultingTime = createMemo(() => {\n    if(!shouldShowTime()) return '';\n    const video = editorState.renderingPayload?.media?.video;\n    if(!video) return '';\n\n    const totalSeconds = mediaState.videoCropLength * video.duration;\n    let ts = totalSeconds;\n\n    const hh = (Math.floor(ts / 3600) + '').padStart(2, '0');\n    ts -= +hh * 3600;\n    const mm = (Math.floor(ts / 60) + '').padStart(2, '0');\n    ts -= +mm * 60;\n    const ss = (Math.floor(ts) + '').padStart(2, '0');\n    ts -= +ss;\n    const decimal = (Math.floor(ts * 4) * 25 + '').replace(/0$/, '');\n\n    return (+hh ? `${hh}:` : '') + `${mm}:${ss}` + (decimal && totalSeconds < 10 ? `.${decimal}` : '');\n  });\n\n  const minLength = createMemo(() => {\n    const duration = editorState.renderingPayload?.media?.video?.duration;\n    if(!duration) return 0;\n    return Math.min(1, 0.5 / duration);\n  });\n\n  let\n    canvas: HTMLCanvasElement,\n    initialStart: number,\n    initialLength: number,\n    swiping: 'left' | 'middle' | 'right' | 'cursor';\n  ;\n\n  useVideoControlsCanvas({\n    getCanvas: () => canvas,\n    size: cropperSize\n  });\n\n  const leftHandleSwipeArgs: SwipeDirectiveArgs = {\n    globalCursor: () => 'ew-resize',\n    onStart: () => {\n      swiping = 'left';\n      initialStart = mediaState.videoCropStart;\n      initialLength = mediaState.videoCropLength;\n\n      batch(() => {\n        setIsDraggingSomething(true);\n        editorState.isPlaying = false;\n      });\n    },\n    onMove: (xDiff) => void batch(() => {\n      if(swiping !== 'left') return;\n      const diff = clamp(initialStart + xDiff / strippedWidth(), 0, Math.max(0, initialStart + initialLength - minLength())) - initialStart;\n      batch(() => {\n        mediaState.videoCropStart = (initialStart + diff);\n        mediaState.videoCropLength = (initialLength - diff);\n        actions.setVideoTime(mediaState.videoCropStart);\n      });\n    }),\n    onEnd: () => void setIsDraggingSomething(false)\n  };\n\n  const rightHandleSwipeArgs: SwipeDirectiveArgs = {\n    globalCursor: () => 'ew-resize',\n    onStart: () => {\n      swiping = 'right';\n      initialLength = mediaState.videoCropLength;\n\n      batch(() => {\n        setIsDraggingSomething(true);\n        editorState.isPlaying = false;\n      });\n    },\n    onMove: (xDiff) => void batch(() => {\n      if(swiping !== 'right') return;\n      const maxLength = 1 - mediaState.videoCropStart;\n      mediaState.videoCropLength = (clamp(initialLength + xDiff / strippedWidth(), Math.min(minLength(), maxLength), maxLength));\n      actions.setVideoTime(mediaState.videoCropStart + mediaState.videoCropLength);\n    }),\n    onEnd: () => void setIsDraggingSomething(false)\n  };\n\n  let canMove = false;\n\n  const middleSwipeArgs: SwipeDirectiveArgs = {\n    globalCursor: () => initialLength === 1 ? 'col-resize' : 'grabbing',\n    onStart: (e) => {\n      swiping = 'middle';\n      initialStart = mediaState.videoCropStart;\n      initialLength = mediaState.videoCropLength;\n      canMove = false;\n\n      if(initialLength === 1) {\n        setIsDraggingSomething(true);\n        canMove = true;\n        handleCursorMove(e);\n      }\n    },\n    onMove: (xDiff, _, e) => void batch((): void => {\n      if(swiping !== 'middle') return;\n      if(initialLength === 1) return void handleCursorMove(e);\n\n      if(Math.abs(xDiff) > MOVE_ACTIVATION_THRESHOLD_PX) canMove = true;\n      if(!canMove) return;\n\n      const startDiff = clamp(initialStart + xDiff / strippedWidth(), 0, Math.max(0, 1 - Math.max(initialLength, minLength()))) - initialStart;\n      batch(() => {\n        setIsDraggingSomething(true);\n        editorState.isPlaying = false;\n\n        mediaState.videoCropStart = initialStart + startDiff;\n        // mediaState.videoCropLength = clamp(initialLength - startDiff + xDiff / strippedWidth(), Math.min(1, minLength()), 1 - mediaState.videoCropStart);\n\n        actions.setVideoTime(mediaState.videoCropStart);\n      });\n    }),\n    onEnd: () => {\n      self.setTimeout(() => {\n        setIsDraggingSomething(false);\n      }, 0); // prevent trigger click after finishing dragging\n    }\n  };\n\n  const cursorSwipeArgs: SwipeDirectiveArgs = {\n    globalCursor: () => 'col-resize',\n    onStart: () => {\n      swiping = 'cursor';\n      setIsDraggingSomething(true);\n    },\n    onMove: (xDiff, __, e) => {\n      if(swiping !== 'cursor') return;\n      // if(Math.abs(xDiff) > MOVE_ACTIVATION_THRESHOLD_PX)\n      editorState.isPlaying = false;\n      handleCursorMove(e);\n    },\n    onEnd: () => void setIsDraggingSomething(false)\n  };\n\n  const handleCursorMove = (e: PointerEvent | TouchEvent) => {\n    editorState.isPlaying = false;\n    actions.setVideoTime(clamp(getPositionInCropper(e, cropper()), mediaState.videoCropStart, mediaState.videoCropStart + mediaState.videoCropLength));\n  };\n\n  const onMiddlePartClick = (e: MouseEvent) => {\n    if(!cropper() || isDraggingSomething()) return;\n\n    actions.setVideoTime(clamp(getPositionInCropper(e, cropper()), mediaState.videoCropStart, mediaState.videoCropStart + mediaState.videoCropLength));\n  };\n\n  const showMutedTooltip = (el: HTMLElement) => showTooltip({\n    element: el,\n    mountOn: el.parentElement.parentElement.parentElement,\n    vertical: 'top',\n    textElement: i18n('MediaEditor.VideoMutedTooltip'),\n    lighter: true,\n    auto: true\n  });\n\n  let closeTooltip: () => void;\n\n  return (\n    <div\n      class={styles.Container}\n      classList={{\n        [styles.hidden]: editorState.currentTab !== 'adjustments',\n        [styles.changed]: mediaState.videoCropLength !== 1\n      }}\n      style={{\n        '--start': mediaState.videoCropStart,\n        '--length': mediaState.videoCropLength,\n        '--current-time': mediaState.currentVideoTime\n      }}\n    >\n      <div class={styles.InnerContainer}>\n        <button\n          use:ripple\n          class={`btn-icon ${styles.IconButton} ${styles.MuteButton}`}\n          classList={{\n            [styles.muted]: mediaState.videoMuted\n          }}\n          onClick={(e) => {\n            mediaState.videoMuted = !mediaState.videoMuted;\n            closeTooltip?.();\n            if(mediaState.videoMuted) closeTooltip = showMutedTooltip(e.currentTarget).close;\n          }}\n          tabIndex={-1}\n        >\n          <IconTsx icon={mediaState.videoMuted ? 'volume_off' : 'volume_up'} />\n        </button>\n\n        <div class={styles.Frames}>\n          <div ref={setCropper} class={styles.Cropper}>\n            <canvas ref={canvas} class={styles.Images} width={cropperSize.width} height={cropperSize.height} />\n\n            <div class={`${styles.CropperBg} ${styles.CropperBgLeft}`} />\n            <div class={`${styles.CropperBg} ${styles.CropperBgRight}`} />\n\n            <div\n              class={styles.CropperHorizontalBorder}\n              classList={{\n                [styles.dragging]: isDraggingSomething()\n              }}\n              use:swipe={middleSwipeArgs}\n              onClick={onMiddlePartClick}\n            />\n\n            <div class={`${styles.CropperHandle} ${styles.CropperHandleLeft}`} use:swipe={leftHandleSwipeArgs} />\n            <div class={`${styles.CropperHandle} ${styles.CropperHandleRight}`} use:swipe={rightHandleSwipeArgs} />\n          </div>\n\n          <TimeStick swipe={cursorSwipeArgs} />\n          <ThumbnailTrack\n            cropper={cropper()}\n            isDraggingSomething={isDraggingSomething()}\n            hidden={shouldShowTime()}\n          />\n          <div class={styles.CroppedTime} classList={{[styles.visible]: shouldShowTime()}}>\n            {formattedResultingTime()}\n          </div>\n\n        </div>\n\n        <button\n          use:ripple\n          class={`btn-icon ${styles.IconButton} ${styles.PlayButton}`}\n          onClick={() => {\n            editorState.isPlaying = !editorState.isPlaying;\n          }}\n          tabIndex={-1}\n        >\n          <span class={styles.PlayButtonInner}> {/* <span> prevents duplicating the svg on hot reload */}\n            <PausePlay paused={!editorState.isPlaying} />\n          </span>\n        </button>\n      </div>\n    </div>\n  );\n};\n\nconst ThumbnailTrack: Component<{\n  cropper: HTMLDivElement;\n  isDraggingSomething: boolean;\n  hidden: boolean;\n}> = (props) => {\n  const {actions, editorState, mediaState} = useMediaEditorContext();\n\n  const [ghostThumbnailPosition, setGhostThumbnailPosition] = createSignal<number>();\n\n  const [isDragging, setIsDragging] = createSignal(false);\n\n  const isGhostThumbnailVisible = createMemo(() => !props.isDraggingSomething && !isDragging() && !isNaN(ghostThumbnailPosition()));\n\n  const onClick = (e: MouseEvent) => {\n    if(!props.cropper) return;\n\n    mediaState.videoThumbnailPosition = getPositionInCropper(e, props.cropper);\n  };\n\n  let canPreviewFrame = false, previewFrameTimeout: number;\n\n  const onPointerMove = (e: PointerEvent | TouchEvent) => {\n    if(!props.cropper || editorState.isPlaying || props.isDraggingSomething) return;\n\n    if(!previewFrameTimeout) previewFrameTimeout = self.setTimeout(() => {\n      canPreviewFrame = true;\n    }, 200);\n\n    const position = getPositionInCropper(e, props.cropper);\n\n    setGhostThumbnailPosition(position);\n\n    if(canPreviewFrame) actions.setVideoTime(position, SetVideoTimeFlags.UpdateVideo | SetVideoTimeFlags.Redraw);\n  };\n\n  const onPointerOut = () => {\n    if(canPreviewFrame) actions.setVideoTime(mediaState.currentVideoTime, SetVideoTimeFlags.UpdateVideo | SetVideoTimeFlags.Redraw);\n\n    setGhostThumbnailPosition();\n    canPreviewFrame = false;\n    self.clearTimeout(previewFrameTimeout);\n    previewFrameTimeout = undefined;\n  };\n\n  const swipeArgs: SwipeDirectiveArgs = {\n    globalCursor: () => 'grabbing',\n    onStart: (e) => {\n      void setIsDragging(true);\n      if(!props.cropper) return;\n      mediaState.videoThumbnailPosition = getPositionInCropper(e, props.cropper);\n    },\n    onMove: (_, __, e) => {\n      if(!props.cropper) return;\n      mediaState.videoThumbnailPosition = getPositionInCropper(e, props.cropper);\n    },\n    onEnd: () => void setIsDragging(false)\n  };\n\n  return (\n    <>\n      <ThumbnailMark position={mediaState.videoThumbnailPosition} visible={!props.hidden} withTransition />\n      <ThumbnailMark position={ghostThumbnailPosition() || 0} ghost visible={!props.hidden && isGhostThumbnailVisible()} />\n\n      <div\n        class={styles.ThumbnailTrack}\n        classList={{\n          [styles.disabled]: props.isDraggingSomething\n        }}\n        use:swipe={swipeArgs}\n        onPointerMove={onPointerMove}\n        onTouchMove={onPointerMove}\n        onPointerOut={onPointerOut}\n        onTouchEnd={onPointerOut}\n        onClick={onClick}\n      />\n    </>\n  )\n};\n\nconst ThumbnailMark: Component<{\n  position: number;\n  visible: boolean;\n  ghost?: boolean;\n  withTransition?: boolean;\n}> = (props) => {\n  return (\n    <svg\n      class={styles.ThumbnailMark}\n      classList={{\n        [styles.ghost]: props.ghost,\n        [styles.visible]: props.visible,\n        [styles.withTransition]: props.withTransition\n      }}\n      style={{\n        '--position': props.position\n      }}\n      width=\"20\"\n      height=\"25\"\n      viewBox=\"0 0 20 25\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path d=\"M0 10V10.9952C0 14.8798 2.58024 18.2044 5.87746 20.2583C7.46104 21.2448 8.92659 22.4551 9.61717 23.8212C9.70992 24.0047 10.2901 24.0047 10.3828 23.8212C11.0734 22.4551 12.539 21.2448 14.1225 20.2583C17.4198 18.2044 20 14.8798 20 10.9952V10C20 4.47715 15.5228 0 10 0C4.47715 0 0 4.47715 0 10Z\" fill=\"white\"/>\n      <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M8.45844 4.4165H8.48341H11.5167H11.5417C12.1739 4.4165 12.6838 4.41649 13.0968 4.45023C13.522 4.48497 13.8954 4.55836 14.2409 4.7344C14.7897 5.01403 15.2359 5.46023 15.5155 6.00903C15.6915 6.35454 15.7649 6.72798 15.7997 7.15314C15.8334 7.56605 15.8334 8.07595 15.8334 8.70813V8.73317V11.7665V11.7915C15.8334 12.4237 15.8334 12.9336 15.7997 13.3465C15.7649 13.7717 15.6915 14.1452 15.5155 14.4907C15.2359 15.0395 14.7897 15.4857 14.2409 15.7653C13.8954 15.9413 13.522 16.0147 13.0968 16.0495C12.6839 16.0832 12.174 16.0832 11.5418 16.0832H11.5167H8.48341H8.45843C7.82626 16.0832 7.3163 16.0832 6.90339 16.0495C6.47822 16.0147 6.10478 15.9413 5.75928 15.7653C5.21047 15.4857 4.76427 15.0395 4.48465 14.4907C4.3086 14.1452 4.23521 13.7717 4.20048 13.3465C4.16674 12.9336 4.16674 12.4237 4.16675 11.7915V11.7665V8.73317V8.7082C4.16674 8.07599 4.16674 7.56607 4.20048 7.15314C4.23521 6.72798 4.3086 6.35454 4.48465 6.00903C4.76427 5.46023 5.21047 5.01403 5.75928 4.7344C6.10478 4.55836 6.47822 4.48497 6.90339 4.45023C7.31631 4.41649 7.82624 4.4165 8.45844 4.4165ZM6.99839 5.61303C6.64537 5.64187 6.44255 5.69563 6.28893 5.77391C5.95965 5.94169 5.69193 6.2094 5.52415 6.53869C5.44588 6.69231 5.39211 6.89513 5.36327 7.24814C5.33387 7.60797 5.33341 8.07015 5.33341 8.73317V11.7665C5.33341 12.4295 5.33387 12.8917 5.36327 13.2516C5.36613 13.2866 5.36925 13.3203 5.37261 13.3525L6.26742 11.8925L6.28131 11.8699C6.46683 11.5672 6.62664 11.3064 6.77319 11.11C6.92275 10.9096 7.11058 10.7022 7.37928 10.5859C7.74882 10.4259 8.16801 10.4259 8.53755 10.5859C8.80625 10.7022 8.99406 10.9096 9.14363 11.11C9.26806 11.2767 9.40199 11.4898 9.55313 11.7356L10.3508 10.4342L10.3647 10.4115C10.5502 10.1088 10.7099 9.84804 10.8565 9.65169C11.0061 9.45131 11.1939 9.24382 11.4626 9.12756C11.8322 8.96764 12.2513 8.96764 12.6209 9.12756C12.8896 9.24382 13.0774 9.45131 13.227 9.65169C13.3736 9.84804 13.5333 10.1088 13.7188 10.4115L13.7327 10.4342L14.6667 11.958L14.6667 11.7665V8.73317C14.6667 8.07015 14.6663 7.60797 14.6369 7.24814C14.6081 6.89513 14.5543 6.69231 14.476 6.53869C14.3082 6.2094 14.0405 5.94169 13.7112 5.77391C13.5576 5.69563 13.3548 5.64187 13.0018 5.61303C12.6419 5.58363 12.1798 5.58317 11.5167 5.58317H8.48341C7.82039 5.58317 7.35821 5.58363 6.99839 5.61303ZM10.2374 12.8518L11.5028 14.9165H11.5167C12.1798 14.9165 12.6419 14.916 13.0018 14.8866C13.3548 14.8578 13.5576 14.804 13.7112 14.7258C14.0405 14.558 14.3082 14.2903 14.476 13.961C14.4835 13.9462 14.4908 13.931 14.4979 13.9152L12.738 11.0439C12.5347 10.7121 12.4027 10.4978 12.292 10.3495C12.2036 10.231 12.1614 10.2013 12.1553 10.1973C12.0827 10.1666 12.0008 10.1666 11.9282 10.1973C11.922 10.2013 11.8799 10.231 11.7915 10.3495C11.6808 10.4978 11.5488 10.7121 11.3455 11.0439L10.2374 12.8518ZM10.1344 14.9165L8.6547 12.5022C8.45134 12.1704 8.31936 11.9561 8.20867 11.8079C8.12021 11.6893 8.07814 11.6596 8.07199 11.6556C7.99939 11.6249 7.91744 11.6249 7.84484 11.6556C7.83869 11.6596 7.79662 11.6893 7.70816 11.8079C7.59747 11.9561 7.46548 12.1704 7.26212 12.5022L6.00854 14.5475C6.09569 14.6153 6.1895 14.6751 6.28893 14.7258C6.44255 14.804 6.64537 14.8578 6.99839 14.8866C7.35821 14.916 7.82039 14.9165 8.48341 14.9165H10.1344Z\" fill=\"#212121\"/>\n    </svg>\n  );\n}\n\nconst TimeStick = (props: {swipe: SwipeDirectiveArgs}) => {\n  return (\n    <svg class={styles.TimeStick} use:swipe={props.swipe} width=\"6\" height=\"60\" viewBox=\"0 0 6 60\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n      <path d=\"M4 0.75C4.69036 0.75 5.25 1.30964 5.25 2V3.29297C5.24998 3.812 5.04377 4.30975 4.67676 4.67676C4.40352 4.95 4.25002 5.32061 4.25 5.70703V54.293C4.25002 54.6794 4.40352 55.05 4.67676 55.3232C5.04377 55.6903 5.24998 56.188 5.25 56.707V58C5.25 58.6904 4.69036 59.25 4 59.25H2C1.30964 59.25 0.75 58.6904 0.75 58V56.707C0.75002 56.188 0.956231 55.6903 1.32324 55.3232C1.59648 55.05 1.74998 54.6794 1.75 54.293V5.70703C1.74998 5.32061 1.59648 4.95 1.32324 4.67676C0.956231 4.30975 0.75002 3.812 0.75 3.29297V2C0.75 1.30964 1.30964 0.75 2 0.75H4Z\" fill=\"white\" stroke=\"#212121\" stroke-width=\"0.5\"/>\n    </svg>\n  )\n};\n\nexport const PausePlay: Component<{\n  paused: boolean;\n}> = (props) => {\n  return (\n    <svg\n      class={styles.PausePlaySvg}\n      classList={{\n        [styles.paused]: props.paused\n      }}\n      width=\"24\"\n      height=\"24\"\n      viewBox=\"0 0 24 24\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <clipPath id=\"playSymbolClipPath\">\n        <path class={styles.PausePlaySvgPlay} d=\"M5 19.9138V4.0862C5 2.83455 6.44254 2.13342 7.42673 2.90672L17.4988 10.8205C18.2632 11.4211 18.2632 12.5789 17.4988 13.1795L7.42673 21.0933C6.44254 21.8666 5 21.1655 5 19.9138Z\" fill=\"black\" /* transform=\"translate(8, 12) scale(1.4) translate(-8, -12)\" */ />\n      </clipPath>\n\n      <g class={styles.PausePlaySvgPause} id=\"pauseSymbol\" clip-path='url(#playSymbolClipPath)'>\n        <path class={styles.PausePlaySvgPauseLeft} d=\"M8.5 3H5C4.44772 3 4 3.44772 4 4V20C4 20.5523 4.44772 21 5 21H8.5C9.05228 21 9.5 20.5523 9.5 20V4C9.5 3.44772 9.05228 3 8.5 3Z\" fill=\"white\" />\n        <path class={styles.PausePlaySvgPauseRight} d=\"M19 3H15.5C14.9477 3 14.5 3.44772 14.5 4V20C14.5 20.5523 14.9477 21 15.5 21H19C19.5523 21 20 20.5523 20 20V4C20 3.44772 19.5523 3 19 3Z\" fill=\"white\" />\n      </g>\n    </svg>\n  );\n};\n\nfunction getPositionInCropper(e: PointerEvent | MouseEvent | TouchEvent, cropper: HTMLDivElement) {\n  const clientX = e instanceof TouchEvent ? e.changedTouches[0].clientX : e.clientX;\n\n  const bcr = cropper.getBoundingClientRect();\n  const x = clientX - bcr.left - HANDLE_WIDTH_PX;\n  const pos = x / (bcr.width - 2 * HANDLE_WIDTH_PX);\n\n  return clamp(pos, 0, 1);\n}\n\nexport default VideoControls;\n","import {onCleanup, onMount, Show, JSX} from 'solid-js';\nimport {Transition} from 'solid-transition-group';\n\nimport {useMediaEditorContext} from '../context';\n\nimport BrushCanvas from './brushCanvas';\nimport CropHandles from './cropHandles';\nimport ImageCanvas from './imageCanvas';\nimport PreviewBrushSize from './previewBrushSize';\nimport ResizableLayers from './resizableLayers';\nimport RotationWheel from './rotationWheel';\nimport useFinalTransform from './useFinalTransform';\nimport VideoControls from './videoControls';\n\n\nexport default function MainCanvas() {\n  let container: HTMLDivElement;\n  const {editorState, mediaType} = useMediaEditorContext();\n\n  useFinalTransform();\n\n  onMount(() => {\n    const listener = () => {\n      const bcr = container.getBoundingClientRect();\n      editorState.canvasSize = [bcr.width, bcr.height];\n    };\n    listener();\n    window.addEventListener('resize', listener);\n    onCleanup(() => {\n      window.removeEventListener('resize', listener);\n    });\n  });\n\n  return (\n    <div ref={container} class=\"media-editor__main-canvas\">\n      <Show when={editorState.canvasSize}>\n        <ImageCanvas />\n        <Show when={editorState.isReady}>\n          <BrushCanvas />\n          <ResizableLayers />\n          <PreviewBrushSize />\n          {/* WTF ref causes infinite loop when passed without callback */}\n          <div ref={(el) => void (editorState.resizeHandlesContainer = el)} class=\"media-editor__resize-handles-overlay\" />\n          <CropHandles />\n          <RotationWheel />\n          <Show when={mediaType === 'video' && !!editorState.renderingPayload}>\n            <VideoControls />\n          </Show>\n        </Show>\n      </Show>\n    </div>\n  );\n}\n","import {snapToViewport} from '../utils';\nimport {defaultCodec, highResCodec} from './calcCodecAndBitrate';\n\nconst SIDE_MAX = 2560;\nconst SIDE_MIN = 240;\n\n\ntype Args = {\n  videoType: 'video' | 'gif';\n  imageWidth: number;\n  imageRatio: number;\n  cropOffset: { width: number; height: number; };\n  newRatio: number;\n  scale: number;\n  quality?: number;\n};\n\nexport default function getResultSize({imageWidth, cropOffset, imageRatio, newRatio, scale, videoType, quality}: Args) {\n  const [w] = snapToViewport(imageRatio, cropOffset.width, cropOffset.height);\n  const [cw] = snapToViewport(newRatio, cropOffset.width, cropOffset.height);\n\n  let scaledWidth = cw / (w * scale) * imageWidth,\n    scaledHeight = scaledWidth / newRatio;\n\n  const willResultInVideo = !!videoType;\n\n  if(Math.max(scaledWidth, scaledHeight) < SIDE_MIN) {\n    [scaledWidth, scaledHeight] = snapToViewport(newRatio, SIDE_MIN, SIDE_MIN);\n  }\n  if(videoType === 'gif' && (scaledWidth > defaultCodec.width || scaledHeight > defaultCodec.height)) {\n    [scaledWidth, scaledHeight] = snapToViewport(newRatio, defaultCodec.width, defaultCodec.height);\n  }\n  if(videoType === 'video' && (scaledWidth > highResCodec.width || scaledHeight > highResCodec.height)) {\n    [scaledWidth, scaledHeight] = snapToViewport(newRatio, highResCodec.width, highResCodec.height);\n  }\n  if(!willResultInVideo && Math.max(scaledWidth, scaledHeight) > SIDE_MAX) {\n    [scaledWidth, scaledHeight] = snapToViewport(newRatio, SIDE_MAX, SIDE_MAX);\n  }\n\n  if(quality) {\n    scaledHeight = quality;\n    scaledWidth = quality * newRatio;\n  }\n\n  scaledWidth = Math.floor(scaledWidth);\n  scaledHeight = Math.floor(scaledHeight);\n  scaledWidth = scaledWidth % 2 == 0 ? scaledWidth : scaledWidth - 1;\n  scaledHeight = scaledHeight % 2 == 0 ? scaledHeight : scaledHeight - 1;\n\n  return [scaledWidth, scaledHeight];\n}\n","import {FinalTransform} from '../canvas/useFinalTransform';\nimport {useCropOffset} from '../canvas/useCropOffset';\nimport {MediaEditorContextValue} from '../context';\nimport {getSnappedViewportsScale} from '../utils';\n\nexport type GetResultTransformArgs = {\n  context: MediaEditorContextValue;\n  scaledWidth: number;\n  scaledHeight: number;\n  imageWidth: number;\n  imageHeight: number;\n  cropOffset: ReturnType<typeof useCropOffset>;\n};\n\nexport default function getResultTransform({\n  context,\n  scaledWidth,\n  scaledHeight,\n  imageWidth,\n  imageHeight,\n  cropOffset\n}: GetResultTransformArgs): FinalTransform {\n  const {\n    editorState: {canvasSize},\n    mediaState: {scale, translation, rotation, flip, currentImageRatio}\n  } = context;\n\n  const initialCanvasWidth = canvasSize[0];\n  const initialCanvasHeight = canvasSize[1];\n\n  const imageRatio = imageWidth / imageHeight;\n\n  const canvasRatio = initialCanvasWidth / initialCanvasHeight;\n  let snappedCanvasWidth = scaledWidth,\n    snappedCanvasHeight = scaledHeight;\n  if(scaledWidth / canvasRatio < scaledHeight) snappedCanvasWidth = scaledHeight * canvasRatio;\n  else snappedCanvasHeight = scaledWidth / canvasRatio;\n\n  let toCropScale = getSnappedViewportsScale(\n    imageRatio,\n    cropOffset().width,\n    cropOffset().height,\n    snappedCanvasWidth,\n    snappedCanvasHeight\n  );\n  const fromCroppedScale =\n    1 /\n    getSnappedViewportsScale(\n      currentImageRatio,\n      cropOffset().width,\n      cropOffset().height,\n      snappedCanvasWidth,\n      snappedCanvasHeight\n    );\n\n  toCropScale *= fromCroppedScale;\n\n  const snappedImageScale = Math.min(snappedCanvasWidth / imageWidth, snappedCanvasHeight / imageHeight);\n\n  const cropTranslation = translation.map((x) => x * fromCroppedScale - x);\n\n  return {\n    flip: flip,\n    rotation: rotation,\n    scale: scale * snappedImageScale * toCropScale,\n    translation: [cropTranslation[0] + translation[0], cropTranslation[1] + translation[1]]\n  };\n}\n","import {unwrap} from 'solid-js/store';\n\nimport {FinalTransform} from '../canvas/useFinalTransform';\nimport {MediaEditorContextValue} from '../context';\nimport {NumberPair} from '../types';\n\nexport type ScaledLayersAndLines = ReturnType<typeof getScaledLayersAndLines>;\n\nexport default function getScaledLayersAndLines(\n  context: MediaEditorContextValue,\n  finalTransform: FinalTransform,\n  width: number,\n  height: number\n) {\n  const {mediaState: {resizableLayers, brushDrawnLines}, editorState: {pixelRatio}} = context;\n\n  function processPoint(point: NumberPair) {\n    const r = [Math.sin(-finalTransform.rotation), Math.cos(-finalTransform.rotation)];\n    point = [point[0] * r[1] + point[1] * r[0], point[1] * r[1] - point[0] * r[0]];\n    point = [\n      point[0] * finalTransform.scale + width / 2 + finalTransform.translation[0],\n      point[1] * finalTransform.scale + height / 2 + finalTransform.translation[1]\n    ];\n    return point;\n  }\n\n  const scaledLines = brushDrawnLines.map(({size, points, ...line}) => ({\n    ...line,\n    size: size * finalTransform.scale,\n    points: points.map(processPoint)\n  }));\n  const scaledLayers = resizableLayers.map((layerStore) => {\n    const layer = {...unwrap(layerStore)};\n\n    layer.position = processPoint(layer.position);\n    layer.rotation += finalTransform.rotation;\n    layer.scale *= finalTransform.scale;\n\n    if(layer.textInfo) {\n      layer.textInfo = {...layer.textInfo};\n      layer.textInfo.size *= layer.scale * pixelRatio;\n    }\n    return layer;\n  });\n\n  return {scaledLines, scaledLayers};\n}\n","export const FRAMES_PER_SECOND = 60;\nexport const STICKER_SIZE = 200;\n","import {MediaEditorContextValue} from '../context';\nimport {snapToViewport} from '../utils';\nimport {ResizableLayer} from '../types';\n\nimport {STICKER_SIZE} from './constants';\n\nexport default function drawStickerLayer(\n  context: MediaEditorContextValue,\n  ctx: CanvasRenderingContext2D,\n  layer: ResizableLayer,\n  source: CanvasImageSource,\n  ratio: number,\n  densityAware = true\n) {\n  const {editorState: {stickersLayersInfo, pixelRatio}} = context;\n\n  const {container} = stickersLayersInfo[layer.id];\n  const stickerChild = container?.lastElementChild;\n  if(!stickerChild) return;\n\n  const size = STICKER_SIZE * layer.scale * (densityAware ? pixelRatio : 1);\n\n  ctx.save();\n  ctx.translate(layer.position[0], layer.position[1]);\n  ctx.rotate(layer.rotation);\n\n  const [w, h] = snapToViewport(ratio, size, size);\n\n  ctx.drawImage(source, -size / 2 + (size - w) / 2, -size / 2 + (size - h) / 2, w, h);\n\n  ctx.restore();\n}\n","import {MediaEditorContextValue} from '../context';\nimport {fontInfoMap, getContrastColor} from '../utils';\nimport {ResizableLayer} from '../types';\n\nexport default function drawTextLayer(\n  context: MediaEditorContextValue,\n  ctx: CanvasRenderingContext2D,\n  layer: ResizableLayer,\n  densityAware = true\n) {\n  if(layer.type !== 'text') return;\n\n  const {editorState: {pixelRatio}} = context;\n\n  const renderingInfo = {...layer.textRenderingInfo};\n  const scale = layer.scale * (densityAware ? pixelRatio : 1);\n  renderingInfo.height *= scale;\n  renderingInfo.width *= scale;\n  renderingInfo.lines = renderingInfo.lines.map((line) => ({\n    ...line,\n    height: line.height * scale,\n    left: line.left * scale,\n    right: line.right * scale\n  }));\n\n  if(renderingInfo.path) {\n    const newPath = [...renderingInfo.path];\n    function multiply(i: number) {\n      newPath[i] = (newPath[i] as number) * scale;\n    }\n    newPath.forEach((part, i) => {\n      if(part === 'M' || part === 'L') {\n        multiply(i + 1);\n        multiply(i + 2);\n      } else if(part === 'A') {\n        multiply(i + 1);\n        multiply(i + 2);\n        multiply(i + 6);\n        multiply(i + 7);\n      }\n    });\n    renderingInfo.path = newPath;\n  }\n\n  ctx.save();\n  ctx.translate(layer.position[0], layer.position[1]);\n  ctx.rotate(layer.rotation);\n\n  let prevY = -renderingInfo.height / 2;\n  const boxLeft = -renderingInfo.width / 2;\n  const fontInfo = fontInfoMap[layer.textInfo.font];\n\n  if(layer.textInfo.style === 'background') {\n    ctx.translate(boxLeft, prevY);\n\n    ctx.fillStyle = layer.textInfo.color;\n    const path = new Path2D(renderingInfo.path.join(' '));\n\n    ctx.fill(path);\n    ctx.translate(-boxLeft, -prevY);\n  }\n\n  renderingInfo.lines.forEach((line) => {\n    const yOffset = line.height * fontInfo.baseline;\n    let xOffset = 0.2 * layer.textInfo.size;\n    if(layer.textInfo.style === 'background') xOffset = 0.3 * layer.textInfo.size;\n\n    ctx.font = `${fontInfo.fontWeight} ${layer.textInfo.size}px ${fontInfo.fontFamily}`;\n\n    const x = boxLeft + xOffset + line.left,\n      y = prevY + yOffset;\n\n    if(layer.textInfo.style === 'outline') {\n      ctx.lineWidth = layer.textInfo.size * 0.15;\n      ctx.strokeStyle = layer.textInfo.color;\n      ctx.strokeText(line.content, x, y);\n      ctx.fillStyle = getContrastColor(layer.textInfo.color);\n      ctx.fillText(line.content, x, y);\n    } else if(layer.textInfo.style === 'background') {\n      ctx.fillStyle = getContrastColor(layer.textInfo.color);\n      ctx.fillText(line.content, x, y);\n    } else {\n      ctx.fillStyle = layer.textInfo.color;\n      ctx.fillText(line.content, x, y);\n    }\n    prevY += line.height;\n  });\n\n  ctx.restore();\n}\n","import {unwrap} from 'solid-js/store';\nimport {useCropOffset} from '../canvas/useCropOffset';\nimport useProcessPoint from '../canvas/useProcessPoint';\nimport {useMediaEditorContext} from '../context';\nimport {snapToViewport} from '../utils';\nimport drawStickerLayer from './drawStickerLayer';\nimport drawTextLayer from './drawTextLayer';\n\n\ntype Args = {\n  scaledWidth: number;\n  scaledHeight: number;\n};\n\nexport async function generateVideoPreview({scaledWidth, scaledHeight}: Args) {\n  const context = useMediaEditorContext();\n\n  const {\n    editorState: {\n      canvasSize: [cw, ch], imageCanvas, brushCanvas, currentTab, stickersLayersInfo, finalTransform: {scale}\n    },\n    mediaState: {\n      resizableLayers, rotation\n    }\n  } = context;\n\n  const processPoint = useProcessPoint(false);\n  const cropOffset = useCropOffset();\n\n  const isCropping = currentTab === 'crop';\n\n  const ratio = scaledWidth / scaledHeight;\n\n  const [previewWidth, previewHeight] = snapToViewport(ratio, isCropping ? cropOffset().width : cw, isCropping ? cropOffset().height : ch);\n\n  const mirrorCanvas = document.createElement('canvas');\n  [mirrorCanvas.width, mirrorCanvas.height] = [cw, ch];\n\n  const previewCanvas = document.createElement('canvas');\n  [previewCanvas.width, previewCanvas.height] = [previewWidth, previewHeight];\n\n\n  const previewCtx = previewCanvas.getContext('2d');\n  const mirrorCtx = mirrorCanvas.getContext('2d');\n\n  mirrorCtx.drawImage(imageCanvas, 0, 0, cw, ch);\n  mirrorCtx.drawImage(brushCanvas, 0, 0, cw, ch);\n\n  const processedLayers = unwrap(resizableLayers).map(layer => ({\n    ...layer,\n    position: processPoint(layer.position),\n    rotation: layer.rotation + rotation,\n    scale: layer.scale * scale,\n    textInfo: layer.textInfo ? {\n      ...layer.textInfo,\n      size: layer.textInfo.size * layer.scale * scale\n    } : undefined\n  }));\n\n  processedLayers.forEach((layer) => {\n    if(layer.type === 'text') drawTextLayer(context, mirrorCtx, layer, false);\n\n    if(layer.type === 'sticker') {\n      const {container} = stickersLayersInfo[layer.id];\n      const stickerChild = container?.lastElementChild;\n\n      let ratio: number;\n\n      if(stickerChild instanceof HTMLImageElement)\n        ratio = stickerChild.naturalWidth / stickerChild.naturalHeight;\n      else if(stickerChild instanceof HTMLCanvasElement)\n        ratio = 1;\n      else if(stickerChild instanceof HTMLVideoElement)\n        ratio = stickerChild.videoWidth / stickerChild.videoHeight;\n      else return;\n\n      drawStickerLayer(context, mirrorCtx, layer, stickerChild, ratio, false);\n    }\n  });\n\n  if(isCropping) {\n    previewCtx.drawImage(\n      mirrorCanvas,\n      cropOffset().left + (cropOffset().width - previewWidth) / 2, cropOffset().top + (cropOffset().height - previewHeight) / 2, previewWidth, previewHeight,\n      0, 0, previewWidth, previewHeight\n    );\n  } else {\n    previewCtx.drawImage(\n      mirrorCanvas,\n      (cw - previewWidth) / 2, (ch - previewHeight) / 2, previewWidth, previewHeight,\n      0, 0, previewWidth, previewHeight\n    );\n  }\n\n  const previewBlob = await new Promise<Blob>((resolve) => previewCanvas.toBlob(resolve));\n\n  return previewBlob;\n}\n","import deferredPromise, {CancellablePromise} from '../../../helpers/cancellablePromise';\nimport appDownloadManager from '../../../lib/appManagers/appDownloadManager';\nimport {Document} from '../../../layer';\n\nimport {StickerFrameByFrameRenderer} from './types';\n\nexport default class ImageStickerFrameByFrameRenderer implements StickerFrameByFrameRenderer {\n  private image: HTMLImageElement;\n\n  async init(doc: Document.document) {\n    const blob = await appDownloadManager.downloadMedia({\n      media: doc\n    });\n\n    const image = (this.image = new Image());\n    image.src = URL.createObjectURL(blob);\n\n    const deferred = deferredPromise<void>();\n\n    image.addEventListener('load', () => {\n      deferred.resolve();\n    });\n\n    await deferred;\n  }\n\n  getTotalFrames() {\n    return 1;\n  }\n\n  getRatio() {\n    return this.image.naturalWidth / this.image.naturalHeight;\n  }\n\n  async renderFrame() {}\n\n  getRenderedFrame() {\n    return this.image;\n  }\n\n  destroy() {\n    this.image = null;\n  }\n}\n","import deferredPromise, {CancellablePromise} from '../../../helpers/cancellablePromise';\nimport RLottiePlayer from '../../../lib/rlottie/rlottiePlayer';\nimport appDownloadManager from '../../../lib/appManagers/appDownloadManager';\nimport lottieLoader from '../../../lib/rlottie/lottieLoader';\nimport {Document} from '../../../layer';\n\nimport {StickerFrameByFrameRenderer} from './types';\n\nexport default class LottieStickerFrameByFrameRenderer implements StickerFrameByFrameRenderer {\n  private frameCount: number = 0;\n  private currentDeferredFrame: CancellablePromise<void>;\n  private container: HTMLDivElement;\n  private animation: RLottiePlayer;\n\n  async init(doc: Document.document, size: number) {\n    const blob = await appDownloadManager.downloadMedia({\n      media: doc\n    });\n    const container = (this.container = document.createElement('div'));\n    container.style.width = size + 'px';\n    container.style.height = size + 'px';\n    container.style.position = 'absolute';\n    container.style.opacity = '0';\n    container.style.pointerEvents = 'none';\n\n    document.body.append(container);\n    const animation = (this.animation = await lottieLoader.loadAnimationWorker({\n      container: container,\n      autoplay: false,\n      animationData: blob,\n      width: size,\n      height: size,\n      name: 'doc' + doc.id\n    }));\n\n    const deferred = deferredPromise<void>();\n\n    animation.addEventListener('ready', () => {\n      this.frameCount = animation.maxFrame + 1;\n      deferred.resolve();\n    });\n\n    animation.addEventListener('enterFrame', () => {\n      this.currentDeferredFrame?.resolve();\n    });\n\n    await deferred;\n  }\n\n  getTotalFrames() {\n    return this.frameCount;\n  }\n\n  getRatio() {\n    return 1 / 1;\n  }\n\n  async renderFrame(frame: number) {\n    this.currentDeferredFrame = deferredPromise<void>();\n    this.animation.requestFrame(frame);\n    await this.currentDeferredFrame;\n  }\n\n  getRenderedFrame() {\n    return this.animation.canvas[0];\n  }\n\n  destroy() {\n    this.container.remove();\n    this.animation.remove();\n  }\n}\n","import deferredPromise, {CancellablePromise} from '../../../helpers/cancellablePromise';\nimport appDownloadManager from '../../../lib/appManagers/appDownloadManager';\nimport {getMiddleware} from '../../../helpers/middleware';\nimport {Document} from '../../../layer';\nimport createVideo from '../../../helpers/dom/createVideo';\nimport onMediaLoad from '../../../helpers/onMediaLoad';\nimport apiManagerProxy from '../../../lib/mtproto/mtprotoworker';\nimport handleVideoLeak from '../../../helpers/dom/handleVideoLeak';\nimport {IS_FIREFOX} from '../../../environment/userAgent';\n\nimport {delay} from '../utils';\n\nimport {StickerFrameByFrameRenderer} from './types';\nimport {FRAMES_PER_SECOND} from './constants';\n\nexport default class VideoStickerFrameByFrameRenderer implements StickerFrameByFrameRenderer {\n  private duration: number = 0;\n  private currentDeferredFrame: CancellablePromise<void>;\n  private video: HTMLVideoElement;\n\n  private middleware = getMiddleware();\n\n  async init(doc: Document.document) {\n    const blob = await appDownloadManager.downloadMedia({\n      media: doc\n    });\n\n    const video = (this.video = createVideo({middleware: this.middleware.get()}));\n    video.src = await apiManagerProxy.invoke('createObjectURL', blob);\n    // video.autoplay = true;\n    video.controls = false;\n    video.muted = true;\n    // video.loop = true;\n    video.preload = 'auto';\n\n    const promise = onMediaLoad(video as HTMLMediaElement);\n    await handleVideoLeak(video, promise);\n    await delay(100); // Necessary\n    this.duration = video.duration;\n\n    video.addEventListener('seeked', () => {\n      this.currentDeferredFrame?.resolve();\n    });\n  }\n\n  getTotalFrames() {\n    return IS_FIREFOX ? 1 : Math.floor(this.duration * FRAMES_PER_SECOND);\n  }\n\n  async renderFrame(frame: number) {\n    if(IS_FIREFOX) return;\n    this.currentDeferredFrame = deferredPromise<void>();\n    this.video.currentTime = (1 / FRAMES_PER_SECOND) * frame;\n    await this.currentDeferredFrame;\n  }\n\n  getRatio() {\n    return this.video.videoWidth / this.video.videoHeight;\n  }\n\n  getRenderedFrame() {\n    return this.video;\n  }\n\n  destroy() {\n    this.middleware.destroy();\n    this.video = null;\n  }\n}\n","import {createRoot, createSignal, getOwner, runWithOwner} from 'solid-js';\nimport {animate} from '../../../helpers/animation';\nimport deferredPromise, {CancellablePromise} from '../../../helpers/cancellablePromise';\nimport ListenerSetter from '../../../helpers/listenerSetter';\nimport {MediaSize} from '../../../helpers/mediaSize';\nimport noop from '../../../helpers/noop';\nimport clamp from '../../../helpers/number/clamp';\nimport {logger} from '../../../lib/logger';\nimport {useMediaEditorContext} from '../context';\nimport {supportsAudioEncoding} from '../support';\nimport {delay, snapToViewport} from '../utils';\nimport {RenderingPayload} from '../webgl/initWebGL';\nimport calcCodecAndBitrate, {BITRATE_TARGET_FPS} from './calcCodecAndBitrate';\nimport {FRAMES_PER_SECOND, STICKER_SIZE} from './constants';\nimport {MediaEditorFinalResultPayload} from './createFinalResult';\nimport drawStickerLayer from './drawStickerLayer';\nimport drawTextLayer from './drawTextLayer';\nimport {generateVideoPreview} from './generateVideoPreview';\nimport {ScaledLayersAndLines} from './getScaledLayersAndLines';\nimport ImageStickerFrameByFrameRenderer from './imageStickerFrameByFrameRenderer';\nimport LottieStickerFrameByFrameRenderer from './lottieStickerFrameByFrameRenderer';\nimport {StickerFrameByFrameRenderer} from './types';\nimport VideoStickerFrameByFrameRenderer from './videoStickerFrameByFrameRenderer';\n\n\ntype Args = {\n  renderingPayload: RenderingPayload;\n  hasAnimatedStickers: boolean;\n  scaledLayers: ScaledLayersAndLines['scaledLayers'];\n  scaledWidth: number;\n  scaledHeight: number;\n  ctx: CanvasRenderingContext2D;\n  imageCanvasGL: WebGLRenderingContext;\n  imageCanvas: HTMLCanvasElement;\n  drawToImageCanvas: () => void;\n  brushCanvas: HTMLCanvasElement;\n  resultCanvas: HTMLCanvasElement;\n};\n\nconst EXPECTED_FPS = 30;\nconst VIDEO_COMPARISON_ERROR = 0.0001;\n\nconst THUMBNAIL_MAX_SIZE = 720;\n\nconst log = logger('MediaEditor.createFinalResult.renderToActualVideo');\n\nexport default async function renderToActualVideo({\n  renderingPayload,\n  hasAnimatedStickers,\n  scaledWidth,\n  scaledHeight,\n  scaledLayers,\n  ctx,\n  imageCanvasGL: gl,\n  imageCanvas,\n  drawToImageCanvas,\n  brushCanvas,\n  resultCanvas\n}: Args) {\n  const context = useMediaEditorContext();\n\n  const {\n    editorState: {pixelRatio},\n    mediaState: {videoCropStart, videoCropLength, videoMuted, videoThumbnailPosition},\n    mediaBlob\n  } = context;\n\n  const {media: {video}} = renderingPayload;\n\n  const owner = getOwner();\n\n  video.muted = true;\n  const startTime = video.duration * videoCropStart;\n  const endTime = video.duration * (videoCropStart + videoCropLength);\n\n  const creationProgress = createRoot(dispose => {\n    const signal = createSignal(0);\n    return {signal, dispose};\n  });\n\n  const [progress, setProgress] = creationProgress.signal;\n\n  const renderers = new Map<number, StickerFrameByFrameRenderer>();\n\n  const thumbnailCanvas = document.createElement('canvas');\n  [thumbnailCanvas.width, thumbnailCanvas.height] = snapToViewport(scaledWidth / scaledHeight, Math.min(scaledWidth, THUMBNAIL_MAX_SIZE), Math.min(scaledHeight, THUMBNAIL_MAX_SIZE));\n  const thumbnailCtx = thumbnailCanvas.getContext('2d');\n\n  const thumbnailTime = videoThumbnailPosition * video.duration;\n\n  let\n    currentVideoFrameDeferred: CancellablePromise<number>,\n    encodingPausedDeferred: CancellablePromise<void>,\n    lastTime = 0,\n    frameCallbackId: number,\n    drewThumbnail = false,\n    canceled = false,\n    progressRAF = 0\n  ;\n\n  const listenerSetter = new ListenerSetter;\n\n  listenerSetter.add(window)('focus', () => {\n    log('window focus changed', 'focused');\n    encodingPausedDeferred?.resolve?.();\n    encodingPausedDeferred = undefined;\n  });\n\n  listenerSetter.add(window)('blur', () => {\n    log('window focus changed', 'blurred');\n    encodingPausedDeferred = deferredPromise();\n    currentVideoFrameDeferred?.reject(ThrowReason.EncodingPaused);\n  });\n\n  async function initMuxerAndEncoder() {\n    const {Muxer, ArrayBufferTarget} = await import('mp4-muxer');\n\n    let audioBuffer: AudioBuffer;\n\n    if(!videoMuted && await supportsAudioEncoding()) try {\n      audioBuffer = await extractAudioFragment(mediaBlob, startTime, endTime);\n    } catch{}\n\n    const muxer = new Muxer({\n      target: new ArrayBufferTarget(),\n      video: {\n        codec: 'avc',\n        width: scaledWidth,\n        height: scaledHeight\n      },\n      audio: audioBuffer ? {\n        codec: 'opus',\n        sampleRate: audioBuffer.sampleRate,\n        numberOfChannels: audioBuffer.numberOfChannels\n      } : undefined,\n      fastStart: 'in-memory'\n    });\n\n    const encoder = new VideoEncoder({\n      output: (chunk, meta) => muxer.addVideoChunk(chunk, meta),\n      error: (e) => console.error(e)\n    });\n\n    encoder.configure({\n      width: scaledWidth,\n      height: scaledHeight,\n      ...calcCodecAndBitrate(scaledWidth, scaledHeight, BITRATE_TARGET_FPS)\n    });\n\n    return {muxer, encoder, audioBuffer};\n  }\n\n  function drawToTexture() {\n    gl.bindTexture(gl.TEXTURE_2D, renderingPayload.texture);\n    gl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0, gl.RGBA, gl.UNSIGNED_BYTE, video);\n  }\n\n  async function initStickerRenderers() {\n    await Promise.all(\n      scaledLayers.map(async(layer) => {\n        if(!layer.sticker) return;\n\n        const stickerType = layer.sticker?.sticker;\n        let renderer: StickerFrameByFrameRenderer;\n\n        if(stickerType === 1) renderer = new ImageStickerFrameByFrameRenderer();\n        if(stickerType === 2) renderer = new LottieStickerFrameByFrameRenderer();\n        if(stickerType === 3) renderer = new VideoStickerFrameByFrameRenderer();\n        if(!renderer) return;\n\n        renderers.set(layer.id, renderer);\n        await renderer.init(layer.sticker!, STICKER_SIZE * layer.scale * pixelRatio);\n      })\n    );\n  }\n\n  enum ThrowReason {\n    EncodingPaused,\n    TimeLoopback\n  };\n\n  async function prepareAndRenderFrame(encoder: VideoEncoder, frameNo: number) {\n    currentVideoFrameDeferred = deferredPromise();\n\n    const callback = (mediaTime: number) => {\n      drawToTexture();\n      video.pause();\n\n      currentVideoFrameDeferred.resolve(mediaTime);\n    };\n\n    if(frameNo === 0) callback(0);\n    else {\n      frameCallbackId = video.requestVideoFrameCallback((_, {mediaTime}) => void callback(mediaTime));\n      if(video.paused) await video.play();\n    }\n\n    let mediaTime: number;\n    try {\n      mediaTime = await currentVideoFrameDeferred;\n    } catch(e: unknown) {\n      video.pause();\n      if(e === ThrowReason.EncodingPaused && encodingPausedDeferred) {\n        await encodingPausedDeferred;\n        log('paused case was playing', lastTime + startTime);\n        const deferred = deferredPromise<void>();\n\n        listenerSetter.add(video)('seeked', () => {\n          deferred.resolve();\n        }, {once: true});\n\n        video.currentTime = lastTime + startTime;\n\n        await deferred;\n      }\n      throw e;\n    }\n\n    const currentTime = frameNo === 0 ? 0 : mediaTime - startTime;\n    if(currentTime < lastTime) throw ThrowReason.TimeLoopback;\n\n    // Fill static frame with stickers frames\n    if(hasAnimatedStickers) {\n      const untilFrame = Math.round(currentTime * EXPECTED_FPS);\n      for(let frame = Math.round(lastTime * EXPECTED_FPS) + 1; frame < untilFrame; frame++) {\n        await renderFrame({\n          frameNo: frame / EXPECTED_FPS * FRAMES_PER_SECOND | 0,\n          timestamp: frame / EXPECTED_FPS * 1e6 | 0,\n          appendToMuxer: true,\n          encoder\n        });\n      }\n    }\n\n    lastTime = currentTime;\n\n    await renderFrame({\n      frameNo: currentTime * FRAMES_PER_SECOND | 0,\n      timestamp: currentTime * 1e6 | 0,\n      appendToMuxer: true,\n      encoder\n    });\n\n    // Save the thumbnail if it's more or less in the same frame as the current time\n    if(!drewThumbnail && thumbnailTime - 0.5 / EXPECTED_FPS <= currentTime && currentTime <= thumbnailTime + 0.5 / EXPECTED_FPS) {\n      drewThumbnail = true;\n      thumbnailCtx.drawImage(resultCanvas, 0, 0, thumbnailCanvas.width, thumbnailCanvas.height);\n    }\n  }\n\n  type RenderFrameArgs = {\n    frameNo: number;\n    timestamp: number;\n    appendToMuxer: boolean;\n    encoder: VideoEncoder;\n  };\n\n  async function renderFrame({frameNo, timestamp, appendToMuxer, encoder}: RenderFrameArgs) {\n    const promises = Array.from(renderers.values()).map((renderer) =>\n      renderer.renderFrame(frameNo % (renderer.getTotalFrames()))\n    );\n\n    await Promise.all(promises);\n\n    drawToImageCanvas();\n\n    ctx.clearRect(0, 0, scaledWidth, scaledHeight);\n    ctx.drawImage(imageCanvas, 0, 0);\n    ctx.drawImage(brushCanvas, 0, 0);\n\n    scaledLayers.forEach((layer) => {\n      if(layer.type === 'text') drawTextLayer(context, ctx, layer);\n      if(layer.type === 'sticker' && renderers.has(layer.id)) {\n        const renderer = renderers.get(layer.id);\n        drawStickerLayer(context, ctx, layer, renderer.getRenderedFrame(), renderer.getRatio());\n      }\n    });\n\n    if(!appendToMuxer) return;\n\n    const videoFrame = new VideoFrame(resultCanvas, {timestamp});\n\n    encoder.encode(videoFrame);\n    videoFrame.close();\n  }\n\n  function updateProgress(targetProgress: number) {\n    const speed = 0.05;\n    const currentProgress = progress();\n\n    const delta = targetProgress - currentProgress;\n\n    if(delta < 0.0025) { // fourth of a percent\n      setProgress(targetProgress);\n      return;\n    }\n\n    setProgress(currentProgress + delta * speed);\n\n    progressRAF = requestAnimationFrame(() => updateProgress(targetProgress));\n  }\n\n  function cleanup(encoder: VideoEncoder) {\n    encoder.close();\n    Array.from(renderers.values()).forEach((renderer) => renderer.destroy());\n    listenerSetter.removeAll();\n    cancelAnimationFrame(progressRAF);\n    video.src = '';\n    video.load();\n  }\n\n  setProgress(0);\n\n  const preview = await runWithOwner(owner, () => generateVideoPreview({scaledWidth, scaledHeight}));\n\n  const resultPromise = new Promise<MediaEditorFinalResultPayload>(async(resolve, reject) => {\n    const firstFrameSeekDeferred = deferredPromise<void>();\n    video.currentTime = video.duration * videoCropStart;\n    video.addEventListener('seeked', () => void firstFrameSeekDeferred.resolve(), {once: true});\n\n    const [{muxer, encoder, audioBuffer}] = await Promise.all([\n      initMuxerAndEncoder(),\n      delay(200),\n      firstFrameSeekDeferred,\n      initStickerRenderers()\n    ]);\n\n    let frameNo = 0;\n\n    let done = false;\n\n    animate(() => {\n      if(encodingPausedDeferred) return true;\n\n      if(video.currentTime >= endTime - VIDEO_COMPARISON_ERROR) {\n        done = true;\n        currentVideoFrameDeferred.resolve(endTime);\n      }\n      return !done;\n    });\n\n    // let avg = 0, cnt = 0;\n\n    // const startrendering = performance.now();\n\n    while(video.currentTime < endTime - VIDEO_COMPARISON_ERROR) {\n      if(canceled) {\n        reject();\n\n        done = true;\n        video.pause();\n\n        cleanup(encoder);\n        return;\n      }\n\n      try {\n        // const start = performance.now();\n        log('prepareAndRenderFrame', frameNo);\n        if(encodingPausedDeferred) {\n          log('paused case was paused', lastTime + startTime);\n          await encodingPausedDeferred;\n        }\n        await prepareAndRenderFrame(encoder, frameNo);\n        // const end = performance.now();\n        // const time = end - start;\n        // cnt++;\n        // avg += (time - avg) / cnt;\n      } catch(e: unknown) {\n        if(typeof e !== 'number') break;\n\n        if(e === ThrowReason.EncodingPaused) await encodingPausedDeferred;\n        else if(e === ThrowReason.TimeLoopback) break;\n      }\n\n      updateProgress(clamp((video.currentTime - startTime) / (endTime - startTime), 0, 1));\n      frameNo++;\n    }\n\n    done = true;\n    video.cancelVideoFrameCallback(frameCallbackId);\n    video.pause();\n\n    // const endrendering = performance.now();\n\n    if(!drewThumbnail) {\n      const deferred = deferredPromise<void>();\n\n      video.addEventListener('seeked', () => {\n        deferred.resolve();\n      }, {once: true});\n      video.currentTime = thumbnailTime;\n\n      await Promise.race([deferred, delay(2_000)]); // just in case you know\n\n      drawToTexture();\n      await renderFrame({frameNo: 0, timestamp: 0, appendToMuxer: false, encoder});\n\n      thumbnailCtx.drawImage(resultCanvas, 0, 0, thumbnailCanvas.width, thumbnailCanvas.height);\n    }\n\n    if(audioBuffer) await encodeAndMuxAudio(audioBuffer, (chunk) => muxer.addAudioChunk(chunk));\n\n    await encoder.flush();\n\n    muxer.finalize();\n\n    cleanup(encoder);\n\n    const {buffer} = muxer.target;\n\n    setProgress(1);\n\n    const thumbBlob = await new Promise<Blob>(resolve => thumbnailCanvas.toBlob(resolve));\n\n    resolve({\n      blob: new Blob([buffer], {type: 'video/mp4'}),\n      hasSound: !!audioBuffer,\n      thumb: {\n        blob: thumbBlob,\n        size: new MediaSize(thumbnailCanvas.width, thumbnailCanvas.height)\n      }\n    });\n\n    // alert(JSON.stringify({\n    //   avg,\n    //   total: endrendering - startrendering,\n    //   frameNo,\n    //   duration: video.duration\n    // }, null, 2));\n  });\n\n  let result: MediaEditorFinalResultPayload;\n\n  resultPromise.then((value) => (result = value)).catch(noop);\n\n  return {\n    preview,\n    isVideo: true,\n    getResult: () => {\n      return result ?? resultPromise;\n    },\n    cancel: () => {\n      canceled = true;\n    },\n    creationProgress\n  };\n\n  // const div = document.createElement('div')\n  // div.style.position = 'fixed';\n  // div.style.zIndex = '1000';\n  // div.style.top = '50%';\n  // div.style.left = '50%';\n  // div.style.transform = 'translate(-50%, -50%)';\n  // const img = document.createElement('video')\n  // img.src = URL.createObjectURL(blob)\n  // img.controls = true\n  // img.autoplay = true\n  // img.loop = true\n  // img.style.maxWidth = '450px'\n  // div.append(img)\n  // document.body.append(div)\n}\n\nasync function extractAudioFragment(blob: Blob, startTime: number, endTime: number) {\n  const audioContext: AudioContext = new (window.AudioContext || (window as any).webkitAudioContext)();\n  const arrayBuffer = await blob.arrayBuffer();\n  const fullAudioBuffer = await audioContext.decodeAudioData(arrayBuffer);\n\n  const sampleRate = fullAudioBuffer.sampleRate;\n  const startSample = Math.floor(startTime * sampleRate);\n  const endSample = Math.floor(endTime * sampleRate);\n  const frameCount = endSample - startSample;\n\n  const numChannels = fullAudioBuffer.numberOfChannels;\n\n  const fragmentBuffer = audioContext.createBuffer(numChannels, frameCount, sampleRate);\n\n  for(let ch = 0; ch < numChannels; ch++) {\n    const fullData = fullAudioBuffer.getChannelData(ch);\n    fragmentBuffer.copyToChannel(fullData.subarray(startSample, endSample), ch);\n  }\n\n  return fragmentBuffer;\n}\n\nasync function encodeAndMuxAudio(audioBuffer: AudioBuffer, onChunk: (ch: EncodedAudioChunk) => void) {\n  const sampleRate = audioBuffer.sampleRate;\n  const numChannels = audioBuffer.numberOfChannels;\n  const totalFrames = audioBuffer.length;\n\n\n  // Interleave audio for WebCodecs\n  const interleaved = new Float32Array(totalFrames * numChannels);\n  for(let ch = 0; ch < numChannels; ch++) {\n    const channelData = audioBuffer.getChannelData(ch);\n    for(let i = 0; i < totalFrames; i++) {\n      interleaved[i * numChannels + ch] = channelData[i];\n    }\n  }\n\n  const encoder = new AudioEncoder({\n    output: onChunk,\n    error: (e) => console.error('AudioEncoder error:', e)\n  });\n\n  encoder.configure({\n    codec: 'opus',\n    sampleRate,\n    numberOfChannels: audioBuffer.numberOfChannels,\n    bitrate: 128000\n  });\n\n  const audioData = new AudioData({\n    format: 'f32',\n    sampleRate,\n    numberOfFrames: audioBuffer.duration * audioBuffer.sampleRate,\n    numberOfChannels: audioBuffer.numberOfChannels,\n    timestamp: 0,\n    data: interleaved\n  });\n\n  encoder.encode(audioData);\n  audioData.close();\n\n  await encoder.flush();\n  encoder.close();\n}\n","import {MediaEditorContextValue} from '../context';\nimport {MediaEditorFinalResultPayload} from './createFinalResult';\n\nimport drawStickerLayer from './drawStickerLayer';\nimport drawTextLayer from './drawTextLayer';\nimport {ScaledLayersAndLines} from './getScaledLayersAndLines';\n\nexport type RenderToImageArgs = {\n  context: MediaEditorContextValue;\n  scaledLayers: ScaledLayersAndLines['scaledLayers'];\n  ctx: CanvasRenderingContext2D;\n  imageCanvas: HTMLCanvasElement;\n  brushCanvas: HTMLCanvasElement;\n  resultCanvas: HTMLCanvasElement;\n};\n\nexport default async function renderToImage({\n  context,\n  scaledLayers,\n  ctx,\n  imageCanvas,\n  brushCanvas,\n  resultCanvas\n}: RenderToImageArgs) {\n  const {editorState: {stickersLayersInfo}} = context;\n\n  ctx.drawImage(imageCanvas, 0, 0);\n  ctx.drawImage(brushCanvas, 0, 0);\n\n  scaledLayers.forEach((layer) => {\n    if(layer.type === 'text') drawTextLayer(context, ctx, layer);\n    if(layer.type === 'sticker' && layer.sticker?.sticker === 1) {\n      const {container} = stickersLayersInfo[layer.id];\n      const stickerChild = container?.lastElementChild;\n      if(!(stickerChild instanceof HTMLImageElement)) return;\n      const ratio = stickerChild.naturalWidth / stickerChild.naturalHeight;\n      drawStickerLayer(context, ctx, layer, stickerChild, ratio);\n    }\n  });\n\n  const result = await new Promise<MediaEditorFinalResultPayload>((resolve) =>\n    resultCanvas.toBlob(blob => resolve({\n      blob,\n      hasSound: false\n    }))\n  );\n\n  return {\n    preview: result.blob,\n    isVideo: false,\n    getResult: () => result\n  };\n}\n","import {createRoot, createSignal, getOwner, runWithOwner} from 'solid-js';\n\nimport noop from '../../../helpers/noop';\n\nimport {useMediaEditorContext} from '../context';\nimport {delay} from '../utils';\n\nimport {FRAMES_PER_SECOND, STICKER_SIZE} from './constants';\nimport {MediaEditorFinalResultPayload} from './createFinalResult';\nimport drawStickerLayer from './drawStickerLayer';\nimport drawTextLayer from './drawTextLayer';\nimport {generateVideoPreview} from './generateVideoPreview';\nimport {ScaledLayersAndLines} from './getScaledLayersAndLines';\nimport ImageStickerFrameByFrameRenderer from './imageStickerFrameByFrameRenderer';\nimport LottieStickerFrameByFrameRenderer from './lottieStickerFrameByFrameRenderer';\nimport {StickerFrameByFrameRenderer} from './types';\nimport VideoStickerFrameByFrameRenderer from './videoStickerFrameByFrameRenderer';\nimport calcCodecAndBitrate, {BITRATE_TARGET_FPS} from './calcCodecAndBitrate';\n\ntype Args = {\n  scaledLayers: ScaledLayersAndLines['scaledLayers'];\n  scaledWidth: number;\n  scaledHeight: number;\n  ctx: CanvasRenderingContext2D;\n  imageCanvas: HTMLCanvasElement;\n  brushCanvas: HTMLCanvasElement;\n  resultCanvas: HTMLCanvasElement;\n};\n\nexport default async function renderToVideoGIF({\n  scaledWidth,\n  scaledHeight,\n  scaledLayers,\n  ctx,\n  imageCanvas,\n  brushCanvas,\n  resultCanvas\n}: Args) {\n  const owner = getOwner();\n  const context = useMediaEditorContext();\n\n  const {editorState: {pixelRatio}} = context;\n\n  const creationProgress = createRoot(dispose => {\n    const signal = createSignal(0);\n    return {signal, dispose};\n  });\n\n  const [, setProgress] = creationProgress.signal;\n\n  const renderers = new Map<number, StickerFrameByFrameRenderer>();\n\n  let canceled = false;\n\n  async function renderFrame(encoder: VideoEncoder, frameNo: number) {\n    const promises = Array.from(renderers.values()).map((renderer) =>\n      renderer.renderFrame(frameNo % (renderer.getTotalFrames() + 1))\n    );\n    await Promise.all(promises);\n\n    ctx.clearRect(0, 0, scaledWidth, scaledHeight);\n    ctx.drawImage(imageCanvas, 0, 0);\n    ctx.drawImage(brushCanvas, 0, 0);\n\n    scaledLayers.forEach((layer) => {\n      if(layer.type === 'text') drawTextLayer(context, ctx, layer);\n      if(layer.type === 'sticker' && renderers.has(layer.id)) {\n        const renderer = renderers.get(layer.id);\n        drawStickerLayer(context, ctx, layer, renderer.getRenderedFrame(), renderer.getRatio());\n      }\n    });\n\n    const videoFrame = new VideoFrame(resultCanvas, {\n      timestamp: (frameNo * 1e6) / FRAMES_PER_SECOND,\n      duration: 1e6 / FRAMES_PER_SECOND\n    });\n    encoder.encode(videoFrame);\n    videoFrame.close();\n  }\n\n  function cleanup(encoder: VideoEncoder) {\n    encoder.close();\n    Array.from(renderers.values()).forEach((renderer) => renderer.destroy());\n  }\n\n  const resultPromise = new Promise<MediaEditorFinalResultPayload>(async(resolve, reject) => {\n    let maxFrames = 0;\n\n    const [{ArrayBufferTarget, Muxer}] = await Promise.all([\n      import('mp4-muxer'),\n      ...scaledLayers.map(async(layer) => {\n        if(!layer.sticker) return;\n\n        const stickerType = layer.sticker?.sticker;\n        let renderer: StickerFrameByFrameRenderer;\n\n        if(stickerType === 1) renderer = new ImageStickerFrameByFrameRenderer();\n        if(stickerType === 2) renderer = new LottieStickerFrameByFrameRenderer();\n        if(stickerType === 3) renderer = new VideoStickerFrameByFrameRenderer();\n        if(!renderer) return;\n\n        renderers.set(layer.id, renderer);\n        await renderer.init(layer.sticker!, STICKER_SIZE * layer.scale * pixelRatio);\n        maxFrames = Math.max(maxFrames, renderer.getTotalFrames());\n      }),\n      delay(200)\n    ]);\n\n    const muxer = new Muxer({\n      target: new ArrayBufferTarget(),\n      video: {\n        codec: 'avc',\n        width: scaledWidth,\n        height: scaledHeight,\n        frameRate: FRAMES_PER_SECOND\n      },\n      fastStart: 'in-memory'\n    });\n\n    const encoder = new VideoEncoder({\n      output: (chunk, meta) => muxer.addVideoChunk(chunk, meta),\n      error: (e) => console.error(e)\n    });\n\n    encoder.configure({\n      width: scaledWidth,\n      height: scaledHeight,\n      ...calcCodecAndBitrate(scaledWidth, scaledHeight, BITRATE_TARGET_FPS)\n    });\n\n    for(let frameNo = 0; frameNo <= maxFrames; frameNo++) {\n      if(canceled) {\n        reject();\n        cleanup(encoder);\n      }\n\n      await renderFrame(encoder, frameNo);\n      setProgress(frameNo / maxFrames);\n    }\n\n    await encoder.flush();\n    muxer.finalize();\n\n    cleanup(encoder);\n\n    const {buffer} = muxer.target;\n    resolve({\n      blob: new Blob([buffer], {type: 'video/mp4'}),\n      hasSound: false\n    });\n  });\n\n  let result: MediaEditorFinalResultPayload;\n\n  resultPromise.then((value) => (result = value)).catch(noop);\n\n  return {\n    preview: await runWithOwner(owner, () => generateVideoPreview({scaledWidth, scaledHeight})),\n    isVideo: true,\n    getResult: () => {\n      return result ?? resultPromise;\n    },\n    cancel: () => {\n      canceled = true;\n    },\n    creationProgress\n  };\n\n  // const div = document.createElement('div')\n  // div.style.position = 'fixed';\n  // div.style.zIndex = '1000';\n  // div.style.top = '50%';\n  // div.style.left = '50%';\n  // div.style.transform = 'translate(-50%, -50%)';\n  // const img = document.createElement('video')\n  // img.src = URL.createObjectURL(blob)\n  // img.controls = true\n  // img.autoplay = true\n  // img.loop = true\n  // img.style.maxWidth = '450px'\n  // div.append(img)\n  // document.body.append(div)\n}\n","import apiManagerProxy from '../../../lib/mtproto/mtprotoworker';\nimport deferredPromise from '../../../helpers/cancellablePromise';\n\nimport {MediaEditorContextValue} from '../context';\nimport {useCropOffset} from '../canvas/useCropOffset';\nimport {delay, snapToViewport} from '../utils';\n\n\ntype SpawnAnimatedPreviewOptions = {\n  context: MediaEditorContextValue;\n  cropOffset: ReturnType<typeof useCropOffset>;\n  scaledWidth: number;\n  scaledHeight: number;\n  previewBlob: Blob;\n}\n\nexport default async function spawnAnimatedPreview({\n  context,\n  cropOffset,\n  scaledWidth,\n  scaledHeight,\n  previewBlob\n}: SpawnAnimatedPreviewOptions) {\n  const {editorState: {currentTab, imageCanvas}} = context;\n\n  const isCropping = currentTab === 'crop';\n\n  const bcr = imageCanvas.getBoundingClientRect();\n  const animatedImg = new Image();\n  animatedImg.src = await apiManagerProxy.invoke('createObjectURL', previewBlob);\n  animatedImg.style.position = 'fixed';\n  const left = bcr.left + (isCropping ? cropOffset().left + cropOffset().width / 2 : bcr.width / 2),\n    top = bcr.top + (isCropping ? cropOffset().top + cropOffset().height / 2 : bcr.height / 2);\n\n  const [width, height] = snapToViewport(\n    scaledWidth / scaledHeight,\n    isCropping ? cropOffset().width : bcr.width,\n    isCropping ? cropOffset().height : bcr.height\n  );\n  animatedImg.style.left = left + 'px';\n  animatedImg.style.top = top + 'px';\n  animatedImg.style.width = width + 'px';\n  animatedImg.style.height = height + 'px';\n  animatedImg.style.transform = 'translate(-50%, -50%)';\n  animatedImg.style.objectFit = 'cover';\n  animatedImg.style.zIndex = '1000';\n\n  document.body.append(animatedImg);\n\n  const deferred = deferredPromise<void>();\n\n  animatedImg.addEventListener('load', () => deferred.resolve())\n\n  await Promise.race([delay(500), deferred]);\n\n  return animatedImg;\n}\n","import {getOwner, runWithOwner} from 'solid-js';\nimport {unwrap} from 'solid-js/store';\nimport {MediaSize} from '../../../helpers/mediaSize';\nimport noop from '../../../helpers/noop';\nimport {logger} from '../../../lib/logger';\nimport {adjustmentsConfig, AdjustmentsConfig} from '../adjustments';\nimport BrushPainter from '../canvas/brushPainter';\nimport {useCropOffset} from '../canvas/useCropOffset';\nimport {EditingMediaState, useMediaEditorContext} from '../context';\nimport {NumberPair, StandaloneSignal} from '../types';\nimport {checkIfHasAnimatedStickers, cleanupWebGl, snapToAvailableQuality} from '../utils';\nimport {draw} from '../webgl/draw';\nimport {initWebGL} from '../webgl/initWebGL';\nimport getResultSize from './getResultSize';\nimport getResultTransform from './getResultTransform';\nimport getScaledLayersAndLines from './getScaledLayersAndLines';\nimport renderToActualVideo from './renderToActualVideo';\nimport renderToImage from './renderToImage';\nimport renderToVideoGIF from './renderToVideoGIF';\nimport spawnAnimatedPreview from './spawnAnimatedPreview';\n\n\nexport type MediaEditorFinalResultPayload = {\n  blob: Blob;\n  hasSound: boolean;\n  thumb?: {\n    blob: Blob;\n    size: MediaSize;\n  }\n};\n\nexport type MediaEditorFinalResult = {\n  preview: Blob;\n  getResult: () => MediaEditorFinalResultPayload | Promise<MediaEditorFinalResultPayload>;\n  cancel?: () => void;\n  isVideo: boolean;\n  width: number;\n  height: number;\n  originalSrc: string;\n  originalSize?: NumberPair;\n  editingMediaState: EditingMediaState;\n  animatedPreview?: HTMLImageElement;\n  creationProgress?: StandaloneSignal<number>;\n};\n\nconst log = logger('MediaEditor.createFinalResult');\n\nexport async function createFinalResult(): Promise<MediaEditorFinalResult> {\n  const context = useMediaEditorContext();\n  const {editorState, mediaState, mediaSrc, mediaType, imageRatio} = context;\n  const {resizableLayers, adjustments} = mediaState;\n\n  const owner = getOwner();\n\n  const cropOffset = useCropOffset();\n\n  const hasAnimatedStickers = checkIfHasAnimatedStickers(resizableLayers);\n\n  const willResultInVideo = hasAnimatedStickers || mediaType === 'video';\n\n  const videoType = mediaType === 'video' ? 'video' : hasAnimatedStickers ? 'gif' : undefined;\n\n  const [, maxHeight] = getResultSize({\n    imageWidth: editorState.renderingPayload?.media.width,\n    newRatio: mediaState.currentImageRatio,\n    scale: mediaState.scale,\n    videoType,\n    imageRatio: imageRatio,\n    cropOffset: cropOffset()\n  });\n\n  const maxQuality = snapToAvailableQuality(maxHeight);\n\n  const [scaledWidth, scaledHeight] = getResultSize({\n    imageWidth: editorState.renderingPayload?.media.width,\n    newRatio: mediaState.currentImageRatio,\n    scale: mediaState.scale,\n    videoType,\n    imageRatio,\n    cropOffset: cropOffset(),\n    quality: willResultInVideo ? Math.min(maxQuality, mediaState.videoQuality) : undefined\n  });\n\n  const imageCanvas = document.createElement('canvas');\n  imageCanvas.width = scaledWidth;\n  imageCanvas.height = scaledHeight;\n\n  const gl = imageCanvas.getContext('webgl', {\n    preserveDrawingBuffer: true\n  });\n\n  const payload = await initWebGL({gl, mediaSrc, mediaType, videoTime: mediaState.videoCropStart, waitToSeek: false});\n\n  const finalTransform = getResultTransform({\n    context,\n    scaledWidth,\n    scaledHeight,\n    imageWidth: payload.media.width,\n    imageHeight: payload.media.height,\n    cropOffset\n  });\n\n  const drawToImageCanvas = () => {\n    draw(gl, payload, {\n      ...finalTransform,\n      imageSize: [payload.media.width, payload.media.height],\n      ...(Object.fromEntries(\n        adjustmentsConfig.map(({key, to100}) => {\n          const value = adjustments[key];\n          return [key, value / (to100 ? 100 : 50)];\n        })\n      ) as Record<AdjustmentsConfig[number]['key'], number>)\n    });\n  };\n\n  if(mediaType === 'image') drawToImageCanvas();\n\n  const {scaledLayers, scaledLines} = getScaledLayersAndLines(context, finalTransform, scaledWidth, scaledHeight);\n\n  const brushCanvas = document.createElement('canvas');\n  brushCanvas.width = scaledWidth;\n  brushCanvas.height = scaledHeight;\n\n  const brushPainter = new BrushPainter({targetCanvas: brushCanvas, imageCanvas});\n  brushPainter.saveLastLine();\n  scaledLines.forEach((line) => brushPainter.drawLine(line));\n\n  const resultCanvas = document.createElement('canvas');\n  resultCanvas.width = scaledWidth;\n  resultCanvas.height = scaledHeight;\n  const ctx = resultCanvas.getContext('2d', {willReadFrequently: true});\n\n  const renderPromise = (() => {\n    if(mediaType === 'video')\n      return runWithOwner(owner, () => renderToActualVideo({\n        renderingPayload: payload,\n        hasAnimatedStickers,\n        scaledWidth,\n        scaledHeight,\n        scaledLayers,\n        imageCanvasGL: gl,\n        imageCanvas,\n        drawToImageCanvas,\n        resultCanvas,\n        brushCanvas,\n        ctx\n      }));\n\n    if(hasAnimatedStickers)\n      return runWithOwner(owner, () => renderToVideoGIF({\n        scaledWidth,\n        scaledHeight,\n        scaledLayers,\n        imageCanvas,\n        resultCanvas,\n        brushCanvas,\n        ctx\n      }));\n\n    return renderToImage({\n      context,\n      scaledLayers,\n      imageCanvas,\n      resultCanvas,\n      brushCanvas,\n      ctx\n    });\n  })();\n\n  const renderResult = await renderPromise;\n\n  const animatedPreview = await spawnAnimatedPreview({\n    context,\n    cropOffset,\n    scaledWidth,\n    scaledHeight,\n    previewBlob: renderResult.preview\n  });\n\n  Promise.resolve(renderResult.getResult())?.catch(noop)?.finally(() => {\n    cleanupWebGl(gl);\n    log('cleaning up webgl')\n  });\n\n  return {\n    ...renderResult,\n    animatedPreview,\n    width: scaledWidth,\n    height: scaledHeight,\n    originalSrc: context.mediaSrc,\n    originalSize: [payload.media.width, payload.media.height],\n    editingMediaState: structuredClone(unwrap(mediaState))\n  };\n}\n","import {onMount} from 'solid-js';\n\nimport ripple from '../ripple';\n\nimport {useMediaEditorContext} from './context';\n\n\nexport default function FinishButton(props: {onClick: () => void}) {\n  let container: HTMLDivElement;\n  const {hasModifications} = useMediaEditorContext();\n\n  onMount(() => {\n    ripple(container);\n  });\n\n  return (\n    <div\n      ref={container}\n      onClick={props.onClick}\n      class=\"media-editor__finish-button\"\n      classList={{\n        'media-editor__finish-button--hidden': !hasModifications()\n      }}\n    >\n      <svg width=\"18\" height=\"16\" viewBox=\"0 0 18 16\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n        <path d=\"M2 9L6.5 14L16 2\" stroke=\"white\" stroke-width=\"2.66\" stroke-linecap=\"round\" stroke-linejoin=\"round\" />\n      </svg>\n    </div>\n  );\n}\n","import {createMemo, JSX} from 'solid-js';\n\nimport clamp from '../../helpers/number/clamp';\nimport {hexaToHsla} from '../../helpers/color';\nimport nMap from '../../helpers/number/nMap';\n\nexport default function RangeInput(props: {\n  ref?: (el: HTMLDivElement) => void;\n  style?: JSX.CSSProperties;\n  label: JSX.Element;\n  value: number;\n  min: number;\n  max: number;\n  onChange: (value: number) => void;\n  onChangeFinish?: (prevValue: number, currentValue: number) => void;\n  passiveLabel?: boolean;\n  color?: string;\n}) {\n  const normalizedValue = () => nMap(props.value, props.min, props.max, 0, 1);\n  const mappedCenter = createMemo(() => nMap(0, props.min, props.max, 0, 100));\n\n  const brightShadow = () => props.color && hexaToHsla(props.color).l < 32;\n\n  let prevValue: number | null = null;\n\n  return (\n    <div\n      ref={props.ref}\n      class=\"media-editor__range-input\"\n      classList={{\n        'media-editor__range-input--passive': props.passiveLabel,\n        'media-editor__range-input--has-value': !props.passiveLabel && !!props.value,\n        'media-editor__range-input--bright-shadow': brightShadow()\n      }}\n      style={{\n        '--color': props.color,\n        '--normalized': normalizedValue(),\n        '--w': (Math.abs(props.value - Math.max(0, props.min)) / (props.max - props.min)) * 100 + '%',\n        '--bar-left': props.value >= 0 ? Math.max(0, mappedCenter()) + '%' : undefined,\n        '--bar-right': props.value < 0 ? mappedCenter() + '%' : undefined,\n        ...props.style\n      }}\n    >\n      <div class=\"media-editor__range-input-row\">\n        <div class=\"media-editor__range-input-label\">{props.label}</div>\n        <div class=\"media-editor__range-input-value\">{props.value}</div>\n      </div>\n      <div class=\"media-editor__range-input-wrapper\">\n        <input\n          type=\"range\"\n          min={props.min}\n          max={props.max}\n          step=\"1\"\n          value={props.value}\n          onInput={(e) => {\n            if(prevValue === null) prevValue = props.value;\n            const newValue = clamp(e.currentTarget.valueAsNumber, props.min, props.max);\n            props.onChange(newValue);\n          }}\n          onChange={() => {\n            props.onChangeFinish?.(prevValue, props.value);\n            prevValue = null;\n          }}\n        />\n        <div class=\"media-editor__range-input-thumb media-editor__range-input-thumb--shadow\" />\n        <div class=\"media-editor__range-input-progress media-editor__range-input-progress--shadow\" />\n        <div class=\"media-editor__range-input-progress-background\" />\n        <div class=\"media-editor__range-input-thumb\" />\n        <div class=\"media-editor__range-input-progress\" />\n      </div>\n    </div>\n  );\n}\n","import {createMemo, createSelector, For, JSX} from 'solid-js';\nimport clamp from '../../helpers/number/clamp';\n\n\nexport type StepInputStep<T = any> = {\n  value: T;\n  label: JSX.Element;\n};\n\nexport default function StepInput<T = any>(props: {\n  label: JSX.Element;\n  value: T;\n  steps: StepInputStep[];\n  onChange: (value: T) => void;\n}) {\n  const stepIndex = createMemo(() => props.steps.findIndex(step => step.value === props.value));\n  const step = createMemo(() => props.steps[stepIndex()]);\n\n  const isActive = createSelector(stepIndex, (a, b) => a <= b);\n  const isSelected = createSelector(stepIndex, (a, b) => a === b);\n\n  return (\n    <div\n      class=\"media-editor__step-input\"\n    >\n      <div class=\"media-editor__range-input-row\">\n        <div class=\"media-editor__range-input-label\">{props.label}</div>\n        <div class=\"media-editor__range-input-value\">{step().label}</div>\n      </div>\n\n      <div class=\"media-editor__step-input-wrapper\">\n        <input\n          type=\"range\"\n          min={0}\n          max={props.steps.length - 1}\n          step=\"1\"\n          value={stepIndex()}\n          onInput={(e) => {\n            const newValue = Math.round(clamp(e.currentTarget.valueAsNumber, 0, props.steps.length - 1)); // just in case\n            props.onChange(props.steps[newValue].value);\n          }}\n        />\n        <For each={props.steps}>\n          {(_, index) => <>\n            {index() && <div\n              class=\"media-editor__step-input-separator\"\n              classList={{\n                'media-editor__step-input-separator--active': isActive(index())\n              }}\n            />}\n            <div\n              class=\"media-editor__step-input-dot\"\n              classList={{\n                'media-editor__step-input-dot--active': isActive(index()),\n                'media-editor__step-input-dot--selected': isSelected(index())\n              }}\n            />\n          </>}\n        </For>\n      </div>\n    </div>\n  );\n}\n","import {createEffect, createMemo, createSignal, on, onCleanup, Show} from 'solid-js';\n\nimport {i18n} from '../../../lib/langPack';\n\nimport Space from '../../space';\n\nimport {adjustmentsConfig} from '../adjustments';\nimport {useCropOffset} from '../canvas/useCropOffset';\nimport {useMediaEditorContext} from '../context';\nimport getResultSize from '../finalRender/getResultSize';\nimport RangeInput from '../rangeInput';\nimport StepInput, {StepInputStep} from '../stepInput';\nimport useIsMobile from '../useIsMobile';\nimport {availableQualityHeights, checkIfHasAnimatedStickers, snapToAvailableQuality} from '../utils';\n\n\nconst ADJUST_TIMEOUT = 800;\n\nexport default function AdjustmentsTab() {\n  const {editorState, mediaState, actions, mediaSize, mediaType, imageRatio} = useMediaEditorContext();\n\n  const isMobile = useIsMobile();\n  const cropOffset = useCropOffset();\n\n  let timeoutId = 0;\n  function removeIsAdjusting() {\n    window.clearTimeout(timeoutId);\n    timeoutId = window.setTimeout(() => {\n      editorState.isAdjusting = false;\n    }, ADJUST_TIMEOUT);\n  }\n\n  const resultingSize = createMemo(() =>\n    getResultSize({\n      imageWidth: mediaSize[0],\n      scale: mediaState.scale,\n      newRatio: mediaState.currentImageRatio || imageRatio,\n      videoType: mediaType === 'video' ? 'video' : 'gif',\n      imageRatio,\n      cropOffset: !cropOffset().width ? {width: 1, height: 1} : cropOffset()\n    })\n  );\n\n  createEffect(() => {\n    resultingSize();\n    (window as any).debugResultingSize && console.log('resultingSize', resultingSize());\n  });\n\n  const maxVideoQuality = createMemo(() => snapToAvailableQuality(resultingSize()[1]));\n\n  const steps = createMemo((): StepInputStep[] =>\n    availableQualityHeights\n    .filter(height => height <= maxVideoQuality())\n    .map(height => ({value: height, label: height + 'p'}))\n  );\n\n  const canShowQualityInput = createMemo(() => (mediaType === 'video' || checkIfHasAnimatedStickers(mediaState.resizableLayers)) && steps().length > 1);\n\n  return (\n    <>\n      <Space amount=\"16px\" />\n\n      <Show when={canShowQualityInput()}>\n        <StepInput\n          label={i18n('Quality')}\n          steps={steps()}\n          value={Math.min(maxVideoQuality(), mediaState.videoQuality)}\n          onChange={(value) => void(mediaState.videoQuality = value)}\n        />\n        <Space amount=\"32px\" />\n      </Show>\n\n      {adjustmentsConfig.map((item) => {\n        const [container, setContainer] = createSignal<HTMLDivElement>();\n\n        const [showGhost, setShowGhost] = createSignal(false);\n\n        const value = () => mediaState.adjustments[item.key];\n        const setValue = (v: number): void => void (mediaState.adjustments[item.key] = v);\n\n        createEffect(\n          on(showGhost, () => {\n            if(!container() || !isMobile() || !showGhost()) return;\n            const bcr = container().getBoundingClientRect();\n            const div = (\n              <div\n                class=\"night media-editor__inherit-color\"\n                style={{\n                  'position': 'fixed',\n                  'left': bcr.left + 'px',\n                  'top': bcr.top + 'px',\n                  'width': bcr.width + 'px',\n                  'height': bcr.height + 'px',\n                  'z-index': 100\n                }}\n              >\n                <RangeInput\n                  value={value()}\n                  onChange={() => {}}\n                  label={item.label()}\n                  min={item.to100 ? 0 : -50}\n                  max={item.to100 ? 100 : 50}\n                />\n              </div>\n            ) as HTMLDivElement;\n            document.body.append(div);\n\n            onCleanup(() => {\n              setTimeout(() => {\n                div.remove();\n              }, 200);\n            });\n          })\n        );\n\n        let timeoutId = 0;\n        const removeGhost = () => {\n          window.clearTimeout(timeoutId);\n          timeoutId = window.setTimeout(() => {\n            setShowGhost(false);\n          }, ADJUST_TIMEOUT);\n        };\n\n        return (\n          <>\n            <RangeInput\n              ref={setContainer}\n              value={value()}\n              onChange={(v) => {\n                setValue(v);\n                setShowGhost(true);\n                editorState.isAdjusting = true;\n                removeGhost();\n                removeIsAdjusting();\n              }}\n              label={item.label()}\n              onChangeFinish={(prevValue, currentValue) => {\n                setShowGhost(false);\n                editorState.isAdjusting = false;\n\n                actions.pushToHistory({\n                  path: ['adjustments', item.key],\n                  newValue: currentValue,\n                  oldValue: prevValue\n                });\n              }}\n              min={item.to100 ? 0 : -50}\n              max={item.to100 ? 100 : 50}\n            />\n            <Space amount=\"32px\" />\n          </>\n        );\n      })}\n    </>\n  );\n}\n","import {ButtonIconTsx} from '../../buttonIconTsx';\n\nimport {useMediaEditorContext} from '../context';\n\ntype ConfigItem = {\n  icon: Icon;\n  key: string;\n};\n\nconst config: ConfigItem[] = [\n  {icon: 'equalizer', key: 'adjustments'},\n  {icon: 'crop', key: 'crop'},\n  {icon: 'text', key: 'text'},\n  {icon: 'brush', key: 'brush'},\n  {icon: 'smile', key: 'stickers'}\n];\n\nexport const mediaEditorTabsOrder = config.map((item) => item.key);\n\nexport default function Tabs() {\n  const {editorState} = useMediaEditorContext();\n\n  let container: HTMLDivElement;\n  let underline: HTMLDivElement;\n\n  const tabs = config.map((item) => ({\n    ...item,\n    element: (\n      <div class=\"media-editor__tabs-item\" classList={{'media-editor__tabs-item--active': editorState.currentTab === item.key}}>\n        <ButtonIconTsx icon={item.icon} onClick={() => onTabClick(item.key)} />\n      </div>\n    ) as HTMLElement\n  }));\n\n  function onTabClick(key: string) {\n    const target = tabs.find((tab) => tab.key === key).element;\n    const containerBR = container.getBoundingClientRect();\n    const targetBR = target.getBoundingClientRect();\n\n    underline.style.setProperty('--left', targetBR.left + targetBR.width / 2 - containerBR.left + 'px');\n\n    editorState.currentTab = key;\n  }\n\n  return (\n    <div ref={container} class=\"media-editor__tabs\">\n      {tabs.map((tab) => tab.element)}\n      <div ref={underline} class=\"media-editor__tabs-underline\" />\n    </div>\n  );\n}\n","import {Accessor, createContext, createEffect, createSignal, JSX, onCleanup, onMount} from 'solid-js';\n\nimport {doubleRaf} from '../../../helpers/schedulers';\nimport Scrollable from '../../scrollable';\n\nimport {useMediaEditorContext} from '../context';\nimport {delay} from '../utils';\n\nimport {mediaEditorTabsOrder} from './tabs';\n\ntype TabContentContextValue = {\n  container: Accessor<HTMLDivElement>;\n  scrollAmount: Accessor<number>;\n};\nexport const TabContentContext = createContext<TabContentContextValue>();\n\nexport default function TabContent(props: {\n  tabs: Record<string, () => JSX.Element>;\n  onContainer: (el: HTMLDivElement) => void;\n  onScroll: () => void;\n}) {\n  const {editorState} = useMediaEditorContext();\n\n  const [container, setContainer] = createSignal<HTMLDivElement>();\n  const [scrollAmount, setScrollAmount] = createSignal(0);\n  let prevElement: HTMLDivElement;\n  let prevTab = editorState.currentTab;\n  let scrollable: Scrollable;\n\n  createEffect(async() => {\n    if(prevTab === editorState.currentTab) return;\n\n    const toRight = mediaEditorTabsOrder.indexOf(editorState.currentTab) > mediaEditorTabsOrder.indexOf(prevTab);\n    prevTab = editorState.currentTab;\n\n    scrollable.destroy();\n    const newElement = (\n      <div>\n        <div class=\"media-editor__tab-content-scrollable-content\">\n          <TabContentContext.Provider value={{container, scrollAmount}}>\n            {props.tabs[editorState.currentTab]()}\n          </TabContentContext.Provider>\n        </div>\n      </div>\n    ) as HTMLDivElement;\n    setScrollable(newElement);\n\n    const cls = (element: HTMLElement, action: 'add' | 'remove', modifier: string) =>\n      element.classList[action]('media-editor__tab-content--' + modifier);\n\n    cls(prevElement, 'add', 'exit');\n\n    if(toRight) {\n      cls(newElement, 'add', 'go-right');\n      container().append(newElement);\n      await doubleRaf();\n      cls(prevElement, 'add', 'go-left');\n      cls(newElement, 'remove', 'go-right');\n    } else {\n      cls(newElement, 'add', 'go-left');\n      container().append(newElement);\n      await doubleRaf();\n      cls(prevElement, 'add', 'go-right');\n      cls(newElement, 'remove', 'go-left');\n    }\n\n    await delay(200);\n    prevElement.remove();\n\n    prevElement = newElement;\n  });\n\n  const initialTab = props.tabs[editorState.currentTab]();\n\n  function setScrollable(element: HTMLElement) {\n    // TODO: Scrollable thumb not showing\n    scrollable = new Scrollable(element);\n    scrollable.setListeners();\n    scrollable.container.addEventListener('scroll', () => {\n      props.onScroll();\n      setScrollAmount(scrollable.container.scrollTop);\n    });\n  }\n\n  onMount(() => {\n    setScrollable(prevElement);\n  });\n\n  onCleanup(() => {\n    scrollable.destroy();\n  });\n\n  return (\n    <div\n      ref={(el) => {\n        setContainer(el);\n        props.onContainer(el);\n      }}\n      class=\"media-editor__tab-content\"\n    >\n      <div ref={prevElement}>\n        <div class=\"media-editor__tab-content-scrollable-content\">\n          <TabContentContext.Provider value={{container, scrollAmount}}>{initialTab}</TabContentContext.Provider>\n        </div>\n      </div>\n    </div>\n  );\n}\n","import {batch, createEffect, createResource, createSignal, For, onCleanup, onMount, Show, useContext} from 'solid-js';\n\nimport wrapEmojiText from '../../../lib/richTextProcessor/wrapEmojiText';\nimport {useHotReloadGuard} from '../../../lib/solidjs/hotReloadGuard';\nimport {Document, EmojiGroup, StickerSet} from '../../../layer';\nimport {i18n} from '../../../lib/langPack';\n\nimport SuperStickerRenderer from '../../emoticonsDropdown/tabs/SuperStickerRenderer';\nimport createMiddleware from '../../../helpers/solid/createMiddleware';\nimport LazyLoadQueue from '../../lazyLoadQueue';\nimport {ScrollableX} from '../../scrollable';\nimport {IconTsx} from '../../iconTsx';\nimport Space from '../../space';\n\nimport useNormalizePoint from '../canvas/useNormalizePoint';\nimport {HistoryItem, useMediaEditorContext} from '../context';\nimport {ResizableLayer} from '../types';\nimport {delay} from '../utils';\n\nimport {TabContentContext} from './tabContent';\n\nexport default function StickersTab() {\n  const {wrapStickerSetThumb, EmoticonsSearch} = useHotReloadGuard();\n  const context = useMediaEditorContext();\n  const {container, scrollAmount} = useContext(TabContentContext);\n\n  const {managers, editorState, mediaState, actions} = context;\n\n  const normalizePoint = useNormalizePoint();\n\n  const [recentStickers] = createResource(() => managers.appStickersManager.getRecentStickersStickers());\n  const [stickerSets] = createResource(() => managers.appStickersManager.getAllStickers());\n  const [filteredStickers, setFilteredStickers] = createSignal<Document.document[]>();\n\n  const [search, setSearch] = createSignal('');\n  const [group, setGroup] = createSignal<EmojiGroup>();\n  const [activeSet, setActiveSet] = createSignal('recent');\n  const [scrolling, setScrolling] = createSignal(false);\n\n  const [intersectionObserver, setIntersectionObserver] = createSignal<IntersectionObserver>();\n  const [recentLabel, setRecentLabel] = createSignal<HTMLDivElement>();\n\n  const lazyLoadQueue = new LazyLoadQueue();\n  const stickerRenderer = new SuperStickerRenderer({\n    regularLazyLoadQueue: lazyLoadQueue,\n    group: 'none',\n    managers,\n    intersectionObserverInit: {root: container()},\n    withLock: false\n  });\n\n  onCleanup(() => {\n    stickerRenderer.destroy();\n    lazyLoadQueue.clear();\n  });\n\n  async function onStickerSetThumbClick(id: string) {\n    setActiveSet(String(id));\n    setScrolling(true);\n    container()?.querySelector(`[data-set-id=\"${id}\"]`)?.scrollIntoView({\n      behavior: 'smooth',\n      block: 'start'\n    });\n    await delay(1000);\n    setScrolling(false);\n  }\n\n  function StickerSetThumb(props: {set: StickerSet.stickerSet}) {\n    let renderContainer: HTMLDivElement;\n\n\n    onMount(() => {\n      const middleware = createMiddleware();\n\n      wrapStickerSetThumb({\n        container: renderContainer,\n        group: 'none',\n        autoplay: true,\n        width: 30,\n        height: 30,\n        lazyLoadQueue,\n        middleware: middleware.get(),\n        set: props.set,\n        managers,\n        textColor: 'white'\n      });\n    });\n\n    const isActive = () => String(props.set.id) === activeSet();\n\n    return (\n      <div\n        ref={renderContainer}\n        class=\"media-editor__stickers-set-thumb\"\n        classList={{\n          'media-editor__stickers-set-thumb--active': isActive()\n        }}\n        onClick={() => onStickerSetThumbClick(String(props.set.id))}\n      />\n    );\n  }\n\n  function Sticker(props: {doc: Document.document}) {\n    let container: HTMLDivElement;\n\n    onMount(() => {\n      stickerRenderer.renderSticker(props.doc, container);\n      stickerRenderer.observeAnimated(container);\n    });\n\n    function onClick() {\n      const id = context.resizableLayersSeed++;\n      const transform = editorState.finalTransform;\n      const newLayer = {\n        id,\n        position: normalizePoint([editorState.canvasSize[0] / 2, editorState.canvasSize[1] / 2]),\n        rotation: -transform.rotation,\n        scale: 1 / transform.scale,\n        type: 'sticker',\n        sticker: props.doc\n      } as ResizableLayer;\n\n      batch(() => {\n        mediaState.resizableLayers.push(newLayer);\n        editorState.selectedResizableLayer = id;\n\n        actions.pushToHistory({\n          path: ['resizableLayers', mediaState.resizableLayers.length - 1],\n          newValue: newLayer,\n          oldValue: HistoryItem.RemoveArrayItem,\n          findBy: {\n            id: newLayer.id\n          }\n        })\n      });\n    }\n\n    return <div ref={container} class=\"media-editor__stickers-grid-item\" onClick={onClick} />;\n  }\n\n  function StickerSetLabel(props: {set: StickerSet.stickerSet}) {\n    let label: HTMLDivElement;\n\n    createEffect(() => {\n      if(intersectionObserver()) {\n        intersectionObserver().observe(label);\n        onCleanup(() => {\n          intersectionObserver()?.unobserve(label);\n        });\n      }\n    });\n\n    return (\n      <div ref={label} data-set-id={props.set.id} class=\"media-editor__label\">\n        {wrapEmojiText(props.set.title)}\n      </div>\n    );\n  }\n\n  function StickerSetSection(props: {set: StickerSet.stickerSet}) {\n    const [stickers] = createResource(() => managers.appStickersManager.getStickerSet(props.set));\n\n    return (\n      <Show when={stickers()}>\n        <Space amount=\"16px\" />\n        <StickerSetLabel set={props.set} />\n        <div class=\"media-editor__stickers-grid\">\n          <For each={stickers().documents}>{(doc) => <Sticker doc={doc as Document.document} />}</For>\n        </div>\n      </Show>\n    );\n  }\n\n  function ThumbList() {\n    let thumbsListScrollable: HTMLDivElement;\n\n    onMount(() => {\n      document.querySelector('.media-editor__tabs')?.append(thumbsListScrollable);\n      new ScrollableX(thumbsListScrollable);\n    });\n    onCleanup(() => {\n      thumbsListScrollable.remove();\n    });\n\n    const visible = () => stickerSets() && !filteredStickers();\n    <div\n      class=\"media-editor__stickers-thumb-list-scrollable\"\n      classList={{\n        'media-editor__stickers-thumb-list-scrollable--hidden': !visible(),\n        'media-editor__stickers-thumb-list-scrollable--has-scroll': scrollAmount() > 8\n      }}\n      ref={thumbsListScrollable}\n    >\n      <div class=\"media-editor__stickers-thumb-list\">\n        <Show when={recentStickers()?.length}>\n          <div\n            class=\"media-editor__stickers-recent-button\"\n            classList={{\n              'media-editor__stickers-recent-button--active': activeSet() === 'recent'\n            }}\n            onClick={() => onStickerSetThumbClick('recent')}\n          >\n            <IconTsx icon=\"recent\" />\n          </div>\n        </Show>\n        <For each={stickerSets()?.sets}>{(set) => <StickerSetThumb set={set} />}</For>\n      </div>\n    </div>;\n    return <></>;\n  }\n\n  createEffect(() => {\n    setIntersectionObserver(\n      new IntersectionObserver(\n        (entries) => {\n          entries.forEach((entry) => {\n            if(!scrolling() && entry.isIntersecting) {\n              const id = (entry.target as HTMLDivElement).dataset.setId;\n              if(id) setActiveSet(id);\n            }\n          });\n        },\n        {\n          root: container(),\n          rootMargin: `0px 0px -${container().clientHeight - 100}px 0px`\n        }\n      )\n    );\n\n    onCleanup(() => {\n      intersectionObserver()?.disconnect();\n    });\n  });\n\n  createEffect(() => {\n    if(intersectionObserver() && recentLabel()) {\n      intersectionObserver().observe(recentLabel());\n      onCleanup(() => {\n        intersectionObserver()?.unobserve(recentLabel());\n      });\n    }\n  });\n\n  createEffect(async() => {\n    if(search()) {\n      setFilteredStickers(await managers.appStickersManager.searchStickers(search()));\n      return;\n    }\n    if(group()) {\n      const g = group();\n      if(g._ === 'emojiGroupPremium') {\n        setFilteredStickers(await managers.appStickersManager.getPremiumStickers());\n        return;\n      }\n      setFilteredStickers(\n        await managers.appStickersManager.getStickersByEmoticon({\n          emoticon: g.emoticons,\n          includeServerStickers: true\n        })\n      );\n\n      return;\n    }\n    if(!group() && !search()) {\n      setFilteredStickers();\n    }\n  });\n\n  return (\n    <>\n      <ThumbList />\n\n      <Space amount={filteredStickers() ? '0px' : '48px'} />\n      <Space amount=\"8px\" />\n\n      <div class=\"media-editor__sticker-search\">\n        <EmoticonsSearch\n          type=\"stickers\"\n          onValue={(value) => {\n            setSearch(value);\n          }}\n          onGroup={(group) => {\n            setGroup(group);\n          }}\n          categoryColor=\"white\"\n          animatedItemGroup=\"none\"\n        />\n      </div>\n\n      {/* TODO: Favorties */}\n      <Space amount=\"16px\" />\n\n      <Show when={recentStickers()?.length > 0 && !filteredStickers()}>\n        <div ref={setRecentLabel} class=\"media-editor__label\" data-set-id=\"recent\">\n          {i18n('MediaEditor.RecentlyUsed')}\n        </div>\n\n        <div class=\"media-editor__stickers-grid\">\n          <For each={recentStickers()}>{(doc) => <Sticker doc={doc} />}</For>\n        </div>\n      </Show>\n\n      <Show when={filteredStickers()}>\n        <div class=\"media-editor__stickers-grid\">\n          <For each={filteredStickers()}>{(doc) => <Sticker doc={doc} />}</For>\n        </div>\n      </Show>\n\n      <Show when={stickerSets() && !filteredStickers()}>\n        <For each={stickerSets().sets}>{(set) => <StickerSetSection set={set} />}</For>\n      </Show>\n    </>\n  );\n}\n","export function PenBrush() {\n  return (\n    <svg width=\"120\" height=\"48\" viewBox=\"0 0 120 48\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n      <g clip-path=\"url(#clip0_6102_2542)\">\n        <g filter=\"url(#filter0_iiii_6102_2542)\">\n          <path\n            d=\"M0 15H80L110.2 22.4465C112.048 22.9021 112.971 23.1299 113.185 23.4931C113.369 23.806 113.369 24.194 113.185 24.5069C112.971 24.8701 112.048 25.0979 110.2 25.5535L80 33H0V15Z\"\n            fill=\"#3E3F3F\"\n          />\n        </g>\n        <path\n          d=\"M112.564 24.9709L103.474 27.2132C103.21 27.2782 102.944 27.121 102.883 26.8566C102.736 26.2146 102.5 25.0296 102.5 24C102.5 22.9705 102.736 21.7855 102.883 21.1434C102.944 20.8791 103.21 20.7219 103.474 20.7868L112.564 23.0291C113.578 23.2792 113.578 24.7208 112.564 24.9709Z\"\n          fill=\"currentColor\"\n        />\n        <rect x=\"76\" y=\"15\" width=\"4\" height=\"18\" rx=\"0.5\" fill=\"currentColor\" />\n      </g>\n      <defs>\n        <filter\n          id=\"filter0_iiii_6102_2542\"\n          x=\"0\"\n          y=\"10\"\n          width=\"116.323\"\n          height=\"28\"\n          filterUnits=\"userSpaceOnUse\"\n          color-interpolation-filters=\"sRGB\"\n        >\n          <feFlood flood-opacity=\"0\" result=\"BackgroundImageFix\" />\n          <feBlend mode=\"normal\" in=\"SourceGraphic\" in2=\"BackgroundImageFix\" result=\"shape\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"1\" dy=\"5\" />\n          <feGaussianBlur stdDeviation=\"3\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.137255 0 0 0 0 0.145098 0 0 0 0 0.14902 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"shape\" result=\"effect1_innerShadow_6102_2542\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"3\" dy=\"-5\" />\n          <feGaussianBlur stdDeviation=\"3\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.137255 0 0 0 0 0.145098 0 0 0 0 0.14902 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"effect1_innerShadow_6102_2542\" result=\"effect2_innerShadow_6102_2542\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"1\" dy=\"-1\" />\n          <feGaussianBlur stdDeviation=\"0.5\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.242217 0 0 0 0 0.247242 0 0 0 0 0.247101 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"effect2_innerShadow_6102_2542\" result=\"effect3_innerShadow_6102_2542\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"1\" dy=\"1\" />\n          <feGaussianBlur stdDeviation=\"0.5\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.242217 0 0 0 0 0.247242 0 0 0 0 0.247101 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"effect3_innerShadow_6102_2542\" result=\"effect4_innerShadow_6102_2542\" />\n        </filter>\n        <clipPath id=\"clip0_6102_2542\">\n          <rect width=\"20\" height=\"120\" fill=\"white\" transform=\"matrix(0 1 -1 0 120 14)\" />\n        </clipPath>\n      </defs>\n    </svg>\n  );\n}\n\nexport function ArrowBrush() {\n  return (\n    <svg width=\"120\" height=\"48\" viewBox=\"0 0 120 48\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n      <g clip-path=\"url(#clip0_6102_2543)\">\n        <path\n          d=\"M94 24H110M110 24L104 18M110 24L104 30\"\n          stroke=\"url(#paint0_linear_6102_2543)\"\n          stroke-width=\"3\"\n          stroke-linecap=\"round\"\n          stroke-linejoin=\"round\"\n        />\n        <g filter=\"url(#filter0_iiii_6102_2543)\">\n          <path d=\"M0 15H92C94.2091 15 96 16.7909 96 19V29C96 31.2091 94.2091 33 92 33H0V15Z\" fill=\"#3E3F3F\" />\n        </g>\n        <path d=\"M92 15V15C94.2091 15 96 16.7909 96 19V29C96 31.2091 94.2091 33 92 33V33V15Z\" fill=\"currentColor\" />\n      </g>\n      <defs>\n        <filter\n          id=\"filter0_iiii_6102_2543\"\n          x=\"0\"\n          y=\"10\"\n          width=\"99\"\n          height=\"28\"\n          filterUnits=\"userSpaceOnUse\"\n          color-interpolation-filters=\"sRGB\"\n        >\n          <feFlood flood-opacity=\"0\" result=\"BackgroundImageFix\" />\n          <feBlend mode=\"normal\" in=\"SourceGraphic\" in2=\"BackgroundImageFix\" result=\"shape\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"1\" dy=\"5\" />\n          <feGaussianBlur stdDeviation=\"3\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.137255 0 0 0 0 0.145098 0 0 0 0 0.14902 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"shape\" result=\"effect1_innerShadow_6102_2543\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"3\" dy=\"-5\" />\n          <feGaussianBlur stdDeviation=\"3\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.137255 0 0 0 0 0.145098 0 0 0 0 0.14902 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"effect1_innerShadow_6102_2543\" result=\"effect2_innerShadow_6102_2543\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"1\" dy=\"-1\" />\n          <feGaussianBlur stdDeviation=\"0.5\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.242217 0 0 0 0 0.247242 0 0 0 0 0.247101 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"effect2_innerShadow_6102_2543\" result=\"effect3_innerShadow_6102_2543\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"1\" dy=\"1\" />\n          <feGaussianBlur stdDeviation=\"0.5\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.242217 0 0 0 0 0.247242 0 0 0 0 0.247101 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"effect3_innerShadow_6102_2543\" result=\"effect4_innerShadow_6102_2543\" />\n        </filter>\n        <linearGradient id=\"paint0_linear_6102_2543\" x1=\"110\" y1=\"24\" x2=\"94\" y2=\"24\" gradientUnits=\"userSpaceOnUse\">\n          <stop offset=\"0.755\" stop-color=\"currentColor\" />\n          <stop offset=\"1\" stop-color=\"currentColor\" stop-opacity=\"0\" />\n        </linearGradient>\n        <clipPath id=\"clip0_6102_2543\">\n          <rect width=\"20\" height=\"120\" fill=\"white\" transform=\"matrix(0 1 -1 0 120 14)\" />\n        </clipPath>\n      </defs>\n    </svg>\n  );\n}\n\nexport function MarkerBrush() {\n  return (\n    <svg width=\"120\" height=\"48\" viewBox=\"0 0 120 48\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n      <g clip-path=\"url(#clip0_6102_2546)\">\n        <g filter=\"url(#filter0_iiii_6102_2546)\">\n          <path\n            d=\"M0 15H82.3579C83.4414 15 84.5135 15.2201 85.5093 15.6468L91 18H101C101.552 18 102 18.4477 102 19V29C102 29.5523 101.552 30 101 30H91L85.5093 32.3532C84.5135 32.7799 83.4414 33 82.3579 33H0V15Z\"\n            fill=\"#3E3F3F\"\n          />\n        </g>\n        <rect x=\"76\" y=\"15\" width=\"4\" height=\"18\" rx=\"0.5\" fill=\"currentColor\" />\n        <path\n          d=\"M102 19H106.434C106.785 19 107.111 19.1843 107.291 19.4855L112.091 27.4855C112.491 28.152 112.011 29 111.234 29H102V19Z\"\n          fill=\"currentColor\"\n        />\n      </g>\n      <defs>\n        <filter\n          id=\"filter0_iiii_6102_2546\"\n          x=\"0\"\n          y=\"10\"\n          width=\"105\"\n          height=\"28\"\n          filterUnits=\"userSpaceOnUse\"\n          color-interpolation-filters=\"sRGB\"\n        >\n          <feFlood flood-opacity=\"0\" result=\"BackgroundImageFix\" />\n          <feBlend mode=\"normal\" in=\"SourceGraphic\" in2=\"BackgroundImageFix\" result=\"shape\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"1\" dy=\"5\" />\n          <feGaussianBlur stdDeviation=\"3\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.137255 0 0 0 0 0.145098 0 0 0 0 0.14902 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"shape\" result=\"effect1_innerShadow_6102_2546\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"3\" dy=\"-5\" />\n          <feGaussianBlur stdDeviation=\"3\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.137255 0 0 0 0 0.145098 0 0 0 0 0.14902 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"effect1_innerShadow_6102_2546\" result=\"effect2_innerShadow_6102_2546\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"1\" dy=\"-1\" />\n          <feGaussianBlur stdDeviation=\"0.5\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.242217 0 0 0 0 0.247242 0 0 0 0 0.247101 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"effect2_innerShadow_6102_2546\" result=\"effect3_innerShadow_6102_2546\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"1\" dy=\"1\" />\n          <feGaussianBlur stdDeviation=\"0.5\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.242217 0 0 0 0 0.247242 0 0 0 0 0.247101 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"effect3_innerShadow_6102_2546\" result=\"effect4_innerShadow_6102_2546\" />\n        </filter>\n        <clipPath id=\"clip0_6102_2546\">\n          <rect width=\"20\" height=\"120\" fill=\"white\" transform=\"matrix(0 1 -1 0 120 14)\" />\n        </clipPath>\n      </defs>\n    </svg>\n  );\n}\n\nexport function NeonBrush() {\n  return (\n    <svg width=\"120\" height=\"48\" viewBox=\"0 0 120 48\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n      <g clip-path=\"url(#clip0_6102_2547)\">\n        <g filter=\"url(#filter0_f_6102_2547)\">\n          <path\n            d=\"M102 19H107.146C108.282 19 109.323 19.6487 109.601 20.7506C109.813 21.593 110 22.703 110 24C110 25.297 109.813 26.407 109.601 27.2494C109.323 28.3513 108.282 29 107.146 29H102V19Z\"\n            fill=\"currentColor\"\n          />\n        </g>\n        <g filter=\"url(#filter1_f_6102_2547)\">\n          <path\n            d=\"M102 19H107.146C108.282 19 109.323 19.6487 109.601 20.7506C109.813 21.593 110 22.703 110 24C110 25.297 109.813 26.407 109.601 27.2494C109.323 28.3513 108.282 29 107.146 29H102V19Z\"\n            fill=\"currentColor\"\n          />\n        </g>\n        <g filter=\"url(#filter2_f_6102_2547)\">\n          <path\n            d=\"M102 19H107.146C108.282 19 109.323 19.6487 109.601 20.7506C109.813 21.593 110 22.703 110 24C110 25.297 109.813 26.407 109.601 27.2494C109.323 28.3513 108.282 29 107.146 29H102V19Z\"\n            fill=\"currentColor\"\n          />\n        </g>\n        <g filter=\"url(#filter3_iiii_6102_2547)\">\n          <path\n            d=\"M0 15H82.3579C83.4414 15 84.5135 15.2201 85.5093 15.6468L91 18H101C101.552 18 102 18.4477 102 19V29C102 29.5523 101.552 30 101 30H91L85.5093 32.3532C84.5135 32.7799 83.4414 33 82.3579 33H0V15Z\"\n            fill=\"#3E3F3F\"\n          />\n        </g>\n        <rect x=\"76\" y=\"15\" width=\"4\" height=\"18\" rx=\"0.5\" fill=\"currentCOlor\" />\n        <path\n          d=\"M102 19H107.146C108.282 19 109.323 19.6487 109.601 20.7506C109.813 21.593 110 22.703 110 24C110 25.297 109.813 26.407 109.601 27.2494C109.323 28.3513 108.282 29 107.146 29H102V19Z\"\n          fill=\"currentCOlor\"\n        />\n      </g>\n      <defs>\n        <filter\n          id=\"filter0_f_6102_2547\"\n          x=\"96\"\n          y=\"13\"\n          width=\"20\"\n          height=\"22\"\n          filterUnits=\"userSpaceOnUse\"\n          color-interpolation-filters=\"sRGB\"\n        >\n          <feFlood flood-opacity=\"0\" result=\"BackgroundImageFix\" />\n          <feBlend mode=\"normal\" in=\"SourceGraphic\" in2=\"BackgroundImageFix\" result=\"shape\" />\n          <feGaussianBlur stdDeviation=\"3\" result=\"effect1_foregroundBlur_6102_2547\" />\n        </filter>\n        <filter\n          id=\"filter1_f_6102_2547\"\n          x=\"96\"\n          y=\"13\"\n          width=\"20\"\n          height=\"22\"\n          filterUnits=\"userSpaceOnUse\"\n          color-interpolation-filters=\"sRGB\"\n        >\n          <feFlood flood-opacity=\"0\" result=\"BackgroundImageFix\" />\n          <feBlend mode=\"normal\" in=\"SourceGraphic\" in2=\"BackgroundImageFix\" result=\"shape\" />\n          <feGaussianBlur stdDeviation=\"3\" result=\"effect1_foregroundBlur_6102_2547\" />\n        </filter>\n        <filter\n          id=\"filter2_f_6102_2547\"\n          x=\"96\"\n          y=\"13\"\n          width=\"20\"\n          height=\"22\"\n          filterUnits=\"userSpaceOnUse\"\n          color-interpolation-filters=\"sRGB\"\n        >\n          <feFlood flood-opacity=\"0\" result=\"BackgroundImageFix\" />\n          <feBlend mode=\"normal\" in=\"SourceGraphic\" in2=\"BackgroundImageFix\" result=\"shape\" />\n          <feGaussianBlur stdDeviation=\"3\" result=\"effect1_foregroundBlur_6102_2547\" />\n        </filter>\n        <filter\n          id=\"filter3_iiii_6102_2547\"\n          x=\"0\"\n          y=\"10\"\n          width=\"105\"\n          height=\"28\"\n          filterUnits=\"userSpaceOnUse\"\n          color-interpolation-filters=\"sRGB\"\n        >\n          <feFlood flood-opacity=\"0\" result=\"BackgroundImageFix\" />\n          <feBlend mode=\"normal\" in=\"SourceGraphic\" in2=\"BackgroundImageFix\" result=\"shape\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"1\" dy=\"5\" />\n          <feGaussianBlur stdDeviation=\"3\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.137255 0 0 0 0 0.145098 0 0 0 0 0.14902 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"shape\" result=\"effect1_innerShadow_6102_2547\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"3\" dy=\"-5\" />\n          <feGaussianBlur stdDeviation=\"3\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.137255 0 0 0 0 0.145098 0 0 0 0 0.14902 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"effect1_innerShadow_6102_2547\" result=\"effect2_innerShadow_6102_2547\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"1\" dy=\"-1\" />\n          <feGaussianBlur stdDeviation=\"0.5\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.242217 0 0 0 0 0.247242 0 0 0 0 0.247101 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"effect2_innerShadow_6102_2547\" result=\"effect3_innerShadow_6102_2547\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"1\" dy=\"1\" />\n          <feGaussianBlur stdDeviation=\"0.5\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.242217 0 0 0 0 0.247242 0 0 0 0 0.247101 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"effect3_innerShadow_6102_2547\" result=\"effect4_innerShadow_6102_2547\" />\n        </filter>\n        <clipPath id=\"clip0_6102_2547\">\n          <rect width=\"20\" height=\"120\" fill=\"white\" transform=\"matrix(0 1 -1 0 120 14)\" />\n        </clipPath>\n      </defs>\n    </svg>\n  );\n}\n\nexport function EraserBrush() {\n  return (\n    <svg width=\"120\" height=\"48\" viewBox=\"0 0 120 48\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n      <g clip-path=\"url(#clip0_6102_2544)\">\n        <g filter=\"url(#filter0_i_6102_2544)\">\n          <path d=\"M95 15H108C110.209 15 112 16.7909 112 19V29C112 31.2091 110.209 33 108 33H95V15Z\" fill=\"#D9D9D9\" />\n          <path d=\"M95 15H108C110.209 15 112 16.7909 112 19V29C112 31.2091 110.209 33 108 33H95V15Z\" fill=\"#F09B99\" />\n        </g>\n        <g filter=\"url(#filter1_iiii_6102_2544)\">\n          <path\n            d=\"M0 15H77.6464C77.8728 15 78.0899 14.9101 78.25 14.75V14.75C78.4101 14.5899 78.6272 14.5 78.8536 14.5H96C97.1046 14.5 98 15.3954 98 16.5V31.5C98 32.6046 97.1046 33.5 96 33.5H78.8536C78.6272 33.5 78.4101 33.4101 78.25 33.25V33.25C78.0899 33.0899 77.8728 33 77.6464 33H0V15Z\"\n            fill=\"#3E3F3F\"\n          />\n        </g>\n        <path d=\"M79 33.5V14.5H78V33.5H79Z\" fill=\"black\" fill-opacity=\"0.33\" />\n      </g>\n      <defs>\n        <filter\n          id=\"filter0_i_6102_2544\"\n          x=\"95\"\n          y=\"13\"\n          width=\"19\"\n          height=\"20\"\n          filterUnits=\"userSpaceOnUse\"\n          color-interpolation-filters=\"sRGB\"\n        >\n          <feFlood flood-opacity=\"0\" result=\"BackgroundImageFix\" />\n          <feBlend mode=\"normal\" in=\"SourceGraphic\" in2=\"BackgroundImageFix\" result=\"shape\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"2\" dy=\"-2\" />\n          <feGaussianBlur stdDeviation=\"2\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.33 0\" />\n          <feBlend mode=\"normal\" in2=\"shape\" result=\"effect1_innerShadow_6102_2544\" />\n        </filter>\n        <filter\n          id=\"filter1_iiii_6102_2544\"\n          x=\"0\"\n          y=\"9.5\"\n          width=\"101\"\n          height=\"29\"\n          filterUnits=\"userSpaceOnUse\"\n          color-interpolation-filters=\"sRGB\"\n        >\n          <feFlood flood-opacity=\"0\" result=\"BackgroundImageFix\" />\n          <feBlend mode=\"normal\" in=\"SourceGraphic\" in2=\"BackgroundImageFix\" result=\"shape\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"1\" dy=\"5\" />\n          <feGaussianBlur stdDeviation=\"3\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.137255 0 0 0 0 0.145098 0 0 0 0 0.14902 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"shape\" result=\"effect1_innerShadow_6102_2544\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"3\" dy=\"-5\" />\n          <feGaussianBlur stdDeviation=\"3\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.137255 0 0 0 0 0.145098 0 0 0 0 0.14902 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"effect1_innerShadow_6102_2544\" result=\"effect2_innerShadow_6102_2544\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"1\" dy=\"-1\" />\n          <feGaussianBlur stdDeviation=\"0.5\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.242217 0 0 0 0 0.247242 0 0 0 0 0.247101 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"effect2_innerShadow_6102_2544\" result=\"effect3_innerShadow_6102_2544\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"1\" dy=\"1\" />\n          <feGaussianBlur stdDeviation=\"0.5\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.242217 0 0 0 0 0.247242 0 0 0 0 0.247101 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"effect3_innerShadow_6102_2544\" result=\"effect4_innerShadow_6102_2544\" />\n        </filter>\n        <clipPath id=\"clip0_6102_2544\">\n          <rect width=\"20\" height=\"120\" fill=\"white\" transform=\"matrix(0 1 -1 0 120 14)\" />\n        </clipPath>\n      </defs>\n    </svg>\n  );\n}\n\nexport function BlurBrush() {\n  return (\n    <svg width=\"120\" height=\"48\" viewBox=\"0 0 120 48\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n      <g clip-path=\"url(#clip0_6102_2545)\">\n        <image href=\"assets/img/media-editor-blurred-color-wheel.png\" x=\"91\" y=\"12\" width=\"26\" height=\"24\" />\n        <image href=\"assets/img/media-editor-blurred-color-wheel.png\" x=\"91\" y=\"12\" width=\"26\" height=\"24\" />\n        <g filter=\"url(#filter3_iiii_6102_2545)\">\n          <path\n            d=\"M-2 15H75.441C75.7836 15 76.0968 15.1936 76.25 15.5V15.5C76.4032 15.8064 76.7164 16 77.059 16H92.941C93.2836 16 93.5968 15.8064 93.75 15.5V15.5C93.9032 15.1936 94.2164 15 94.559 15H98C99.1046 15 100 15.8954 100 17V31C100 32.1046 99.1046 33 98 33H94.559C94.2164 33 93.9032 32.8064 93.75 32.5V32.5C93.5968 32.1936 93.2836 32 92.941 32H77.059C76.7164 32 76.4032 32.1936 76.25 32.5V32.5C76.0968 32.8064 75.7836 33 75.441 33H-2V15Z\"\n            fill=\"#3E3F3F\"\n          />\n        </g>\n        <mask\n          id=\"mask0_6102_2545\"\n          style=\"mask-type:alpha\"\n          maskUnits=\"userSpaceOnUse\"\n          x=\"0\"\n          y=\"15\"\n          width=\"100\"\n          height=\"18\"\n        >\n          <path\n            d=\"M0 15H75.441C75.7836 15 76.0968 15.1936 76.25 15.5V15.5C76.4032 15.8064 76.7164 16 77.059 16H92.941C93.2836 16 93.5968 15.8064 93.75 15.5V15.5C93.9032 15.1936 94.2164 15 94.559 15H98C99.1046 15 100 15.8954 100 17V31C100 32.1046 99.1046 33 98 33H94.559C94.2164 33 93.9032 32.8064 93.75 32.5V32.5C93.5968 32.1936 93.2836 32 92.941 32H77.059C76.7164 32 76.4032 32.1936 76.25 32.5V32.5C76.0968 32.8064 75.7836 33 75.441 33H0V15Z\"\n            fill=\"#3E3F3F\"\n          />\n        </mask>\n        <image\n          opacity=\"1\"\n          href=\"assets/img/media-editor-blurred-color-wheel.png\"\n          x=\"91\"\n          y=\"12\"\n          width=\"26\"\n          height=\"24\"\n        />\n      </g>\n      <defs>\n        <filter\n          id=\"filter3_iiii_6102_2545\"\n          x=\"-2\"\n          y=\"10\"\n          width=\"105\"\n          height=\"28\"\n          filterUnits=\"userSpaceOnUse\"\n          color-interpolation-filters=\"sRGB\"\n        >\n          <feFlood flood-opacity=\"0\" result=\"BackgroundImageFix\" />\n          <feBlend mode=\"normal\" in=\"SourceGraphic\" in2=\"BackgroundImageFix\" result=\"shape\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"1\" dy=\"5\" />\n          <feGaussianBlur stdDeviation=\"3\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.137255 0 0 0 0 0.145098 0 0 0 0 0.14902 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"shape\" result=\"effect1_innerShadow_6102_2545\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"3\" dy=\"-5\" />\n          <feGaussianBlur stdDeviation=\"3\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.137255 0 0 0 0 0.145098 0 0 0 0 0.14902 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"effect1_innerShadow_6102_2545\" result=\"effect2_innerShadow_6102_2545\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"1\" dy=\"-1\" />\n          <feGaussianBlur stdDeviation=\"0.5\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.242217 0 0 0 0 0.247242 0 0 0 0 0.247101 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"effect2_innerShadow_6102_2545\" result=\"effect3_innerShadow_6102_2545\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"1\" dy=\"1\" />\n          <feGaussianBlur stdDeviation=\"0.5\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.242217 0 0 0 0 0.247242 0 0 0 0 0.247101 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"effect3_innerShadow_6102_2545\" result=\"effect4_innerShadow_6102_2545\" />\n        </filter>\n        <clipPath id=\"clip0_6102_2545\">\n          <rect width=\"120\" height=\"48\" fill=\"white\" />\n        </clipPath>\n      </defs>\n    </svg>\n  );\n}\n","import {createEffect, createMemo, createSignal, on, onCleanup, onMount} from 'solid-js';\n\nimport {doubleRaf} from '../../helpers/schedulers';\nimport {hexToRgb} from '../../helpers/color';\nimport _ColorPicker from '../colorPicker';\nimport ripple from '../ripple';\n\nimport {useMediaEditorContext} from './context';\nimport {delay} from './utils';\n\n\nexport const colorPickerSwatches = [\n  '#ffffff',\n  '#fe4438',\n  '#ff8901',\n  '#ffd60a',\n  '#33c759',\n  '#62e5e0',\n  '#0a84ff',\n  '#bd5cf3'\n];\n\nconst PICKER_WIDTH_PX = 200;\nconst PICKER_HEIGHT_PX = 120;\nconst SLIDER_WIDTH_PX = 304;\nconst DEFAULT_SIZE_PX = 384;\n\n\nexport default function ColorPicker(props: {\n  value: string;\n  onChange: (value: string) => void;\n  colorKey?: string; // Just for reaction, not used to access anything\n  previousColor?: string;\n}) {\n  const {actions} = useMediaEditorContext();\n\n  const [collapsed, setCollapsed] = createSignal(colorPickerSwatches.includes(props.value));\n  const [collapsing, setCollapsing] = createSignal(false);\n\n  const [containerSize, setContainerSize] = createSignal(DEFAULT_SIZE_PX);\n\n  let sizeContainer: HTMLDivElement;\n\n  const swatch = (hexColor: string, i: number) => (\n    <div\n      class=\"media-editor__color-picker-swatch\"\n      classList={{'media-editor__color-picker-swatch--active': props.value === hexColor && collapsed()}}\n      style={{\n        '--color-rgb': hexToRgb(hexColor).join(' '),\n        '--i': i\n      }}\n      onClick={() => props.onChange(hexColor)}\n    >\n      <div class=\"media-editor__color-picker-swatch-color\" />\n    </div>\n  );\n\n  const onCollapseToggle = async() => {\n    setCollapsed((prev) => !prev);\n    if(collapsed()) {\n      setCollapsing(true);\n      props.onChange(props.previousColor || colorPickerSwatches[0]);\n      await delay(200);\n      setCollapsing(false);\n    }\n  };\n\n  // let colorPicker: _ColorPicker;\n\n  const colorPicker = createMemo(\n    on(containerSize, () => {\n      const colorPicker = new _ColorPicker({\n        buildLayout: (parts) => {\n          return (\n            <div\n              class=\"media-editor__color-picker\"\n              classList={{'media-editor__color-picker--collapsed': collapsed()}}\n              style={{'--picker-height': PICKER_HEIGHT_PX + 'px'}}\n            >\n              <div class=\"media-editor__color-picker-swatches\">\n                {colorPickerSwatches.map(swatch)}\n                <div\n                  class=\"media-editor__color-picker-swatch media-editor__color-picker-swatch--gradient\"\n                  classList={{'media-editor__color-picker-swatch--active': !collapsed()}}\n                  onClick={onCollapseToggle}\n                >\n                  <div class=\"media-editor__color-picker-swatch-color\" />\n                </div>\n\n                <div class=\"media-editor__color-picker-slider\">{parts.slider}</div>\n              </div>\n\n              <div class=\"media-editor__color-picker-layout-wrapper\">\n                <div class=\"media-editor__color-picker-layout\">\n                  <div class=\"media-editor__color-picker-box\">{parts.pickerBox}</div>\n                  <div class=\"media-editor__color-picker-inputs\">\n                    {parts.hexInput}\n                    {parts.rgbInput}\n                  </div>\n                </div>\n              </div>\n            </div>\n          ) as HTMLDivElement;\n        },\n        pickerBoxWidth: PICKER_WIDTH_PX + containerSize() - DEFAULT_SIZE_PX,\n        pickerBoxHeight: PICKER_HEIGHT_PX,\n        sliderWidth: SLIDER_WIDTH_PX + containerSize() - DEFAULT_SIZE_PX,\n        thickSlider: true\n      });\n      colorPicker.onChange = (color) => {\n        if(color.hex !== props.value) props.onChange(color.hex);\n        actions.abortDrawerSlide();\n      };\n      colorPicker.container.querySelectorAll('.media-editor__color-picker-swatch').forEach((element) => {\n        ripple(element as HTMLElement);\n      });\n\n      return colorPicker;\n    })\n  );\n\n  onMount(() => {\n    setContainerSize(sizeContainer.clientWidth);\n\n    const observer = new ResizeObserver(() => {\n      setContainerSize(sizeContainer.clientWidth);\n    });\n\n    observer.observe(sizeContainer);\n\n    onCleanup(() => {\n      observer.disconnect();\n    });\n  });\n\n  createEffect(\n    on(\n      () => props.colorKey,\n      async() => {\n        await delay(0);\n        const newCollapsed = colorPickerSwatches.includes(props.value);\n        if(newCollapsed !== collapsed()) {\n          setCollapsed(newCollapsed);\n          if(newCollapsed) {\n            setCollapsing(true);\n            delay(200).then(() => setCollapsing(false));\n          }\n        }\n      }\n    )\n  );\n\n  createEffect(\n    on(\n      () => [collapsing(), colorPicker(), props.value],\n      async() => {\n        await doubleRaf();\n        if(!collapsing() && props.value !== colorPicker().getCurrentColor().hex) {\n          colorPicker().setColor(props.value);\n        }\n      }\n    )\n  );\n\n  return <div ref={sizeContainer}>{colorPicker().container}</div>;\n}\n","import {createSignal} from 'solid-js';\n\nimport {colorPickerSwatches} from './colorPicker';\n\nexport function createStoredColor(key: string, defaultColor: string) {\n  // (1 - use swatch, 2 - use picker color), (color from swatch), (color from picker)\n  type SavedColor = [1 | 2, string, string];\n\n  const [savedColor, setSavedColor] = createSignal<SavedColor>(\n    (() => {\n      const fallback = () => {\n        const value = [colorPickerSwatches.includes(defaultColor) ? 1 : 2, defaultColor, defaultColor] as SavedColor;\n        localStorage.setItem(key, JSON.stringify(value));\n        return value;\n      };\n      try {\n        const value: SavedColor = JSON.parse(localStorage.getItem(key));\n        if(\n          !(value instanceof Array) ||\n          typeof value[0] !== 'number' ||\n          typeof value[1] !== 'string' ||\n          typeof value[2] !== 'string'\n        ) {\n          return fallback();\n        }\n        return value;\n      } catch{}\n      return fallback();\n    })()\n  );\n\n  function setColor(color: string) {\n    let value: SavedColor;\n    if(colorPickerSwatches.includes(color)) {\n      value = [1, color, color];\n    } else {\n      value = [2, savedColor()[1], color];\n    }\n    setSavedColor(value);\n    localStorage.setItem(key, JSON.stringify(value));\n  }\n\n  return [\n    () => ({\n      value: savedColor()[savedColor()[0]],\n      previous: savedColor()[1]\n    }),\n    setColor\n  ] as const;\n}\n","import {JSX, onMount} from 'solid-js';\n\nimport ripple from '../ripple';\n\nexport type MediaEditorLargeButtonProps = JSX.HTMLAttributes<HTMLDivElement> & {\n  active?: boolean;\n};\n\nexport default function LargeButton(props: MediaEditorLargeButtonProps) {\n  let element: HTMLDivElement;\n\n  onMount(() => {\n    ripple(element);\n  });\n\n  return (\n    <div\n      {...props}\n      ref={element}\n      class=\"media-editor__large-button\"\n      classList={{\n        'media-editor__large-button--active': props.active,\n        [props.class]: !!props.class\n      }}\n    />\n  );\n}\n","import {createEffect, JSX} from 'solid-js';\n\nimport {i18n} from '../../../lib/langPack';\n\nimport Space from '../../space';\n\nimport {ArrowBrush, BlurBrush, EraserBrush, MarkerBrush, NeonBrush, PenBrush} from '../brushesSvg';\nimport {createStoredColor} from '../createStoredColor';\nimport {useMediaEditorContext} from '../context';\nimport ColorPicker from '../colorPicker';\nimport LargeButton from '../largeButton';\nimport RangeInput from '../rangeInput';\n\nexport default function BrushTab() {\n  const {editorState, mediaType} = useMediaEditorContext();\n\n  const savedBrushColors = {\n    pen: createStoredColor('media-editor-pen-color', '#fe4438'),\n    arrow: createStoredColor('media-editor-arrow-color', '#ffd60a'),\n    brush: createStoredColor('media-editor-brush-color', '#ff8901'),\n    neon: createStoredColor('media-editor-neon-color', '#62e5e0')\n  };\n\n  function savedBrushSignal(brush: string) {\n    return savedBrushColors[brush as keyof typeof savedBrushColors];\n  }\n\n  function updateCurrentBrush() {\n    const [savedColor] = savedBrushSignal(editorState.currentBrush.brush) || [];\n    if(!savedColor || editorState.currentBrush.color === savedColor().value) return;\n\n    editorState.currentBrush.color = savedColor().value;\n  }\n\n  updateCurrentBrush(); // Change the brush before the ColorPicker is rendered\n  createEffect(() => {\n    updateCurrentBrush();\n  });\n\n  function setColor(color: string) {\n    const brush = editorState.currentBrush.brush;\n    const [, setSavedColor] = savedBrushSignal(brush) || [];\n    setSavedColor?.(color);\n  }\n\n  const brushButton = (text: JSX.Element, brushSvg: JSX.Element, brush: string) => (\n    <LargeButton\n      active={editorState.currentBrush.brush === brush}\n      onClick={() => void (editorState.currentBrush.brush = brush)}\n      class={`media-editor__brush-button`}\n    >\n      <div\n        class=\"media-editor__brush-button-svg-wrapper\"\n        style={{\n          color: savedBrushSignal(brush)?.[0]().value\n        }}\n      >\n        {brushSvg}\n      </div>\n      {text}\n    </LargeButton>\n  );\n\n  const hasColor = () => editorState.currentBrush.brush in savedBrushColors;\n\n  let timeoutId = 0;\n  function removeSizePreview() {\n    window.clearTimeout(timeoutId);\n    timeoutId = window.setTimeout(() => {\n      editorState.previewBrushSize = undefined;\n    }, 1000);\n  }\n\n  return (\n    <>\n      <div\n        style={{\n          transition: 'opacity .2s',\n          ...(!hasColor() ?\n            {\n              'opacity': 0.25,\n              'pointer-events': 'none'\n            } :\n            undefined\n          )\n        }\n        }\n      >\n        <ColorPicker\n          value={editorState.currentBrush.color}\n          onChange={setColor}\n          colorKey={editorState.currentBrush.brush}\n          previousColor={savedBrushSignal(editorState.currentBrush.brush)?.[0]().previous}\n        />\n      </div>\n      <Space amount=\"16px\" />\n      <RangeInput\n        label={i18n('MediaEditor.Size')}\n        min={2}\n        max={32}\n        value={editorState.currentBrush.size}\n        onChange={(size) => {\n          editorState.currentBrush.size = size;\n          editorState.previewBrushSize = size;\n          removeSizePreview();\n        }}\n        onChangeFinish={() => {\n          editorState.previewBrushSize = undefined;\n        }}\n        passiveLabel\n        color={hasColor() ? editorState.currentBrush.color : undefined}\n      />\n      <Space amount=\"16px\" />\n      <div class=\"media-editor__label\">{i18n('MediaEditor.Tool')}</div>\n      {brushButton(i18n('MediaEditor.Brushes.Pen'), <PenBrush />, 'pen')}\n      {brushButton(i18n('MediaEditor.Brushes.Arrow'), <ArrowBrush />, 'arrow')}\n      {brushButton(i18n('MediaEditor.Brushes.Brush'), <MarkerBrush />, 'brush')}\n      {brushButton(i18n('MediaEditor.Brushes.Neon'), <NeonBrush />, 'neon')}\n      {mediaType === 'image' && brushButton(i18n('MediaEditor.Brushes.Blur'), <BlurBrush />, 'blur')}\n      {brushButton(i18n('MediaEditor.Brushes.Eraser'), <EraserBrush />, 'eraser')}\n    </>\n  );\n}\n","import {JSX, splitProps} from 'solid-js';\n\nimport {i18n} from '../../../lib/langPack';\nimport {IconTsx} from '../../iconTsx';\n\nimport {animateToNewRotationOrRatio} from '../canvas/animateToNewRotationOrRatio';\nimport LargeButton, {MediaEditorLargeButtonProps} from '../largeButton';\nimport {useMediaEditorContext} from '../context';\nimport {withCurrentOwner} from '../utils';\n\nconst ratioRects = {\n  '1x1': () => <rect x=\"4\" y=\"4\" width=\"16\" height=\"16\" rx=\"2\" stroke=\"white\" stroke-width=\"1.66\" />,\n  '3x2': () => <rect x=\"3\" y=\"6\" width=\"18\" height=\"12\" rx=\"2\" stroke=\"white\" stroke-width=\"1.66\" />,\n  '4x3': () => <rect x=\"3\" y=\"5\" width=\"18\" height=\"14\" rx=\"2\" stroke=\"white\" stroke-width=\"1.66\" />,\n  '5x4': () => <rect x=\"3\" y=\"4.5\" width=\"18\" height=\"15\" rx=\"2\" stroke=\"white\" stroke-width=\"1.66\" />,\n  '7x5': () => <rect x=\"3\" y=\"4\" width=\"18\" height=\"16\" rx=\"2\" stroke=\"white\" stroke-width=\"1.66\" />,\n  '16x9': () => <rect x=\"2.5\" y=\"6.5\" width=\"19\" height=\"11\" rx=\"2\" stroke=\"white\" stroke-width=\"1.66\" />\n};\n\nconst ratioIcon = (ratio: keyof typeof ratioRects, rotated?: boolean) => (\n  <svg\n    classList={{'media-editor__crop-item-icon--rotated': rotated}}\n    width=\"24\"\n    height=\"24\"\n    viewBox=\"0 0 24 24\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    {ratioRects[ratio]()}\n  </svg>\n);\n\nfunction Item(\n  inProps: MediaEditorLargeButtonProps & {\n    icon: JSX.Element;\n    text: JSX.Element;\n  }\n) {\n  const [props, buttonProps] = splitProps(inProps, ['icon', 'text']);\n\n  return (\n    <LargeButton {...buttonProps} class=\"media-editor__crop-item\">\n      {props.icon}\n      {props.text}\n    </LargeButton>\n  );\n}\n\nexport default function CropTab() {\n  const {editorState, mediaState, actions} = useMediaEditorContext();\n\n  const isActive = (what?: string) => editorState.fixedImageRatioKey === what;\n\n  const onRatioClick = withCurrentOwner((ratio?: string) => {\n    editorState.fixedImageRatioKey = ratio;\n    animateToNewRotationOrRatio(mediaState.rotation);\n    actions.resetRotationWheel();\n  });\n\n  return (\n    <>\n      <div class=\"media-editor__label\">{i18n('MediaEditor.AspectRatio')}</div>\n\n      <Item\n        icon={<IconTsx icon=\"free_transform\" />}\n        text={i18n('MediaEditor.Free')}\n        active={isActive()}\n        onClick={() => onRatioClick()}\n      />\n      <Item\n        icon={<IconTsx icon=\"image_original\" />}\n        text={i18n('MediaEditor.Original')}\n        active={isActive('original')}\n        onClick={() => onRatioClick('original')}\n      />\n      <Item\n        icon={ratioIcon('1x1')}\n        text={i18n('MediaEditor.Square')}\n        active={isActive('1x1')}\n        onClick={() => onRatioClick('1x1')}\n      />\n\n      <div class=\"media-editor__crop-grid\">\n        <Item icon={ratioIcon('3x2')} text=\"3:2\" active={isActive('3x2')} onClick={() => onRatioClick('3x2')} />\n        <Item icon={ratioIcon('3x2', true)} text=\"2:3\" active={isActive('2x3')} onClick={() => onRatioClick('2x3')} />\n\n        <Item icon={ratioIcon('4x3')} text=\"4:3\" active={isActive('4x3')} onClick={() => onRatioClick('4x3')} />\n        <Item icon={ratioIcon('4x3', true)} text=\"3:4\" active={isActive('3x4')} onClick={() => onRatioClick('3x4')} />\n\n        <Item icon={ratioIcon('5x4')} text=\"5:4\" active={isActive('5x4')} onClick={() => onRatioClick('5x4')} />\n        <Item icon={ratioIcon('5x4', true)} text=\"4:5\" active={isActive('4x5')} onClick={() => onRatioClick('4x5')} />\n\n        <Item icon={ratioIcon('7x5')} text=\"7:5\" active={isActive('7x5')} onClick={() => onRatioClick('7x5')} />\n        <Item icon={ratioIcon('7x5', true)} text=\"5:7\" active={isActive('5x7')} onClick={() => onRatioClick('5x7')} />\n\n        <Item icon={ratioIcon('16x9')} text=\"16:9\" active={isActive('16x9')} onClick={() => onRatioClick('16x9')} />\n        <Item\n          icon={ratioIcon('16x9', true)}\n          text=\"9:16\"\n          active={isActive('9x16')}\n          onClick={() => onRatioClick('9x16')}\n        />\n      </div>\n    </>\n  );\n}\n","import {onMount, Accessor, JSX, createEffect, untrack} from 'solid-js';\n\nimport {i18n} from '../../../lib/langPack';\n\nimport ripple from '../../ripple';\nimport {IconTsx} from '../../iconTsx';\nimport Space from '../../space';\n\nimport {createStoredColor} from '../createStoredColor';\nimport {useMediaEditorContext} from '../context';\nimport ColorPicker from '../colorPicker';\nimport LargeButton from '../largeButton';\nimport RangeInput from '../rangeInput';\nimport {fontInfoMap} from '../utils';\nimport {FontKey} from '../types';\n\nexport default function TextTab() {\n  const {editorState} = useMediaEditorContext();\n\n  const [savedColor, setSavedColor] = createStoredColor('media-editor-text-color', '#ffffff');\n\n  editorState.currentTextLayerInfo.color = savedColor().value;\n  createEffect(() => {\n    untrack(() => editorState.currentTextLayerInfo).color = savedColor().value;\n  });\n\n\n  function setSize(value: number) {\n    editorState.currentTextLayerInfo.size = value;\n  }\n  function setAlignment(value: string) {\n    editorState.currentTextLayerInfo.alignment = value;\n  }\n  function setStyle(value: string) {\n    editorState.currentTextLayerInfo.style = value;\n  }\n\n  const toggleButton = (\n    icon: Icon,\n    value: string,\n    currentValue: Accessor<string>,\n    setValue: (value: string) => void\n  ) => (\n    <div\n      class=\"media-editor__toggle-button\"\n      classList={{'media-editor__toggle-button--active': value === currentValue()}}\n      onClick={() => setValue(value)}\n    >\n      <IconTsx icon={icon} />\n    </div>\n  );\n\n  onMount(() => {\n    document.querySelectorAll('.media-editor__toggle-button').forEach((element) => {\n      ripple(element as HTMLElement);\n    });\n  });\n\n  const fontButton = (text: JSX.Element, textFont: FontKey) => (\n    <LargeButton\n      active={editorState.currentTextLayerInfo.font === textFont}\n      onClick={() => void (editorState.currentTextLayerInfo.font = textFont)}\n      style={{\n        'font-family': fontInfoMap[textFont].fontFamily,\n        'font-weight': fontInfoMap[textFont].fontWeight\n      }}\n    >\n      {text}\n    </LargeButton>\n  );\n\n  return (\n    <>\n      <ColorPicker\n        value={editorState.currentTextLayerInfo.color}\n        onChange={setSavedColor}\n        previousColor={savedColor().previous}\n        colorKey={(editorState.selectedResizableLayer ?? '') + ''}\n      />\n\n      <div class=\"media-editor__toggle-group-row\">\n        <div class=\"media-editor__toggle-group\">\n          {toggleButton('align_left', 'left', () => editorState.currentTextLayerInfo.alignment, setAlignment)}\n          {toggleButton('align_center', 'center', () => editorState.currentTextLayerInfo.alignment, setAlignment)}\n          {toggleButton('align_right', 'right', () => editorState.currentTextLayerInfo.alignment, setAlignment)}\n        </div>\n\n        <div class=\"media-editor__toggle-group\">\n          {toggleButton('fontframe', 'normal', () => editorState.currentTextLayerInfo.style, setStyle)}\n          {toggleButton('fontframe_outline', 'outline', () => editorState.currentTextLayerInfo.style, setStyle)}\n          {toggleButton('fontframe_bg', 'background', () => editorState.currentTextLayerInfo.style, setStyle)}\n        </div>\n      </div>\n\n      <RangeInput\n        label={i18n('MediaEditor.Size')}\n        min={16}\n        max={64}\n        value={editorState.currentTextLayerInfo.size}\n        onChange={setSize}\n        passiveLabel\n        color={editorState.currentTextLayerInfo.color}\n      />\n\n      <Space amount=\"16px\" />\n\n      <div class=\"media-editor__label\">{i18n('MediaEditor.Font')}</div>\n\n      {fontButton(i18n('MediaEditor.Fonts.Roboto'), 'roboto')}\n      {fontButton(i18n('MediaEditor.Fonts.SuezOne'), 'suez')}\n      {fontButton(i18n('MediaEditor.Fonts.FugazOne'), 'fugaz')}\n      {fontButton(i18n('MediaEditor.Fonts.CourierPrime'), 'courier')}\n      {fontButton(i18n('MediaEditor.Fonts.Chewy'), 'chewy')}\n      {fontButton(i18n('MediaEditor.Fonts.Sedan'), 'sedan')}\n      {fontButton(i18n('MediaEditor.Fonts.RubikBubbles'), 'bubbles')}\n      {fontButton(i18n('MediaEditor.Fonts.Playwrite'), 'playwrite')}\n    </>\n  );\n}\n","import {batch, onCleanup, onMount} from 'solid-js';\n\nimport {addShortcutListener} from '../../helpers/shortcutListener';\nimport {i18n} from '../../lib/langPack';\nimport {ButtonIconTsx} from '../buttonIconTsx';\nimport ripple from '../ripple';\n\nimport {HistoryItem, useMediaEditorContext} from './context';\nimport {processHistoryItem} from './utils';\n\nexport default function Topbar(props: {onClose: () => void; onFinish: () => void}) {\n  const {hasModifications, mediaState, editorState} = useMediaEditorContext();\n\n  let doneButton: HTMLDivElement;\n\n\n  function processHistory(history: HistoryItem[], otherHistory: HistoryItem[]) {\n    batch(() => {\n      const item = history.pop();\n      if(!item) return;\n\n      otherHistory.push({\n        ...item,\n        path: item.path,\n        newValue: item.oldValue,\n        oldValue: item.newValue\n      });\n\n      processHistoryItem(item, mediaState);\n\n      editorState.selectedResizableLayer = undefined;\n    });\n  }\n\n  function onUndo() {\n    processHistory(mediaState.history, mediaState.redoHistory);\n  }\n\n  function onRedo() {\n    processHistory(mediaState.redoHistory, mediaState.history);\n  }\n\n  onMount(() => {\n    ripple(doneButton);\n\n    const removeListener = addShortcutListener(['Ctrl+KeyZ', 'Ctrl+Shift+KeyZ', 'Ctrl+KeyY'], (combo) => {\n      if(combo === 'Ctrl+KeyZ') {\n        onUndo();\n      } else {\n        onRedo();\n      }\n    });\n\n    onCleanup(() => removeListener());\n  });\n\n  return (\n    <div class=\"media-editor__topbar\">\n      <ButtonIconTsx icon=\"cross\" onClick={props.onClose} />\n      <div class=\"media-editor__topbar-title\">{i18n('Edit')}</div>\n      <div class=\"media-editor__topbar-history-controls\">\n        <ButtonIconTsx disabled={!mediaState.history.length} onClick={onUndo} icon=\"undo\" />\n        <ButtonIconTsx disabled={!mediaState.redoHistory.length} onClick={onRedo} icon=\"redo\" />\n      </div>\n      <div\n        ref={doneButton}\n        class=\"media-editor__topbar-done\"\n        classList={{\n          'media-editor__topbar-done--disabled': !hasModifications()\n        }}\n        onClick={() => {\n          if(hasModifications()) props.onFinish();\n        }}\n      >\n        {i18n('Done')}\n      </div>\n    </div>\n  );\n}\n","import {batch, createEffect, createMemo, createSignal, JSX, on, onCleanup, onMount} from 'solid-js';\n\nimport {doubleRaf} from '../../helpers/schedulers';\n\nimport AdjustmentsTab from './tabs/adjustmentsTab';\nimport {animateValue, delay, lerp} from './utils';\nimport {useMediaEditorContext} from './context';\nimport StickersTab from './tabs/stickersTab';\nimport TabContent from './tabs/tabContent';\nimport useIsMobile from './useIsMobile';\nimport BrushTab from './tabs/brushTab';\nimport CropTab from './tabs/cropTab';\nimport TextTab from './tabs/textTab';\nimport Tabs from './tabs/tabs';\nimport Topbar from './topbar';\n\n\nexport default function Toolbar(props: {onFinish: () => void; onClose: () => void}) {\n  let toolbar: HTMLDivElement;\n\n  const {editorState, actions} = useMediaEditorContext();\n\n  const [move, setMove] = createSignal(0);\n  const [isCollapsed, setIsCollapsed] = createSignal(false);\n  const [container, setContainer] = createSignal<HTMLDivElement>();\n  const [containerHeight, setContainerHeight] = createSignal(0);\n  const [extraMove, setExtraMove] = createSignal(0);\n\n  const isMobile = useIsMobile();\n\n  const [shouldHide, setShouldHide] = createSignal(isMobile());\n\n  let startY = 0;\n  let isAborted = true;\n  let isResetting = false;\n  let canMove = false;\n\n  function resetMove() {\n    if(isResetting) return;\n    isResetting = true;\n\n    startY = 0;\n    isAborted = true;\n    animateValue(move(), 0, 200, setMove);\n    setTimeout(() => {\n      isResetting = false;\n    }, 200);\n  }\n  actions.abortDrawerSlide = () => resetMove();\n\n  onMount(() => {\n    function startDrag(y: number) {\n      if(!isMobile()) return;\n      startY = y;\n      isAborted = false;\n      canMove = false;\n      setTimeout(() => {\n        canMove = true;\n      }, 100); // wait for scroll to trigger first\n    }\n    function dragMove(y: number) {\n      if(!isMobile()) return;\n      if(isAborted) return;\n      if(!canMove) return;\n      const diff = y - startY;\n      if(isCollapsed()) setMove(Math.min(Math.max(-containerHeight(), diff), 0));\n      else setMove(Math.max(Math.min(containerHeight(), diff), 0));\n    }\n    function dragEnd() {\n      if(!isMobile()) return;\n      if(isAborted) return;\n      isAborted = true;\n      if(Math.abs(move()) > 100) {\n        setIsCollapsed((prev) => !prev);\n      } else {\n        resetMove();\n      }\n    }\n\n    container().addEventListener('input', () => {\n      resetMove();\n    });\n\n    toolbar.addEventListener('touchstart', (e) => {\n      startDrag(e.touches[0].clientY);\n    });\n    toolbar.addEventListener('touchmove', (e) => {\n      dragMove(e.touches[0].clientY);\n    });\n    toolbar.addEventListener('touchend', (e) => {\n      dragEnd();\n    });\n    toolbar.addEventListener('mousedown', (e) => {\n      startDrag(e.clientY);\n    });\n    toolbar.addEventListener('mousemove', (e) => {\n      dragMove(e.clientY);\n    });\n    toolbar.addEventListener('mouseup', (e) => {\n      dragEnd();\n    });\n    toolbar.addEventListener('mouseout', (e) => {\n      dragEnd();\n    });\n  });\n\n  createEffect(() => {\n    const observer = new ResizeObserver(() => {\n      setContainerHeight(container()?.clientHeight || 0);\n    });\n    observer.observe(container());\n    onCleanup(() => observer.disconnect());\n  });\n\n  createEffect(\n    on(isCollapsed, () => {\n      const initialMove = move();\n      const initialExtraMove = extraMove();\n      const targetExtraMove = isCollapsed() ? containerHeight() : 0;\n      animateValue(0, 1, 200, (progress) => {\n        batch(() => {\n          setMove(lerp(initialMove, 0, progress));\n          setExtraMove(lerp(initialExtraMove, targetExtraMove, progress));\n        });\n      });\n    })\n  );\n\n  createEffect(() => {\n    if(editorState.currentTab !== 'crop') setIsCollapsed(false);\n  });\n\n  createEffect(() => {\n    if(editorState.renderingPayload && shouldHide()) {\n      (async() => {\n        toolbar.style.transition = '.2s';\n        await doubleRaf();\n        setShouldHide(false);\n        await delay(200);\n        toolbar.style.removeProperty('transition');\n      })();\n    }\n  });\n\n  const totalMove = () => extraMove() + move();\n\n  const style = createMemo((): JSX.CSSProperties => {\n    if(isMobile()) return {\n      'opacity': editorState.isAdjusting ? 0 : 1,\n      'transform': shouldHide() ?\n        'translate(-50%, 100%)' :\n        `translate(-50%, ${totalMove()}px)`\n    };\n  });\n\n  return (\n    <div\n      ref={toolbar}\n      class=\"media-editor__toolbar\"\n      style={style()}\n    >\n      <div class=\"media-editor__toolbar-draggable\" />\n      <Topbar onClose={() => props.onClose()} onFinish={props.onFinish} />\n      <Tabs />\n      <TabContent\n        onContainer={setContainer}\n        onScroll={() => {\n          resetMove();\n        }}\n        tabs={{\n          adjustments: () => <AdjustmentsTab />,\n          crop: () => <CropTab />,\n          text: () => <TextTab />,\n          brush: () => <BrushTab />,\n          stickers: () => <StickersTab />\n        }}\n      />\n    </div>\n  );\n}\n","import {createEffect, onCleanup, onMount} from 'solid-js';\nimport {render} from 'solid-js/web';\n\nimport {doubleRaf} from '../../helpers/schedulers';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport {i18n} from '../../lib/langPack';\nimport type SolidJSHotReloadGuardProvider from '../../lib/solidjs/hotReloadGuardProvider';\n\nimport appNavigationController, {NavigationItem} from '../appNavigationController';\nimport confirmationPopup from '../confirmationPopup';\n\nimport MainCanvas from './canvas/mainCanvas';\nimport MediaEditorContext, {createContextValue, EditingMediaState} from './context';\nimport {createFinalResult, MediaEditorFinalResult} from './finalRender/createFinalResult';\nimport FinishButton from './finishButton';\nimport Toolbar from './toolbar';\nimport {MediaType, NumberPair} from './types';\nimport {delay, withCurrentOwner} from './utils';\n\nimport './mediaEditor.scss';\n\n\nexport type MediaEditorProps = {\n  onClose: (hasGif: boolean) => void;\n  managers: AppManagers;\n  onEditFinish: (result: MediaEditorFinalResult) => void;\n  onCanvasReady: (canvas: HTMLCanvasElement) => Promise<void>;\n  onImageRendered: () => void;\n  mediaSrc: string;\n  mediaType: MediaType;\n  mediaBlob: Blob;\n  mediaSize: NumberPair;\n  editingMediaState?: EditingMediaState\n};\n\nexport function MediaEditor(props: MediaEditorProps) {\n  const contextValue = createContextValue(props);\n\n  const {editorState, hasModifications} = contextValue;\n\n  let overlay: HTMLDivElement;\n\n  onMount(() => {\n    (async() => {\n      overlay.classList.add('media-editor__overlay--hidden');\n      await doubleRaf();\n      overlay.classList.remove('media-editor__overlay--hidden');\n    })();\n\n    const navigationItem: NavigationItem = {\n      type: 'popup',\n      onPop: () => handleClose()\n    };\n    appNavigationController.pushItem(navigationItem);\n\n    overlay.focus();\n\n    onCleanup(() => {\n      appNavigationController.removeItem(navigationItem);\n    });\n  });\n\n  createEffect(() => {\n    if(!editorState.imageCanvas) return;\n\n    (async() =>{\n      await props.onCanvasReady(editorState.imageCanvas);\n      editorState.isReady = true;\n    })();\n  });\n\n  createEffect(() => {\n    if(!editorState.renderingPayload) return;\n    props.onImageRendered();\n  });\n\n  async function performClose(hasGif = false) {\n    overlay.classList.add('media-editor__overlay--hidden');\n    await delay(200);\n    props.onClose(hasGif);\n  }\n\n  function handleClose(finished = false, hasGif = false) {\n    if(finished || !hasModifications()) {\n      performClose(hasGif);\n      return;\n    }\n\n    confirmationPopup({\n      title: i18n('MediaEditor.DiscardChanges'),\n      description: i18n('MediaEditor.DiscardWarning'),\n      button: {\n        text: i18n('Discard')\n      }\n    }).then(() => performClose(), () => {});\n\n    return false;\n  }\n\n  let isFinishing = false;\n\n  return (\n    <MediaEditorContext.Provider value={contextValue}>\n      <div ref={overlay} class=\"media-editor__overlay night\">\n        <div class=\"media-editor__container\">\n          {(() => {\n            // Need to be inside context\n            const handleFinish = withCurrentOwner(async() => {\n              if(isFinishing) return;\n              isFinishing = true;\n\n              const result = await createFinalResult()\n              .finally(() => { isFinishing = false; });\n\n              props.onEditFinish(result);\n              handleClose(true, result.isVideo);\n            });\n\n            return (\n              <>\n                <MainCanvas />\n                <Toolbar onClose={handleClose} onFinish={handleFinish} />\n                <FinishButton onClick={handleFinish} />\n              </>\n            );\n          })()}\n        </div>\n      </div>\n    </MediaEditorContext.Provider>\n  );\n}\n\nexport function openMediaEditor(props: MediaEditorProps, HotReloadGuardProvider: typeof SolidJSHotReloadGuardProvider) {\n  const element = document.createElement('div');\n  document.body.append(element);\n\n  const dispose = render(() => (\n    <HotReloadGuardProvider>\n      <MediaEditor {...props} onClose={onClose} />\n    </HotReloadGuardProvider>\n  ), element);\n\n  function onClose(hasGif: boolean) {\n    props.onClose(hasGif);\n    dispose();\n    element.remove();\n  }\n}\n","import deferredPromise from '../../helpers/cancellablePromise';\nimport {doubleRaf} from '../../helpers/schedulers';\nimport type {AppManagers} from '../../lib/appManagers/managers';\nimport SolidJSHotReloadGuardProvider from '../../lib/solidjs/hotReloadGuardProvider';\nimport {EditingMediaState} from './context';\nimport {MediaEditorFinalResult} from './finalRender/createFinalResult';\nimport {openMediaEditor} from './mediaEditor';\nimport {MediaType, NumberPair} from './types';\nimport {animateValue, delay, lerp, snapToViewport} from './utils';\n\n\ntype Args = {\n  source: CanvasImageSource;\n  element: HTMLElement;\n  managers: AppManagers;\n\n  mediaType: MediaType;\n  mediaSrc: string;\n  mediaBlob: Blob;\n  mediaSize: NumberPair;\n\n  size: NumberPair;\n\n  editingMediaState: EditingMediaState;\n  onEditFinish: (result: MediaEditorFinalResult) => void;\n  onClose: (hasGif: boolean) => void;\n};\n\nexport function openMediaEditorFromMedia({\n  source,\n  element,\n  managers,\n  mediaType,\n  mediaSrc,\n  mediaBlob,\n  mediaSize,\n  size,\n  editingMediaState,\n  onEditFinish,\n  onClose\n}: Args) {\n  const animatedCanvas = document.createElement('canvas');\n  const [sourceWidth, sourceHeight] = [animatedCanvas.width, animatedCanvas.height] = size;\n\n  const ctx = animatedCanvas.getContext('2d');\n  ctx.drawImage(source, 0, 0, animatedCanvas.width, animatedCanvas.height);\n\n  const bcr = element.getBoundingClientRect();\n  animatedCanvas.style.position = 'fixed';\n\n  const left = bcr.left + bcr.width / 2, top = bcr.top + bcr.height / 2, width = bcr.width, height = bcr.height;\n\n  animatedCanvas.style.left = left + 'px';\n  animatedCanvas.style.top = top + 'px';\n  animatedCanvas.style.width = width + 'px';\n  animatedCanvas.style.height = height + 'px';\n  animatedCanvas.style.transform = 'translate(-50%, -50%)';\n  animatedCanvas.style.objectFit = 'cover';\n  animatedCanvas.style.zIndex = '1000';\n\n  document.body.append(animatedCanvas);\n\n  openMediaEditor({\n    mediaType,\n    mediaSrc,\n    mediaBlob,\n    managers,\n    mediaSize,\n    onEditFinish,\n\n    onCanvasReady: (canvas) => {\n      const canvasBcr = canvas.getBoundingClientRect();\n      const leftDiff = (canvasBcr.left + canvasBcr.width / 2) - left;\n      const topDiff = (canvasBcr.top + canvasBcr.height / 2) - top;\n      const [scaledWidth, scaledHeight] = snapToViewport(sourceWidth / sourceHeight, canvasBcr.width, canvasBcr.height);\n\n      const deferred = deferredPromise<void>();\n\n      animateValue(\n        0, 1, 200,\n        (progress) => {\n          animatedCanvas.style.transform = `translate(calc(${\n            progress * leftDiff\n          }px - 50%), calc(${\n            progress * topDiff\n          }px - 50%))`;\n          animatedCanvas.style.width = lerp(width, scaledWidth, progress) + 'px';\n          animatedCanvas.style.height = lerp(height, scaledHeight, progress) + 'px';\n        },\n        {\n          onEnd: () => deferred.resolve()\n        }\n      );\n\n      return deferred;\n    },\n\n    onImageRendered: async() => {\n      animatedCanvas.style.opacity = '1';\n      animatedCanvas.style.transition = '.12s';\n      await doubleRaf();\n      animatedCanvas.style.opacity = '0';\n      await delay(120);\n      animatedCanvas.remove();\n    },\n\n    editingMediaState: editingMediaState,\n    onClose\n  }, SolidJSHotReloadGuardProvider);\n}\n"],"file":"index-Chqf7xSL.js"}