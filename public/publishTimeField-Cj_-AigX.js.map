{"version":3,"file":"publishTimeField-Cj_-AigX.js","sources":["../src/components/simpleFormField/index.tsx","../src/components/chat/suggestPostPopup/popupSchedulePost.ts","../src/components/chat/suggestPostPopup/publishTimeField.tsx"],"sourcesContent":["import {Accessor, createContext, createSignal, JSX, mergeProps, onMount, ParentProps, Setter, splitProps, useContext, createEffect, batch} from 'solid-js';\nimport styles from './styles.module.scss';\n\n\ntype SimpleFormFieldContextValue = {\n  input: Accessor<HTMLInputElement>;\n  setInput: Setter<HTMLInputElement>;\n  offsetElement: Accessor<HTMLElement>;\n  setOffsetElement: Setter<HTMLElement>;\n  value: Accessor<string>;\n  onChange: (value: string) => void;\n};\n\nconst Context = createContext<SimpleFormFieldContextValue>();\n\nconst SimpleFormField = (inProps: ParentProps<{\n  value?: string;\n  onChange?: (value: string) => void;\n\n  onClick?: JSX.EventHandler<HTMLDivElement, MouseEvent>;\n  isError?: boolean;\n  clickable?: boolean;\n  withEndButtonIcon?: boolean;\n} & Omit<JSX.HTMLAttributes<HTMLDivElement>, 'onChange' | 'onClick'>>) => {\n  const [props, restProps] = splitProps(inProps, ['value', 'onChange', 'isError', 'children', 'onClick', 'class', 'classList', 'clickable', 'withEndButtonIcon']);\n  const [input, setInput] = createSignal<HTMLInputElement>();\n  const [offsetElement, setOffsetElement] = createSignal<HTMLElement>();\n\n  const contextValue: SimpleFormFieldContextValue = {\n    input,\n    setInput,\n    offsetElement,\n    setOffsetElement,\n    value: () => props.value,\n    get onChange() {\n      return props.onChange;\n    }\n  };\n\n  return (\n    <Context.Provider value={contextValue}>\n      <div\n        class={styles.Container}\n        classList={{\n          [styles.error]: props.isError,\n          [styles.clickable]: props.clickable,\n          [props.class]: !!props.class,\n          [styles.withEndButtonIcon]: props.withEndButtonIcon,\n          ...props.classList\n        }}\n        onClick={(...args) => {\n          contextValue.input()?.focus();\n          props.onClick?.(...args);\n        }}\n        {...restProps}\n      >\n        <div class={styles.BorderThin} />\n        <div class={styles.BorderThick} />\n        {props.children}\n      </div>\n    </Context.Provider>\n  );\n};\n\nSimpleFormField.Input = (inProps: {\n  forceFieldValue?: boolean;\n} & Omit<JSX.InputHTMLAttributes<HTMLInputElement>, 'value' | 'onChange' | 'onInput' | 'ref'>) => {\n  const [props, restProps] = splitProps(inProps, ['class', 'classList', 'forceFieldValue']);\n\n  const context = useContext(Context);\n\n  return (\n    <input\n      ref={(el) => batch(() => {\n        context.setInput(el);\n        context.setOffsetElement(el);\n      })}\n      class={styles.Input}\n      classList={{\n        [props.class]: !!props.class,\n        ...props.classList\n      }}\n      value={context.value()}\n      onInput={(e) => {\n        context.onChange(e.currentTarget.value)\n        if(props.forceFieldValue) context.input().value = context.value();\n      }}\n      {...restProps}\n    />\n  );\n};\n\nSimpleFormField.InputStub = (props: ParentProps) => {\n  const context = useContext(Context);\n\n  return (\n    <div\n      ref={context.setOffsetElement}\n      class={styles.InputStub}\n    >\n      {props.children}\n    </div>\n  );\n};\n\nSimpleFormField.Label = (props: ParentProps<{\n  active?: boolean;\n  forceOffset?: number;\n}>) => {\n  const context = useContext(Context);\n\n  const [offset, setOffset] = createSignal(0);\n\n  onMount(() => {\n    if(props.forceOffset || !context.offsetElement()) return;\n    const parentElement = context.offsetElement().parentElement;\n    if(!parentElement) return;\n\n    const rect = parentElement.getBoundingClientRect();\n    const inputRect = context.offsetElement().getBoundingClientRect();\n    setOffset(inputRect.left - rect.left);\n  });\n\n  return (\n    <div\n      class={styles.Label}\n      classList={{\n        [styles.active]: props.active || !!context.value()\n      }}\n      style={{\n        '--offset': `${props.forceOffset || offset()}px`\n      }}\n    >\n      {props.children}\n    </div>\n  );\n};\n\nSimpleFormField.SideContent = (props: ParentProps<{\n  first?: boolean;\n  last?: boolean;\n}>) => {\n  return (\n    <div class={styles.SideContent} classList={{\n      [styles.first]: props.first,\n      [styles.last]: props.last\n    }}>\n      {props.children}\n    </div>\n  );\n};\n\nexport default SimpleFormField;\n","import {formatTime} from '../../../helpers/date';\nimport {i18n} from '../../../lib/langPack';\nimport PopupSchedule from '../../popups/schedule';\nimport styles from './styles.module.scss';\n\n\nconst MILLIS_IN_MINUTE = 60 * 1000;\n\ntype Args = {\n  minTimeDate: Date;\n} & ConstructorParameters<typeof PopupSchedule>[0];\n\nexport default class PopupSchedulePost extends PopupSchedule {\n  protected caption: HTMLElement;\n  protected minTimeDate: Date;\n\n  constructor(args: Args) {\n    const {minTimeDate, ...rest} = args;\n\n    super(rest);\n\n    this.minTimeDate = minTimeDate;\n\n    this.caption = document.createElement('div');\n    this.caption.classList.add(styles.Caption, styles.center);\n    this.caption.append(i18n('SuggestedPosts.PublishingTime.MinSendTime', [formatTime(minTimeDate)]));\n\n    this.timeDiv.after(this.caption);\n  }\n\n  public setTimeTitle() {\n    super.setTimeTitle();\n\n    if(!this.caption || !this.minTimeDate) return;\n\n    const sendDate = new Date(this.selectedDate.getTime());\n    sendDate.setHours(+this.hoursInputField.value, +this.minutesInputField.value);\n\n    const disabled = sendDate < new Date() || (sendDate.valueOf() / MILLIS_IN_MINUTE | 0) < (this.minTimeDate.valueOf() / MILLIS_IN_MINUTE | 0);\n\n    this.btnConfirm.toggleAttribute('disabled', disabled);\n\n    const isCaptionVisible = sendDate.getDate() === this.minTimeDate.getDate();\n    this.caption.classList.toggle('hide', !isCaptionVisible);\n  }\n}\n","import {formatFullSentTime} from '../../../helpers/date';\nimport {I18nTsx} from '../../../helpers/solid/i18n';\nimport {LangPackKey} from '../../../lib/langPack';\nimport {ButtonIconTsx} from '../../buttonIconTsx';\nimport {IconTsx} from '../../iconTsx';\nimport SimpleFormField from '../../simpleFormField';\nimport styles from './commonStyles.module.scss';\nimport PopupSchedulePost from './popupSchedulePost';\n\n\ntype Props = {\n  value: number;\n  onChange: (value: number | undefined) => void;\n  noTimeLangKey: LangPackKey;\n};\n\nconst PUBLISH_MIN_DELAY_MINUTES = 10;\n\nconst PublishTimeField = (props: Props) => {\n  const onContainerClick = () => {\n    const minTimeDate = new Date();\n    minTimeDate.setMinutes(minTimeDate.getMinutes() + PUBLISH_MIN_DELAY_MINUTES);\n\n    const minDate = new Date(minTimeDate);\n    minDate.setHours(0, 0, 0, 0);\n\n    new PopupSchedulePost({\n      initDate: new Date(minTimeDate),\n      minDate,\n      minTimeDate,\n      onPick: (timestamp) => {\n        console.log(timestamp);\n        props.onChange(timestamp);\n      }\n    }).show();\n  };\n\n  const onCrossClick = (event: MouseEvent) => {\n    event.stopPropagation();\n    props.onChange(undefined);\n  };\n\n  return (\n    <SimpleFormField\n      clickable\n      withEndButtonIcon={!!props.value}\n      onClick={onContainerClick}\n    >\n      <SimpleFormField.InputStub>\n        {props.value ?\n          <span>{formatFullSentTime(props.value)}</span> :\n          <I18nTsx key={props.noTimeLangKey} />\n        }\n      </SimpleFormField.InputStub>\n      <SimpleFormField.Label active>\n        <I18nTsx key='SuggestedPosts.PublishingTime.Label' />\n      </SimpleFormField.Label>\n      <SimpleFormField.SideContent last>\n        {props.value ?\n          <ButtonIconTsx icon='cross' tabIndex={-1} onClick={onCrossClick} /> :\n          <IconTsx class={styles.Icon} icon='down' />\n        }\n      </SimpleFormField.SideContent>\n    </SimpleFormField>\n  )\n};\n\nexport default PublishTimeField;\n"],"names":["Context","createContext","SimpleFormField","inProps","props","restProps","splitProps","input","setInput","createSignal","offsetElement","setOffsetElement","contextValue","value","onChange","_$createComponent","Provider","children","_el$","_tmpl$","_el$2","firstChild","_el$3","nextSibling","$$click","args","focus","onClick","_$spread","_$mergeProps","styles","Container","classList","error","isError","clickable","class","withEndButtonIcon","_$insert","_$effect","_p$","_v$","BorderThin","_v$2","BorderThick","e","_$className","t","undefined","Input","context","useContext","_el$4","_tmpl$2","$$input","currentTarget","forceFieldValue","_$use","el","batch","InputStub","_el$5","_tmpl$3","_ref$","Label","offset","setOffset","onMount","forceOffset","parentElement","rect","getBoundingClientRect","inputRect","left","_el$6","_v$3","_v$4","active","_v$5","_$classList","a","style","setProperty","removeProperty","SideContent","_el$7","_v$6","_v$7","first","last","_$delegateEvents","MILLIS_IN_MINUTE","PopupSchedulePost","PopupSchedule","minTimeDate","rest","i18n","formatTime","sendDate","disabled","isCaptionVisible","PUBLISH_MIN_DELAY_MINUTES","PublishTimeField","onContainerClick","Date","setMinutes","getMinutes","minDate","setHours","initDate","onPick","timestamp","console","log","show","onCrossClick","event","stopPropagation","_$memo","formatFullSentTime","I18nTsx","key","noTimeLangKey","ButtonIconTsx","icon","tabIndex","IconTsx","Icon"],"mappings":"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"}