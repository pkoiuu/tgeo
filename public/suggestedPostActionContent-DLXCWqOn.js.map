{"version":3,"file":"suggestedPostActionContent-DLXCWqOn.js","sources":["../src/components/chat/bubbleParts/suggestedPostActionContent.tsx"],"sourcesContent":["import {Match, onCleanup, Show, Switch} from 'solid-js';\nimport {formatFullSentTime} from '../../../helpers/date';\nimport {numberThousandSplitterForStars} from '../../../helpers/number/numberThousandSplitter';\nimport {I18nTsx} from '../../../helpers/solid/i18n';\nimport {Message, MessageAction} from '../../../layer';\nimport getPeerId from '../../../lib/appManagers/utils/peers/getPeerId';\nimport wrapEmojiText from '../../../lib/richTextProcessor/wrapEmojiText';\nimport rootScope from '../../../lib/rootScope';\nimport defineSolidElement, {PassedProps} from '../../../lib/solidjs/defineSolidElement';\nimport {PeerTitleTsx} from '../../peerTitleTsx';\nimport styles from './suggestedPostActionContent.module.scss';\nimport {SUGGESTED_POST_WAIT_FOR_REWARD_HOURS} from '../../../lib/mtproto/mtproto_config';\n\nif(import.meta.hot) import.meta.hot.accept();\n\n\nconst LIMIT_SYMBOLS = 20;\n\ntype PossibleAction = MessageAction.messageActionSuggestedPostApproval | MessageAction.messageActionSuggestedPostSuccess | MessageAction.messageActionSuggestedPostRefund;\n\ntype Props = {\n  message: Message.message | Message.messageService;\n  canManageDirectMessages: boolean;\n\n  action?: PossibleAction;\n  fromPeerTitle?: HTMLElement;\n};\n\nconst SuggestedPostActionContent = defineSolidElement({\n  name: 'suggested-post-action-content',\n  component: (props: PassedProps<Props>) => {\n    props.element.classList.add(styles.Container);\n    if(import.meta.hot) onCleanup(() => props.element.classList.remove(styles.Container));\n\n    const suggestedPost = () => props.message._ === 'message' ?\n      props.message.suggested_post :\n      undefined;\n\n    const isChangeSuggestion = () => !!props.message.reply_to;\n\n    const wasPublished = () => props.action?._ === 'messageActionSuggestedPostApproval' && props.action?.schedule_date && props.action.schedule_date * 1000 <= Date.now()\n\n    const savedPeerId = () => props.message.saved_peer_id && getPeerId(props.message.saved_peer_id);\n    const chargedPeerId = () => savedPeerId() !== rootScope.myId ? savedPeerId() : undefined;\n\n    const awardedStars = () => props.action?._ === 'messageActionSuggestedPostSuccess' && props.action.price.amount;\n\n    const chargedPrice = () => props.action?._ === 'messageActionSuggestedPostApproval' && props.action.price ?\n      <I18nTsx\n        key={props.action.price._ === 'starsTonAmount' ? 'SuggestedPosts.TONAmount' : 'Stars'}\n        args={[numberThousandSplitterForStars(props.action.price.amount)]}\n      /> :\n      undefined;\n\n    const makeEmoji = (text: string) => <span>{wrapEmojiText(text)}</span>;\n\n    return <>\n      <div class={styles.Label}>\n        <Switch>\n          <Match when={suggestedPost() && isChangeSuggestion()}>\n            <I18nTsx\n              key={props.fromPeerTitle ? 'SuggestedPosts.SuggestedAChange' : 'SuggestedPosts.YouSuggestedAChange'}\n              args={props.fromPeerTitle ? [props.fromPeerTitle] : undefined}\n            />\n          </Match>\n          <Match when={suggestedPost()}>\n            <I18nTsx\n              key={props.fromPeerTitle ? 'SuggestedPosts.SuggestedAPost' : 'SuggestedPosts.YouSuggestedAPost'}\n              args={props.fromPeerTitle ? [props.fromPeerTitle] : undefined}\n            />\n          </Match>\n          <Match when={props.action?._ === 'messageActionSuggestedPostRefund'}>\n            <I18nTsx\n              key='SuggestedPosts.Refund'\n              args={[<PeerTitleTsx peerId={savedPeerId()} onlyFirstName limitSymbols={LIMIT_SYMBOLS} />]}\n            />\n          </Match>\n          <Match when={props.action?._ === 'messageActionSuggestedPostApproval' && props.action?.pFlags?.balance_too_low}>\n            <I18nTsx key='SuggestedPosts.BalanceTooLow' args={[wrapEmojiText('❌')]} />\n          </Match>\n          <Match when={props.action?._ === 'messageActionSuggestedPostApproval' && props.action?.pFlags?.rejected}>\n            <I18nTsx\n              key={props.fromPeerTitle ? 'SuggestedPosts.RejectedAPost' : 'SuggestedPosts.YouRejectedAPost'}\n              args={props.fromPeerTitle ? [wrapEmojiText('❌'), props.fromPeerTitle] : [wrapEmojiText('❌')]}\n            />\n          </Match>\n          <Match when={props.action?._ === 'messageActionSuggestedPostApproval'}>\n            <I18nTsx key='SuggestedPosts.AgreementReached' args={[makeEmoji('🤝')]} />\n          </Match>\n          <Match when={props.action?._ === 'messageActionSuggestedPostSuccess'}>\n            <I18nTsx\n              key='SuggestedPosts.PostSuccess'\n              args={[\n                makeEmoji('✅'),\n                <I18nTsx key='Stars' args={[numberThousandSplitterForStars(awardedStars())]} />\n              ]}\n            />\n          </Match>\n        </Switch>\n      </div>\n\n      <Show when={suggestedPost()?.price || suggestedPost()?.schedule_date}>\n        <div class={styles.Grid}>\n          <Show when={suggestedPost().price}>\n            <div class={styles.GridLabel}><I18nTsx key='SuggestedPosts.Price' /></div>\n            <div class={styles.GridValue}>\n              <I18nTsx\n                key={suggestedPost().price._ === 'starsTonAmount' ? 'SuggestedPosts.TONAmount' : 'Stars'}\n                args={[numberThousandSplitterForStars(suggestedPost().price.amount)]}\n              />\n            </div>\n          </Show>\n          <Show when={suggestedPost().schedule_date}>\n            <div class={styles.GridLabel}><I18nTsx key='SuggestedPosts.Time' /></div>\n            <div class={styles.GridValue}>{formatFullSentTime(suggestedPost().schedule_date)}</div>\n          </Show>\n        </div>\n      </Show>\n\n      {props.action?._ === 'messageActionSuggestedPostApproval' && props.action.reject_comment && (\n        <div class={`${styles.Subtitle} ${styles.center}`}>\n          \"{props.action.reject_comment}\"\n        </div>\n      )}\n\n      {props.action?._ === 'messageActionSuggestedPostApproval' && !props.action?.pFlags?.balance_too_low && !props.action?.pFlags?.rejected &&\n        <>\n          <I18nTsx\n            class={styles.Subtitle}\n            key={wasPublished() ? 'SuggestedPosts.AgreementReached.Published' : 'SuggestedPosts.AgreementReached.ToBePublished'}\n            args={[makeEmoji('📅'), formatFullSentTime(props.action.schedule_date)]}\n          />\n\n          <Show when={props.action.price}>\n            <I18nTsx\n              class={styles.Subtitle}\n              key={chargedPeerId() ? 'SuggestedPosts.AgreementReached.HasBeenCharged' : 'SuggestedPosts.AgreementReached.YouHaveBeenCharged'}\n              args={chargedPeerId() ?\n                [makeEmoji('💰'), <PeerTitleTsx peerId={chargedPeerId()} onlyFirstName limitSymbols={LIMIT_SYMBOLS} />, chargedPrice()] :\n                [makeEmoji('💰'), chargedPrice()]}\n            />\n\n            <I18nTsx\n              class={styles.Subtitle}\n              key='SuggestedPosts.AgreementReached.WillReceive'\n              args={[makeEmoji('⏳'), <PeerTitleTsx peerId={props.message.peerId} limitSymbols={LIMIT_SYMBOLS} />, '' + SUGGESTED_POST_WAIT_FOR_REWARD_HOURS]}\n            />\n\n            <I18nTsx\n              class={styles.Subtitle}\n              key='SuggestedPosts.AgreementReached.WillBeRefunded'\n              args={[makeEmoji('🔄'), <PeerTitleTsx peerId={props.message.peerId} limitSymbols={LIMIT_SYMBOLS} />, '' + SUGGESTED_POST_WAIT_FOR_REWARD_HOURS]}\n            />\n          </Show>\n        </>\n      }\n    </>;\n  }\n});\n\nexport default SuggestedPostActionContent;\n"],"names":["LIMIT_SYMBOLS","SuggestedPostActionContent","defineSolidElement","name","component","props","element","classList","add","styles","Container","suggestedPost","message","_","suggested_post","undefined","isChangeSuggestion","reply_to","wasPublished","action","schedule_date","Date","now","savedPeerId","saved_peer_id","getPeerId","chargedPeerId","rootScope","myId","awardedStars","price","amount","chargedPrice","_$createComponent","I18nTsx","key","args","numberThousandSplitterForStars","makeEmoji","_el$","_tmpl$","_$insert","wrapEmojiText","text","_el$2","_tmpl$2","Switch","children","Match","when","_$memo","fromPeerTitle","PeerTitleTsx","peerId","onlyFirstName","limitSymbols","pFlags","balance_too_low","rejected","_$effect","_$className","Label","Show","_el$3","_el$4","GridLabel","_el$5","GridValue","_el$6","_el$7","formatFullSentTime","Grid","reject_comment","_el$8","_tmpl$3","_el$9","firstChild","_el$11","nextSibling","Subtitle","center","SUGGESTED_POST_WAIT_FOR_REWARD_HOURS"],"mappings":"s1BAgBA,MAAMA,EAAgB,GAYhBC,GAA6BC,EAAmB,CACpDC,KAAM,gCACNC,UAA0CC,GAAA,CACxCA,EAAMC,QAAQC,UAAUC,IAAIC,EAAOC,SAAS,EAGtCC,MAAAA,EAAgBA,IAAMN,EAAMO,QAAQC,IAAM,UAC9CR,EAAMO,QAAQE,eACdC,OAEIC,EAAqBA,IAAM,CAAC,CAACX,EAAMO,QAAQK,SAE3CC,EAAeA,IAAMb,EAAMc,QAAQN,IAAM,sCAAwCR,EAAMc,QAAQC,eAAiBf,EAAMc,OAAOC,cAAgB,KAAQC,KAAKC,IAAI,EAE9JC,EAAcA,IAAMlB,EAAMO,QAAQY,eAAiBC,EAAUpB,EAAMO,QAAQY,aAAa,EACxFE,EAAgBA,IAAMH,MAAkBI,EAAUC,KAAOL,IAAgBR,OAEzEc,EAAeA,IAAMxB,EAAMc,QAAQN,IAAM,qCAAuCR,EAAMc,OAAOW,MAAMC,OAEnGC,EAAeA,IAAM3B,EAAMc,QAAQN,IAAM,sCAAwCR,EAAMc,OAAOW,MAAKG,EACtGC,EAAO,CAAA,IACNC,KAAG,CAAA,OAAE9B,EAAMc,OAAOW,MAAMjB,IAAM,iBAAmB,2BAA6B,OAAO,EAAA,IACrFuB,MAAI,CAAA,MAAE,CAACC,EAA+BhC,EAAMc,OAAOW,MAAMC,MAAM,CAAC,CAAA,CAAC,CAAA,EAEnEhB,OAEIuB,MAAyB,IAAA,CAAA,IAAAC,EAAAC,EAAA,EAAAC,OAAAA,EAAAF,EAAA,IAAYG,EAAcC,CAAI,CAAC,EAAAJ,CAAAA,GAAQ,EAEtE,MAAA,EAAA,IAAA,CAAA,IAAAK,EAAAC,EAAA,EAAAD,OAAAA,EAAAA,EAAAX,EAEKa,EAAM,CAAA,IAAAC,UAAA,CAAAd,MAAAA,CAAAA,EACJe,EAAK,CAAA,IAACC,MAAI,CAAEC,OAAAA,QAAAvC,GAAe,EAAA,GAAIK,EAAmB,CAAC,EAAA,IAAA+B,UAAA,CAAA,OAAAd,EACjDC,EAAO,CAAA,IACNC,KAAG,CAAE9B,OAAAA,EAAM8C,cAAgB,kCAAoC,oCAAoC,EAAA,IACnGf,MAAI,CAAA,OAAE/B,EAAM8C,cAAgB,CAAC9C,EAAM8C,aAAa,EAAIpC,MAAAA,CAAS,CAAA,CAAA,CAAA,CAAAkB,EAAAA,EAGhEe,EAAK,CAAA,IAACC,MAAI,CAAA,OAAEtC,EAAc,CAAC,EAAA,IAAAoC,UAAA,CAAA,OAAAd,EACzBC,EAAO,CAAA,IACNC,KAAG,CAAE9B,OAAAA,EAAM8C,cAAgB,gCAAkC,kCAAkC,EAAA,IAC/Ff,MAAI,CAAA,OAAE/B,EAAM8C,cAAgB,CAAC9C,EAAM8C,aAAa,EAAIpC,MAAAA,CAAS,CAAA,CAAA,CAAA,CAAAkB,EAAAA,EAGhEe,EAAK,CAAA,IAACC,MAAI,CAAE5C,OAAAA,EAAMc,QAAQN,IAAM,kCAAkC,EAAA,IAAAkC,UAAA,CAAA,OAAAd,EAChEC,EAAO,CACNC,IAAG,wBAAA,IACHC,MAAI,CAAE,MAAA,CAAAH,EAAEmB,EAAY,CAAA,IAACC,QAAM,CAAA,OAAE9B,EAAY,CAAC,EAAE+B,cAAa,GAACC,aAAcvD,CAAAA,CAAkB,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAAiC,EAAAA,EAG7Fe,EAAK,CAAA,IAACC,MAAI,CAAA,OAAE5C,EAAMc,QAAQN,IAAM,sCAAwCR,EAAMc,QAAQqC,QAAQC,eAAe,EAAA,IAAAV,UAAA,CAAA,OAAAd,EAC3GC,EAAO,CAACC,IAAG,+BAAA,IAAgCC,MAAI,CAAE,MAAA,CAACM,EAAc,GAAG,CAAC,CAAA,CAAC,CAAA,CAAA,CAAA,CAAAT,EAAAA,EAEvEe,EAAK,CAAA,IAACC,MAAI,CAAA,OAAE5C,EAAMc,QAAQN,IAAM,sCAAwCR,EAAMc,QAAQqC,QAAQE,QAAQ,EAAA,IAAAX,UAAA,CAAA,OAAAd,EACpGC,EAAO,CAAA,IACNC,KAAG,CAAE9B,OAAAA,EAAM8C,cAAgB,+BAAiC,iCAAiC,EAAA,IAC7Ff,MAAI,CAAA,OAAEc,QAAA7C,EAAM8C,aAAa,EAAG,EAAA,CAACT,EAAc,GAAG,EAAGrC,EAAM8C,aAAa,EAAI,CAACT,EAAc,GAAG,CAAC,CAAA,CAAC,CAAA,CAAA,CAAA,CAAAT,EAAAA,EAG/Fe,EAAK,CAAA,IAACC,MAAI,CAAE5C,OAAAA,EAAMc,QAAQN,IAAM,oCAAoC,EAAA,IAAAkC,UAAA,CAAA,OAAAd,EAClEC,EAAO,CAACC,IAAG,kCAAA,IAAmCC,MAAI,CAAE,MAAA,CAACE,EAAU,IAAI,CAAC,CAAA,CAAC,CAAA,CAAA,CAAA,CAAAL,EAAAA,EAEvEe,EAAK,CAAA,IAACC,MAAI,CAAE5C,OAAAA,EAAMc,QAAQN,IAAM,mCAAmC,EAAA,IAAAkC,UAAA,CAAA,OAAAd,EACjEC,EAAO,CACNC,IAAG,6BAAA,IACHC,MAAI,CAAA,MAAE,CACJE,EAAU,GAAG,EAACL,EACbC,EAAO,CAACC,IAAG,QAAA,IAASC,MAAI,CAAA,MAAE,CAACC,EAA+BR,EAAa,CAAC,CAAC,CAAA,CAAC,CAC5E,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,EAAA8B,MAAAC,EAAAhB,EAtCGnC,EAAOoD,KAAK,CAAA,EAAAjB,CAAAA,GAAAX,EAAAA,EA4CvB6B,EAAI,CAAA,IAACb,MAAI,CAAA,OAAEtC,EAAc,GAAGmB,OAASnB,EAAiBS,GAAAA,aAAa,EAAA,IAAA2B,UAAA,CAAA,IAAAgB,EAAAlB,EAAA,EAAAkB,OAAAA,EAAAA,EAAA9B,EAE/D6B,EAAI,CAAA,IAACb,MAAI,CAAA,OAAEtC,EAAgBmB,EAAAA,KAAK,EAAA,IAAAiB,UAAA,CAAA,MAAA,EAAA,IAAA,CAAA,IAAAiB,EAAAnB,EAAA,EAAAmB,OAAAA,EAAAA,EAAA/B,EACAC,EAAO,CAACC,IAAG,sBAAA,CAAA,CAAA,EAAAwB,MAAAC,EAAAI,EAA9BvD,EAAOwD,SAAS,CAAA,EAAAD,CAAA,GAAA,GAAA,IAAA,CAAA,IAAAE,EAAArB,EAAA,EAAAqB,OAAAA,EAAAA,EAAAjC,EAEzBC,EAAO,CAAA,IACNC,KAAG,CAAA,OAAExB,EAAc,EAAEmB,MAAMjB,IAAM,iBAAmB,2BAA6B,OAAO,EAAA,IACxFuB,MAAI,CAAA,MAAE,CAACC,EAA+B1B,EAAgBmB,EAAAA,MAAMC,MAAM,CAAC,CAAA,CAAC,CAAA,CAAA,EAAA4B,MAAAC,EAAAM,EAH5DzD,EAAO0D,SAAS,CAAA,EAAAD,CAAAA,IAAA,CAAA,CAAA,CAAA,EAAA,IAAA,EAAAH,EAAAA,EAAA9B,EAO7B6B,EAAI,CAAA,IAACb,MAAI,CAAA,OAAEtC,EAAgBS,EAAAA,aAAa,EAAA,IAAA2B,UAAA,CAAA,MAAA,EAAA,IAAA,CAAA,IAAAqB,EAAAvB,EAAA,EAAAuB,OAAAA,EAAAA,EAAAnC,EACRC,EAAO,CAACC,IAAG,qBAAA,CAAA,CAAA,EAAAwB,MAAAC,EAAAQ,EAA9B3D,EAAOwD,SAAS,CAAA,EAAAG,CAAA,GAAA,GAAA,IAAA,CAAA,IAAAC,EAAAxB,EAAA,EAAAJ,OAAAA,EAAA4B,EAAA,IACGC,EAAmB3D,EAAc,EAAES,aAAa,CAAC,EAAAuC,MAAAC,EAAAS,EAApE5D,EAAO0D,SAAS,CAAA,EAAAE,CAAAA,IAAA,CAAA,CAAA,CAAA,EAAA,IAAA,EAAAV,MAAAC,EAAAG,EAZpBtD,EAAO8D,IAAI,CAAA,EAAAR,CAAAA,CAAA,CAAA,EAAAb,EAiBxBA,IAAAA,EAAA7C,IAAAA,CAAAA,EAAAA,EAAMc,QAAQN,IAAM,sCAAwCR,EAAMc,OAAOqD,eAAc,EAAA,IAAA,IAAA,CAAAC,IAAAA,EAAAC,IAAAC,EAAAF,EAAAG,WAAAC,EAAAF,EAAAG,YAAAD,OAAAA,EAAAC,YAAArC,EAAAgC,EAElFpE,IAAAA,EAAMc,OAAOqD,eAAcK,CAAA,EAAAjB,EAAAA,IAAAA,EAAAa,EADnB,GAAGhE,EAAOsE,QAAQ,IAAItE,EAAOuE,MAAM,EAAE,CAAA,EAAAP,CAAA,GAAA,CAGlD,EAAAvB,EAEAA,IAAAA,MAAA7C,EAAMc,QAAQN,IAAM,sCAAwC,CAACR,EAAMc,QAAQqC,QAAQC,iBAAmB,CAACpD,EAAMc,QAAQqC,QAAQE,QAAQzB,EAAAA,GAAAA,CAAAA,EAEjIC,EAAO,CAAA,IAAA,OAAA,CAAA,OACCzB,EAAOsE,QAAQ,EAAA,IACtB5C,KAAG,CAAEjB,OAAAA,EAAAA,EAAiB,4CAA8C,+CAA+C,EAAA,IACnHkB,MAAI,CAAE,MAAA,CAACE,EAAU,IAAI,EAAGgC,EAAmBjE,EAAMc,OAAOC,aAAa,CAAC,CAAA,CAAC,CAAAa,EAAAA,EAGxE6B,EAAI,CAAA,IAACb,MAAI,CAAA,OAAE5C,EAAMc,OAAOW,KAAK,EAAA,IAAAiB,UAAA,CAAAd,MAAAA,CAAAA,EAC3BC,EAAO,CAAA,IAAA,OAAA,CAAA,OACCzB,EAAOsE,QAAQ,EAAA,IACtB5C,KAAG,CAAET,OAAAA,EAAAA,EAAkB,iDAAmD,oDAAoD,EAAA,IAC9HU,MAAI,CAAA,OAAEc,EAAA,IAAA,CAAA,CAAAxB,GAAe,EACnB,EAAA,CAACY,EAAU,IAAI,EAACL,EAAGmB,EAAY,CAAA,IAACC,QAAM,CAAA,OAAE3B,EAAc,CAAC,EAAE4B,cAAa,GAACC,aAAcvD,CAAAA,CAAa,EAAMgC,EAAAA,CAAc,EACtH,CAACM,EAAU,IAAI,EAAGN,GAAc,CAAA,CAAC,CAAAC,EAAAA,EAGpCC,EAAO,CAAA,IAAA,OAAA,CAAA,OACCzB,EAAOsE,QAAQ,EACtB5C,IAAG,8CAAA,IACHC,MAAI,CAAA,MAAE,CAACE,EAAU,GAAG,EAACL,EAAGmB,EAAY,CAAA,IAACC,QAAM,CAAA,OAAEhD,EAAMO,QAAQyC,MAAM,EAAEE,aAAcvD,CAAAA,CAAmB,EAAA,GAAKiF,CAAoC,CAAA,CAAC,CAAAhD,EAAAA,EAG/IC,EAAO,CAAA,IAAA,OAAA,CAAA,OACCzB,EAAOsE,QAAQ,EACtB5C,IAAG,iDAAA,IACHC,MAAI,CAAA,MAAE,CAACE,EAAU,IAAI,EAACL,EAAGmB,EAAY,CAAA,IAACC,QAAM,CAAA,OAAEhD,EAAMO,QAAQyC,MAAM,EAAEE,aAAcvD,CAAAA,CAAmB,EAAA,GAAKiF,CAAoC,CAAA,CAAC,CAAA,CAAA,CAAA,CAGlJ,CAAA,CAAA,CAAA,CAAA,CAAA,CAIX,CAAC"}